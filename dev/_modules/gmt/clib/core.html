


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
    
        <title>gmt.clib.core &mdash; GMT/Python</title>
    


  
  
    <link rel="shortcut icon" href="../../../_static/favicon.png"/>
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/style.css" type="text/css" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    
    <script src="../../../_static/require.js"></script>


  
  <script src="../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          
    <a href="../../../index.html"><h2 class="sidebar-title">GMT/Python</h2></a>

    
        
        
            <div class="version">
                dev
            </div>
        
    

    
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>


        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
    
            
            
              
            
            
              <p class="caption"><span class="caption-text">Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../design.html">Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../license.html">License</a></li>
</ul>

            
          

    
        <p class="caption">
            <span class="caption-text">External links</span>
        </p>
        <ul>
            
                <li class="toctree-l1"><a href="http://try.gmtpython.xyz"><i class="fa fa-book fa-fw"></i> Try it online!</a></li>
            
                <li class="toctree-l1"><a href="https://github.com/GenericMappingTools/gmt-python/blob/master/CONTRIBUTING.md"><i class="fa fa-users fa-fw"></i> Contributing</a></li>
            
                <li class="toctree-l1"><a href="https://github.com/GenericMappingTools/gmt-python/blob/master/CODE_OF_CONDUCT.md"><i class="fa fa-gavel fa-fw"></i> Code of Conduct</a></li>
            
                <li class="toctree-l1"><a href="https://gitter.im/GenericMappingTools/gmt-python"><i class="fa fa-comment fa-fw"></i> Contact</a></li>
            
                <li class="toctree-l1"><a href="https://github.com/GenericMappingTools/gmt-python"><i class="fa fa-github fa-fw"></i> Source Code</a></li>
            
        </ul>
    

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">GMT/Python</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          
















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../gmt.html">gmt</a> &raquo;</li>
        
      <li>gmt.clib.core</li>
    
    
    <li class="source-link">
        
        
    </li>

  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for gmt.clib.core</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">ctypes wrappers for core functions from the C API</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">ctypes</span>
<span class="kn">from</span> <span class="nn">tempfile</span> <span class="k">import</span> <span class="n">NamedTemporaryFile</span>
<span class="kn">from</span> <span class="nn">contextlib</span> <span class="k">import</span> <span class="n">contextmanager</span>

<span class="kn">from</span> <span class="nn">packaging.version</span> <span class="k">import</span> <span class="n">Version</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">..exceptions</span> <span class="k">import</span> <span class="p">(</span>
    <span class="n">GMTCLibError</span><span class="p">,</span>
    <span class="n">GMTCLibNoSessionError</span><span class="p">,</span>
    <span class="n">GMTInvalidInput</span><span class="p">,</span>
    <span class="n">GMTVersionError</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">.utils</span> <span class="k">import</span> <span class="p">(</span>
    <span class="n">load_libgmt</span><span class="p">,</span>
    <span class="n">kwargs_to_ctypes_array</span><span class="p">,</span>
    <span class="n">vectors_to_arrays</span><span class="p">,</span>
    <span class="n">dataarray_to_matrix</span><span class="p">,</span>
    <span class="n">as_c_contiguous</span><span class="p">,</span>
<span class="p">)</span>


<div class="viewcode-block" id="LibGMT"><a class="viewcode-back" href="../../../api/gmt.clib.LibGMT.html#gmt.clib.LibGMT">[docs]</a><span class="k">class</span> <span class="nc">LibGMT</span><span class="p">:</span>  <span class="c1"># pylint: disable=too-many-instance-attributes</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load and access the GMT shared library (libgmt).</span>

<span class="sd">    Works as a context manager to create a GMT C API session and destroy it in</span>
<span class="sd">    the end. The context manager feature eliminates the need for the</span>
<span class="sd">    ``GMT_Create_Session`` and ``GMT_Destroy_Session`` functions. Thus, they</span>
<span class="sd">    are not exposed in the Python API. If you need the void pointer to the GMT</span>
<span class="sd">    session, use the ``current_session`` attribute.</span>

<span class="sd">    Functions of the shared library are exposed as methods of this class. Most</span>
<span class="sd">    methods MUST be used inside the context manager &#39;with&#39; block.</span>

<span class="sd">    If creating GMT data structures to communicate data, put that code inside</span>
<span class="sd">    this context manager to reuse the same session.</span>

<span class="sd">    Requires a minimum version of GMT (see ``LibGMT.required_version``). Will</span>
<span class="sd">    check for the version when entering the ``with`` block. A</span>
<span class="sd">    ``GMTVersionError`` exception will be raised if the minimum version</span>
<span class="sd">    requirements aren&#39;t met.</span>

<span class="sd">    By default, will look for the shared library in the directory specified by</span>
<span class="sd">    the environment variable ``GMT_LIBRARY_PATH``. If the variable is not set,</span>
<span class="sd">    will let ctypes try to find the library.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    GMTCLibNotFoundError</span>
<span class="sd">        If there was any problem loading the library (couldn&#39;t find it or</span>
<span class="sd">        couldn&#39;t access the functions).</span>
<span class="sd">    GMTCLibNoSessionError</span>
<span class="sd">        If you try to call a method outside of a &#39;with&#39; block.</span>
<span class="sd">    GMTVersionError</span>
<span class="sd">        If the minimum required version of GMT is not found.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; with LibGMT() as lib:</span>
<span class="sd">    ...     lib.call_module(&#39;figure&#39;, &#39;my-figure&#39;)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">data_families</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;GMT_IS_DATASET&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GMT_IS_GRID&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GMT_IS_PALETTE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GMT_IS_MATRIX&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GMT_IS_VECTOR&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">data_vias</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;GMT_VIA_MATRIX&quot;</span><span class="p">,</span> <span class="s2">&quot;GMT_VIA_VECTOR&quot;</span><span class="p">]</span>

    <span class="n">data_geometries</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;GMT_IS_NONE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GMT_IS_POINT&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GMT_IS_LINE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GMT_IS_POLYGON&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GMT_IS_PLP&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GMT_IS_SURFACE&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">data_modes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;GMT_CONTAINER_ONLY&quot;</span><span class="p">,</span> <span class="s2">&quot;GMT_OUTPUT&quot;</span><span class="p">]</span>

    <span class="n">grid_registrations</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;GMT_GRID_PIXEL_REG&quot;</span><span class="p">,</span> <span class="s2">&quot;GMT_GRID_NODE_REG&quot;</span><span class="p">]</span>

    <span class="c1"># The minimum version of GMT required</span>
    <span class="n">required_version</span> <span class="o">=</span> <span class="s2">&quot;6.0.0&quot;</span>

    <span class="c1"># Map numpy dtypes to GMT types</span>
    <span class="n">_dtypes</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;float64&quot;</span><span class="p">:</span> <span class="s2">&quot;GMT_DOUBLE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;float32&quot;</span><span class="p">:</span> <span class="s2">&quot;GMT_FLOAT&quot;</span><span class="p">,</span>
        <span class="s2">&quot;int64&quot;</span><span class="p">:</span> <span class="s2">&quot;GMT_LONG&quot;</span><span class="p">,</span>
        <span class="s2">&quot;int32&quot;</span><span class="p">:</span> <span class="s2">&quot;GMT_INT&quot;</span><span class="p">,</span>
        <span class="s2">&quot;uint64&quot;</span><span class="p">:</span> <span class="s2">&quot;GMT_ULONG&quot;</span><span class="p">,</span>
        <span class="s2">&quot;uint32&quot;</span><span class="p">:</span> <span class="s2">&quot;GMT_UINT&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">current_session</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The C void pointer for the current open GMT session.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        GMTCLibNoSessionError</span>
<span class="sd">            If trying to access without a currently open GMT session (i.e.,</span>
<span class="sd">            outside of the context manager).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_session_id&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">GMTCLibNoSessionError</span><span class="p">(</span>
                <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="s2">&quot;No currently open GMT API session.&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;Use only inside a &#39;with&#39; block.&quot;</span><span class="p">,</span>
                    <span class="p">]</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session_id</span>

    <span class="nd">@current_session</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">current_session</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">session</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the session void pointer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_session_id</span> <span class="o">=</span> <span class="n">session</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dictionary with the GMT version and default paths and parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">infodict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default</span><span class="p">(</span><span class="s2">&quot;API_VERSION&quot;</span><span class="p">),</span>
            <span class="s2">&quot;padding&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default</span><span class="p">(</span><span class="s2">&quot;API_PAD&quot;</span><span class="p">),</span>
            <span class="s2">&quot;binary dir&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default</span><span class="p">(</span><span class="s2">&quot;API_BINDIR&quot;</span><span class="p">),</span>
            <span class="s2">&quot;share dir&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default</span><span class="p">(</span><span class="s2">&quot;API_SHAREDIR&quot;</span><span class="p">),</span>
            <span class="c1"># This segfaults for some reason</span>
            <span class="c1"># &#39;data dir&#39;: self.get_default(&quot;API_DATADIR&quot;),</span>
            <span class="s2">&quot;plugin dir&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default</span><span class="p">(</span><span class="s2">&quot;API_PLUGINDIR&quot;</span><span class="p">),</span>
            <span class="s2">&quot;library path&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default</span><span class="p">(</span><span class="s2">&quot;API_LIBRARY&quot;</span><span class="p">),</span>
            <span class="s2">&quot;cores&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default</span><span class="p">(</span><span class="s2">&quot;API_CORES&quot;</span><span class="p">),</span>
            <span class="s2">&quot;image layout&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default</span><span class="p">(</span><span class="s2">&quot;API_IMAGE_LAYOUT&quot;</span><span class="p">),</span>
            <span class="s2">&quot;grid layout&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default</span><span class="p">(</span><span class="s2">&quot;API_GRID_LAYOUT&quot;</span><span class="p">),</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">infodict</span>

<div class="viewcode-block" id="LibGMT.get_libgmt_func"><a class="viewcode-back" href="../../../api/gmt.clib.LibGMT.html#gmt.clib.LibGMT.get_libgmt_func">[docs]</a>    <span class="k">def</span> <span class="nf">get_libgmt_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">argtypes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">restype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a ctypes function from the libgmt shared library.</span>

<span class="sd">        Also assigns the argument and return type conversions to the function.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            The name of the GMT API function.</span>
<span class="sd">        argtypes : list</span>
<span class="sd">            List of ctypes types used to convert the Python input arguments for</span>
<span class="sd">            the API function.</span>
<span class="sd">        restype : ctypes type</span>
<span class="sd">            The ctypes type used to convert the input returned by the function</span>
<span class="sd">            into a Python type.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        function</span>
<span class="sd">            The GMT API function.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from ctypes import c_void_p, c_int</span>
<span class="sd">        &gt;&gt;&gt; with LibGMT() as lib:</span>
<span class="sd">        ...     func = lib.get_libgmt_func(&#39;GMT_Destroy_Session&#39;,</span>
<span class="sd">        ...                                argtypes=[c_void_p], restype=c_int)</span>
<span class="sd">        &gt;&gt;&gt; type(func)</span>
<span class="sd">        &lt;class &#39;ctypes.CDLL.__init__.&lt;locals&gt;._FuncPtr&#39;&gt;</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_libgmt&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_libgmt</span> <span class="o">=</span> <span class="n">load_libgmt</span><span class="p">()</span>
        <span class="n">function</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_libgmt</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">argtypes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">function</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="n">argtypes</span>
        <span class="k">if</span> <span class="n">restype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">function</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">restype</span>
        <span class="k">return</span> <span class="n">function</span></div>

    <span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Start the GMT session and keep the session argument.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_session</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_session</span><span class="p">(</span><span class="s2">&quot;gmt-python-session&quot;</span><span class="p">)</span>
        <span class="c1"># Need to store the version info because &#39;get_default&#39; won&#39;t work after</span>
        <span class="c1"># the session is destroyed.</span>
        <span class="n">version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;version&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">Version</span><span class="p">(</span><span class="n">version</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">Version</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">required_version</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cleanup_session</span><span class="p">()</span>
            <span class="k">raise</span> <span class="n">GMTVersionError</span><span class="p">(</span>
                <span class="s2">&quot;Using an incompatible GMT version </span><span class="si">{}</span><span class="s2">. Must be newer than </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">version</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">required_version</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Destroy the session when exiting the context.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cleanup_session</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_cleanup_session</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Destroy the current session and set the stored session to None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">destroy_session</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_session</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_session</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="LibGMT.create_session"><a class="viewcode-back" href="../../../api/gmt.clib.LibGMT.html#gmt.clib.LibGMT.create_session">[docs]</a>    <span class="k">def</span> <span class="nf">create_session</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">session_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create the ``GMTAPI_CTRL`` struct required by the GMT C API functions.</span>

<span class="sd">        It is a C void pointer containing the current session information and</span>
<span class="sd">        cannot be accessed directly.</span>

<span class="sd">        Remember to terminate the current session using</span>
<span class="sd">        :func:`gmt.clib.LibGMT.destroy_session` before creating a new one.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        session_name : str</span>
<span class="sd">            A name for this session. Doesn&#39;t really affect the outcome.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        api_pointer : C void pointer (returned by ctypes as an integer)</span>
<span class="sd">            Used by GMT C API functions.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">c_create_session</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_libgmt_func</span><span class="p">(</span>
            <span class="s2">&quot;GMT_Create_Session&quot;</span><span class="p">,</span>
            <span class="n">argtypes</span><span class="o">=</span><span class="p">[</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_uint</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_uint</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">],</span>
            <span class="n">restype</span><span class="o">=</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># None is passed in place of the print function pointer. It becomes the</span>
        <span class="c1"># NULL pointer when passed to C, prompting the C API to use the default</span>
        <span class="c1"># print function.</span>
        <span class="n">print_func</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">padding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_constant</span><span class="p">(</span><span class="s2">&quot;GMT_PAD_DEFAULT&quot;</span><span class="p">)</span>
        <span class="n">session_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_constant</span><span class="p">(</span><span class="s2">&quot;GMT_SESSION_EXTERNAL&quot;</span><span class="p">)</span>
        <span class="n">session</span> <span class="o">=</span> <span class="n">c_create_session</span><span class="p">(</span>
            <span class="n">session_name</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="n">padding</span><span class="p">,</span> <span class="n">session_type</span><span class="p">,</span> <span class="n">print_func</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">session</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">GMTCLibError</span><span class="p">(</span><span class="s2">&quot;Failed to create a GMT API void pointer.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">session</span></div>

<div class="viewcode-block" id="LibGMT.destroy_session"><a class="viewcode-back" href="../../../api/gmt.clib.LibGMT.html#gmt.clib.LibGMT.destroy_session">[docs]</a>    <span class="k">def</span> <span class="nf">destroy_session</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">session</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Terminate and free the memory of a registered ``GMTAPI_CTRL`` session.</span>

<span class="sd">        The session is created and consumed by the C API modules and needs to</span>
<span class="sd">        be freed before creating a new. Otherwise, some of the configuration</span>
<span class="sd">        files might be left behind and can influence subsequent API calls.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        session : C void pointer (returned by ctypes as an integer)</span>
<span class="sd">            The active session object produced by</span>
<span class="sd">            :func:`gmt.clib.LibGMT.create_session`.</span>
<span class="sd">        libgmt : :py:class:`ctypes.CDLL`</span>
<span class="sd">            The :py:class:`ctypes.CDLL` instance for the libgmt shared library.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">c_destroy_session</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_libgmt_func</span><span class="p">(</span>
            <span class="s2">&quot;GMT_Destroy_Session&quot;</span><span class="p">,</span> <span class="n">argtypes</span><span class="o">=</span><span class="p">[</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">],</span> <span class="n">restype</span><span class="o">=</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span>
        <span class="p">)</span>

        <span class="n">status</span> <span class="o">=</span> <span class="n">c_destroy_session</span><span class="p">(</span><span class="n">session</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">GMTCLibError</span><span class="p">(</span><span class="s2">&quot;Failed to destroy GMT API session&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="LibGMT.get_constant"><a class="viewcode-back" href="../../../api/gmt.clib.LibGMT.html#gmt.clib.LibGMT.get_constant">[docs]</a>    <span class="k">def</span> <span class="nf">get_constant</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the value of a constant (C enum) from gmt_resources.h</span>

<span class="sd">        Used to set configuration values for other API calls. Wraps</span>
<span class="sd">        ``GMT_Get_Enum``.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            The name of the constant (e.g., ``&quot;GMT_SESSION_EXTERNAL&quot;``)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        constant : int</span>
<span class="sd">            Integer value of the constant. Do not rely on this value because it</span>
<span class="sd">            might change.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        GMTCLibError</span>
<span class="sd">            If the constant doesn&#39;t exist.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">c_get_enum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_libgmt_func</span><span class="p">(</span>
            <span class="s2">&quot;GMT_Get_Enum&quot;</span><span class="p">,</span> <span class="n">argtypes</span><span class="o">=</span><span class="p">[</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">],</span> <span class="n">restype</span><span class="o">=</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span>
        <span class="p">)</span>

        <span class="n">value</span> <span class="o">=</span> <span class="n">c_get_enum</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">value</span> <span class="o">==</span> <span class="o">-</span><span class="mi">99999</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">GMTCLibError</span><span class="p">(</span><span class="s2">&quot;Constant &#39;</span><span class="si">{}</span><span class="s2">&#39; doesn&#39;t exits in libgmt.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">value</span></div>

<div class="viewcode-block" id="LibGMT.get_default"><a class="viewcode-back" href="../../../api/gmt.clib.LibGMT.html#gmt.clib.LibGMT.get_default">[docs]</a>    <span class="k">def</span> <span class="nf">get_default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the value of a GMT default parameter (library version, paths, etc).</span>

<span class="sd">        Possible default parameter names include:</span>

<span class="sd">        * ``&quot;API_VERSION&quot;``: The GMT version</span>
<span class="sd">        * ``&quot;API_PAD&quot;``: The grid padding setting</span>
<span class="sd">        * ``&quot;API_BINDIR&quot;``: The binary file directory</span>
<span class="sd">        * ``&quot;API_SHAREDIR&quot;``: The share directory</span>
<span class="sd">        * ``&quot;API_DATADIR&quot;``: The data directory</span>
<span class="sd">        * ``&quot;API_PLUGINDIR&quot;``: The plugin directory</span>
<span class="sd">        * ``&quot;API_LIBRARY&quot;``: The core library path</span>
<span class="sd">        * ``&quot;API_CORES&quot;``: The number of cores</span>
<span class="sd">        * ``&quot;API_IMAGE_LAYOUT&quot;``: The image/band layout</span>
<span class="sd">        * ``&quot;API_GRID_LAYOUT&quot;``: The grid layout</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            The name of the default parameter (e.g., ``&quot;API_VERSION&quot;``)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        value : str</span>
<span class="sd">            The default value for the parameter.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        GMTCLibError</span>
<span class="sd">            If the parameter doesn&#39;t exist.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">c_get_default</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_libgmt_func</span><span class="p">(</span>
            <span class="s2">&quot;GMT_Get_Default&quot;</span><span class="p">,</span>
            <span class="n">argtypes</span><span class="o">=</span><span class="p">[</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">],</span>
            <span class="n">restype</span><span class="o">=</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Make a string buffer to get a return value</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">create_string_buffer</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>

        <span class="n">status</span> <span class="o">=</span> <span class="n">c_get_default</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_session</span><span class="p">,</span> <span class="n">name</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="n">value</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">status</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">GMTCLibError</span><span class="p">(</span>
                <span class="s2">&quot;Error getting default value for &#39;</span><span class="si">{}</span><span class="s2">&#39; (error code </span><span class="si">{}</span><span class="s2">).&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">name</span><span class="p">,</span> <span class="n">status</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span></div>

<div class="viewcode-block" id="LibGMT.log_to_file"><a class="viewcode-back" href="../../../api/gmt.clib.LibGMT.html#gmt.clib.LibGMT.log_to_file">[docs]</a>    <span class="nd">@contextmanager</span>
    <span class="k">def</span> <span class="nf">log_to_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logfile</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the next API call in this session to log to a file.</span>

<span class="sd">        Use it as a context manager (in a ``with`` block) to capture the error</span>
<span class="sd">        messages from GMT API calls. Mostly useful with ``GMT_Call_Module``</span>
<span class="sd">        because most others don&#39;t print error messages.</span>

<span class="sd">        The log file will be deleted when exiting the ``with`` block.</span>

<span class="sd">        Calls the GMT API function ``GMT_Handle_Messages`` using</span>
<span class="sd">        ``GMT_LOG_ONCE`` mode (to only log errors from the next API call).</span>
<span class="sd">        Only works for a **single API call**, so make calls like</span>
<span class="sd">        ``get_constant`` outside of the ``with`` block.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        * logfile : str or None</span>
<span class="sd">            The name of the logfile. If ``None`` (default),</span>
<span class="sd">            the file name is automatically generated by the tempfile module.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; with LibGMT() as lib:</span>
<span class="sd">        ...     mode = lib.get_constant(&#39;GMT_MODULE_CMD&#39;)</span>
<span class="sd">        ...     with lib.log_to_file() as logfile:</span>
<span class="sd">        ...         call_module = lib.get_libgmt_func(&#39;GMT_Call_Module&#39;)</span>
<span class="sd">        ...         status = call_module(lib.current_session, &#39;info&#39;.encode(),</span>
<span class="sd">        ...                              mode, &#39;bogus-file.bla&#39;.encode())</span>
<span class="sd">        ...         with open(logfile) as flog:</span>
<span class="sd">        ...             print(flog.read().strip())</span>
<span class="sd">        gmtinfo [ERROR]: Error for input file: No such file (bogus-file.bla)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">c_handle_messages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_libgmt_func</span><span class="p">(</span>
            <span class="s2">&quot;GMT_Handle_Messages&quot;</span><span class="p">,</span>
            <span class="n">argtypes</span><span class="o">=</span><span class="p">[</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_uint</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_uint</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">],</span>
            <span class="n">restype</span><span class="o">=</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">logfile</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tmp_file</span> <span class="o">=</span> <span class="n">NamedTemporaryFile</span><span class="p">(</span>
                <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;gmt-python-&quot;</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.log&quot;</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="kc">False</span>
            <span class="p">)</span>
            <span class="n">logfile</span> <span class="o">=</span> <span class="n">tmp_file</span><span class="o">.</span><span class="n">name</span>
            <span class="n">tmp_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="n">status</span> <span class="o">=</span> <span class="n">c_handle_messages</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_session</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_constant</span><span class="p">(</span><span class="s2">&quot;GMT_LOG_ONCE&quot;</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_constant</span><span class="p">(</span><span class="s2">&quot;GMT_IS_FILE&quot;</span><span class="p">),</span>
            <span class="n">logfile</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Failed to set logging to file &#39;</span><span class="si">{}</span><span class="s2">&#39; (error: </span><span class="si">{}</span><span class="s2">).&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">logfile</span><span class="p">,</span> <span class="n">status</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="n">GMTCLibError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="c1"># The above is called when entering a &#39;with&#39; statement</span>
        <span class="k">yield</span> <span class="n">logfile</span>

        <span class="c1"># Clean up when exiting the &#39;with&#39; statement</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">logfile</span><span class="p">)</span></div>

<div class="viewcode-block" id="LibGMT.call_module"><a class="viewcode-back" href="../../../api/gmt.clib.LibGMT.html#gmt.clib.LibGMT.call_module">[docs]</a>    <span class="k">def</span> <span class="nf">call_module</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call a GMT module with the given arguments.</span>

<span class="sd">        Makes a call to ``GMT_Call_Module`` from the C API using mode</span>
<span class="sd">        ``GMT_MODULE_CMD`` (arguments passed as a single string).</span>

<span class="sd">        Most interactions with the C API are done through this function.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        module : str</span>
<span class="sd">            Module name (``&#39;pscoast&#39;``, ``&#39;psbasemap&#39;``, etc).</span>
<span class="sd">        args : str</span>
<span class="sd">            String with the command line arguments that will be passed to the</span>
<span class="sd">            module (for example, ``&#39;-R0/5/0/10 -JM&#39;``).</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        GMTCLibError</span>
<span class="sd">            If the returned status code of the function is non-zero.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">c_call_module</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_libgmt_func</span><span class="p">(</span>
            <span class="s2">&quot;GMT_Call_Module&quot;</span><span class="p">,</span>
            <span class="n">argtypes</span><span class="o">=</span><span class="p">[</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">],</span>
            <span class="n">restype</span><span class="o">=</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_constant</span><span class="p">(</span><span class="s2">&quot;GMT_MODULE_CMD&quot;</span><span class="p">)</span>
        <span class="c1"># If there is no open session, this will raise an exception. Can&#39; let</span>
        <span class="c1"># it happen inside the &#39;with&#39; otherwise the logfile won&#39;t be deleted.</span>
        <span class="n">session</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_session</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_to_file</span><span class="p">()</span> <span class="k">as</span> <span class="n">logfile</span><span class="p">:</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">c_call_module</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">module</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="n">mode</span><span class="p">,</span> <span class="n">args</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
            <span class="c1"># Get the error message inside the with block before the log file</span>
            <span class="c1"># is deleted</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">logfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">flog</span><span class="p">:</span>
                <span class="n">log</span> <span class="o">=</span> <span class="n">flog</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="c1"># Raise the exception outside the log &#39;with&#39; to make sure the logfile</span>
        <span class="c1"># is cleaned.</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">log</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Invalid GMT module name &#39;</span><span class="si">{}</span><span class="s2">&#39;.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">module</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="s2">&quot;Command &#39;</span><span class="si">{}</span><span class="s2">&#39; failed:&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">module</span><span class="p">),</span>
                        <span class="s2">&quot;---------- Error log ----------&quot;</span><span class="p">,</span>
                        <span class="n">log</span><span class="p">,</span>
                        <span class="s2">&quot;-------------------------------&quot;</span><span class="p">,</span>
                    <span class="p">]</span>
                <span class="p">)</span>
            <span class="k">raise</span> <span class="n">GMTCLibError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>

<div class="viewcode-block" id="LibGMT.create_data"><a class="viewcode-back" href="../../../api/gmt.clib.LibGMT.html#gmt.clib.LibGMT.create_data">[docs]</a>    <span class="k">def</span> <span class="nf">create_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">family</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create an empty GMT data container.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        family : str</span>
<span class="sd">            A valid GMT data family name (e.g., ``&#39;GMT_IS_DATASET&#39;``). See the</span>
<span class="sd">            ``data_families`` attribute for valid names.</span>
<span class="sd">        geometry : str</span>
<span class="sd">            A valid GMT data geometry name (e.g., ``&#39;GMT_IS_POINT&#39;``). See the</span>
<span class="sd">            ``data_geometries`` attribute for valid names.</span>
<span class="sd">        mode : str</span>
<span class="sd">            A valid GMT data mode (e.g., ``&#39;GMT_OUTPUT&#39;``). See the</span>
<span class="sd">            ``data_modes`` attribute for valid names.</span>
<span class="sd">        dim : list of 4 integers</span>
<span class="sd">            The dimensions of the dataset. See the documentation for the GMT C</span>
<span class="sd">            API function ``GMT_Create_Data`` (``src/gmt_api.c``) for the full</span>
<span class="sd">            range of options regarding &#39;dim&#39;. If ``None``, will pass in the</span>
<span class="sd">            NULL pointer.</span>
<span class="sd">        ranges : list of 4 floats</span>
<span class="sd">            The dataset extent. Also a bit of a complicated argument. See the C</span>
<span class="sd">            function documentation. It&#39;s called ``range`` in the C function but</span>
<span class="sd">            it would conflict with the Python built-in ``range`` function.</span>
<span class="sd">        inc : list of 2 floats</span>
<span class="sd">            The increments between points of the dataset. See the C function</span>
<span class="sd">            documentation.</span>
<span class="sd">        registration : int</span>
<span class="sd">            The node registration (what the coordinates mean). Can be</span>
<span class="sd">            ``&#39;GMT_GRID_PIXEL_REG&#39;`` or ``&#39;GMT_GRID_NODE_REG&#39;``. Defaults to</span>
<span class="sd">            ``&#39;GMT_GRID_NODE_REG&#39;``.</span>
<span class="sd">        pad : int</span>
<span class="sd">            The grid padding. Defaults to ``GMT_PAD_DEFAULT``.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        data_ptr : int</span>
<span class="sd">            A ctypes pointer (an integer) to the allocated ``GMT_Dataset``</span>
<span class="sd">            object.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">c_create_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_libgmt_func</span><span class="p">(</span>
            <span class="s2">&quot;GMT_Create_Data&quot;</span><span class="p">,</span>
            <span class="n">argtypes</span><span class="o">=</span><span class="p">[</span>
                <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span>  <span class="c1"># API</span>
                <span class="n">ctypes</span><span class="o">.</span><span class="n">c_uint</span><span class="p">,</span>  <span class="c1"># family</span>
                <span class="n">ctypes</span><span class="o">.</span><span class="n">c_uint</span><span class="p">,</span>  <span class="c1"># geometry</span>
                <span class="n">ctypes</span><span class="o">.</span><span class="n">c_uint</span><span class="p">,</span>  <span class="c1"># mode</span>
                <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_uint64</span><span class="p">),</span>  <span class="c1"># dim</span>
                <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">),</span>  <span class="c1"># range</span>
                <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">),</span>  <span class="c1"># inc</span>
                <span class="n">ctypes</span><span class="o">.</span><span class="n">c_uint</span><span class="p">,</span>  <span class="c1"># registration</span>
                <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">,</span>  <span class="c1"># pad</span>
                <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span>
            <span class="p">],</span>  <span class="c1"># data</span>
            <span class="n">restype</span><span class="o">=</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">family_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_constant</span><span class="p">(</span>
            <span class="n">family</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_families</span><span class="p">,</span> <span class="n">valid_modifiers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_vias</span>
        <span class="p">)</span>
        <span class="n">mode_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_constant</span><span class="p">(</span>
            <span class="n">mode</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_modes</span><span class="p">,</span> <span class="n">valid_modifiers</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GMT_GRID_IS_GEO&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">geometry_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_constant</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_geometries</span><span class="p">)</span>
        <span class="n">registration_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_constant</span><span class="p">(</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;registration&quot;</span><span class="p">,</span> <span class="s2">&quot;GMT_GRID_NODE_REG&quot;</span><span class="p">),</span>
            <span class="n">valid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">grid_registrations</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Convert dim, ranges, and inc to ctypes arrays if given (will be None</span>
        <span class="c1"># if not given to represent NULL pointers)</span>
        <span class="n">dim</span> <span class="o">=</span> <span class="n">kwargs_to_ctypes_array</span><span class="p">(</span><span class="s2">&quot;dim&quot;</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_uint64</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">ranges</span> <span class="o">=</span> <span class="n">kwargs_to_ctypes_array</span><span class="p">(</span><span class="s2">&quot;ranges&quot;</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">inc</span> <span class="o">=</span> <span class="n">kwargs_to_ctypes_array</span><span class="p">(</span><span class="s2">&quot;inc&quot;</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Use a NULL pointer (None) for existing data to indicate that the</span>
        <span class="c1"># container should be created empty. Fill it in later using put_vector</span>
        <span class="c1"># and put_matrix.</span>
        <span class="n">data_ptr</span> <span class="o">=</span> <span class="n">c_create_data</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_session</span><span class="p">,</span>
            <span class="n">family_int</span><span class="p">,</span>
            <span class="n">geometry_int</span><span class="p">,</span>
            <span class="n">mode_int</span><span class="p">,</span>
            <span class="n">dim</span><span class="p">,</span>
            <span class="n">ranges</span><span class="p">,</span>
            <span class="n">inc</span><span class="p">,</span>
            <span class="n">registration_int</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parse_pad</span><span class="p">(</span><span class="n">family</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">),</span>
            <span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">data_ptr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">GMTCLibError</span><span class="p">(</span><span class="s2">&quot;Failed to create an empty GMT data pointer.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">data_ptr</span></div>

    <span class="k">def</span> <span class="nf">_parse_pad</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">family</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parse and return an appropriate value for pad if none is given.</span>

<span class="sd">        Pad is a bit tricky because, for matrix types, pad control the matrix</span>
<span class="sd">        ordering (row or column major). Using the default pad will set it to</span>
<span class="sd">        column major and mess things up with the numpy arrays.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pad</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pad&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pad</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;MATRIX&quot;</span> <span class="ow">in</span> <span class="n">family</span><span class="p">:</span>
                <span class="n">pad</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pad</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_constant</span><span class="p">(</span><span class="s2">&quot;GMT_PAD_DEFAULT&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pad</span>

    <span class="k">def</span> <span class="nf">_parse_constant</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">constant</span><span class="p">,</span> <span class="n">valid</span><span class="p">,</span> <span class="n">valid_modifiers</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parse a constant, convert it to an int, and validate it.</span>

<span class="sd">        The GMT C API takes certain defined constants, like ``&#39;GMT_IS_GRID&#39;``,</span>
<span class="sd">        that need to be validated and converted to integer values using</span>
<span class="sd">        :meth:`~gmt.clib.LibGMT.get_constant`.</span>

<span class="sd">        The constants can also take a modifier by appending another constant</span>
<span class="sd">        name, e.g. ``&#39;GMT_IS_GRID|GMT_VIA_MATRIX&#39;``. The two parts must be</span>
<span class="sd">        converted separately and their values are added.</span>

<span class="sd">        If valid modifiers are not given, then will assume that modifiers are</span>
<span class="sd">        not allowed. In this case, will raise a</span>
<span class="sd">        :class:`~gmt.exceptions.GMTInvalidInput` exception if given a modifier.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        constant : str</span>
<span class="sd">            The name of a valid GMT API constant, with an optional modifier.</span>
<span class="sd">        valid : list of str</span>
<span class="sd">            A list of valid values for the constant. Will raise a</span>
<span class="sd">            :class:`~gmt.exceptions.GMTInvalidInput` exception if the given</span>
<span class="sd">            value is not on the list.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">constant</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">nmodifiers</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">nmodifiers</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">GMTInvalidInput</span><span class="p">(</span>
                <span class="s2">&quot;Only one modifier is allowed in constants, </span><span class="si">{}</span><span class="s2"> given: &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">nmodifiers</span><span class="p">,</span> <span class="n">constant</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">nmodifiers</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">valid_modifiers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">GMTInvalidInput</span><span class="p">(</span>
                <span class="s2">&quot;Constant modifiers not allowed since valid values were not &quot;</span>
                <span class="o">+</span> <span class="s2">&quot;given: &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">constant</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">GMTInvalidInput</span><span class="p">(</span>
                <span class="s2">&quot;Invalid constant argument &#39;</span><span class="si">{}</span><span class="s2">&#39;. Must be one of </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">valid</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">nmodifiers</span> <span class="o">&gt;</span> <span class="mi">0</span>
            <span class="ow">and</span> <span class="n">valid_modifiers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_modifiers</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="n">GMTInvalidInput</span><span class="p">(</span>
                <span class="s2">&quot;Invalid constant modifier &#39;</span><span class="si">{}</span><span class="s2">&#39;. Must be one of </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">str</span><span class="p">(</span><span class="n">valid_modifiers</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="n">integer_value</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_constant</span><span class="p">(</span><span class="n">part</span><span class="p">)</span> <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">integer_value</span>

    <span class="k">def</span> <span class="nf">_check_dtype_and_dim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">ndim</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check that a numpy array has the given dimensions and is a valid data</span>
<span class="sd">        type.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        array : numpy array</span>
<span class="sd">            The array to be tested.</span>
<span class="sd">        ndim : int</span>
<span class="sd">            The desired dimension of the array.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        gmt_type : int</span>
<span class="sd">            The GMT constant value representing this data type.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        GMTCLibError</span>
<span class="sd">            If the array has the wrong dimensions or is an unsupported data</span>
<span class="sd">            type.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; data = np.array([1, 2, 3], dtype=&#39;float64&#39;)</span>
<span class="sd">        &gt;&gt;&gt; with LibGMT() as lib:</span>
<span class="sd">        ...     gmttype = lib._check_dtype_and_dim(data, ndim=1)</span>
<span class="sd">        ...     gmttype == lib.get_constant(&#39;GMT_DOUBLE&#39;)</span>
<span class="sd">        True</span>
<span class="sd">        &gt;&gt;&gt; data = np.ones((5, 2), dtype=&#39;float32&#39;)</span>
<span class="sd">        &gt;&gt;&gt; with LibGMT() as lib:</span>
<span class="sd">        ...     gmttype = lib._check_dtype_and_dim(data, ndim=2)</span>
<span class="sd">        ...     gmttype == lib.get_constant(&#39;GMT_FLOAT&#39;)</span>
<span class="sd">        True</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">array</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dtypes</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">GMTInvalidInput</span><span class="p">(</span>
                <span class="s2">&quot;Unsupported numpy data type &#39;</span><span class="si">{}</span><span class="s2">&#39;.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="n">ndim</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">GMTInvalidInput</span><span class="p">(</span>
                <span class="s2">&quot;Expected a numpy 1d array, got </span><span class="si">{}</span><span class="s2">d.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">ndim</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_constant</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dtypes</span><span class="p">[</span><span class="n">array</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>

<div class="viewcode-block" id="LibGMT.put_vector"><a class="viewcode-back" href="../../../api/gmt.clib.LibGMT.html#gmt.clib.LibGMT.put_vector">[docs]</a>    <span class="k">def</span> <span class="nf">put_vector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">vector</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attach a numpy 1D array as a column on a GMT dataset.</span>

<span class="sd">        Use this functions to attach numpy array data to a GMT dataset and pass</span>
<span class="sd">        it to GMT modules. Wraps ``GMT_Put_Vector``.</span>

<span class="sd">        The dataset must be created by :meth:`~gmt.clib.LibGMT.create_data`</span>
<span class="sd">        first. Use ``family=&#39;GMT_IS_DATASET|GMT_VIA_VECTOR&#39;``.</span>

<span class="sd">        Not at all numpy dtypes are supported, only: float64, float32, int64,</span>
<span class="sd">        int32, uint64, and uint32.</span>

<span class="sd">        .. warning::</span>
<span class="sd">            The numpy array must be C contiguous in memory. If it comes from a</span>
<span class="sd">            column slice of a 2d array, for example, you will have to make a</span>
<span class="sd">            copy. Use :func:`numpy.ascontiguousarray` to make sure your vector</span>
<span class="sd">            is contiguous (it won&#39;t copy if it already is).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dataset : :py:class:`ctypes.c_void_p`</span>
<span class="sd">            The ctypes void pointer to a ``GMT_Dataset``. Create it with</span>
<span class="sd">            :meth:`~gmt.clib.LibGMT.create_data`.</span>
<span class="sd">        column : int</span>
<span class="sd">            The column number of this vector in the dataset (starting from 0).</span>
<span class="sd">        vector : numpy 1d-array</span>
<span class="sd">            The array that will be attached to the dataset. Must be a 1d C</span>
<span class="sd">            contiguous array.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        GMTCLibError</span>
<span class="sd">            If given invalid input or ``GMT_Put_Vector`` exits with status !=</span>
<span class="sd">            0.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">c_put_vector</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_libgmt_func</span><span class="p">(</span>
            <span class="s2">&quot;GMT_Put_Vector&quot;</span><span class="p">,</span>
            <span class="n">argtypes</span><span class="o">=</span><span class="p">[</span>
                <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span>
                <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span>
                <span class="n">ctypes</span><span class="o">.</span><span class="n">c_uint</span><span class="p">,</span>
                <span class="n">ctypes</span><span class="o">.</span><span class="n">c_uint</span><span class="p">,</span>
                <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="n">restype</span><span class="o">=</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">gmt_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_dtype_and_dim</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">vector_pointer</span> <span class="o">=</span> <span class="n">vector</span><span class="o">.</span><span class="n">ctypes</span><span class="o">.</span><span class="n">data_as</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">)</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">c_put_vector</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_session</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">gmt_type</span><span class="p">,</span> <span class="n">vector_pointer</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">GMTCLibError</span><span class="p">(</span>
                <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="s2">&quot;Failed to put vector of type </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vector</span><span class="o">.</span><span class="n">dtype</span><span class="p">),</span>
                        <span class="s2">&quot;in column </span><span class="si">{}</span><span class="s2"> of dataset.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">column</span><span class="p">),</span>
                    <span class="p">]</span>
                <span class="p">)</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="LibGMT.put_matrix"><a class="viewcode-back" href="../../../api/gmt.clib.LibGMT.html#gmt.clib.LibGMT.put_matrix">[docs]</a>    <span class="k">def</span> <span class="nf">put_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">matrix</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attach a numpy 2D array to a GMT dataset.</span>

<span class="sd">        Use this functions to attach numpy array data to a GMT dataset and pass</span>
<span class="sd">        it to GMT modules. Wraps ``GMT_Put_Matrix``.</span>

<span class="sd">        The dataset must be created by :meth:`~gmt.clib.LibGMT.create_data`</span>
<span class="sd">        first. Use ``|GMT_VIA_MATRIX&#39;`` in the family.</span>

<span class="sd">        Not at all numpy dtypes are supported, only: float64, float32, int64,</span>
<span class="sd">        int32, uint64, and uint32.</span>

<span class="sd">        .. warning::</span>
<span class="sd">            The numpy array must be C contiguous in memory. Use</span>
<span class="sd">            :func:`numpy.ascontiguousarray` to make sure your vector is</span>
<span class="sd">            contiguous (it won&#39;t copy if it already is).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dataset : :py:class:`ctypes.c_void_p`</span>
<span class="sd">            The ctypes void pointer to a ``GMT_Dataset``. Create it with</span>
<span class="sd">            :meth:`~gmt.clib.LibGMT.create_data`.</span>
<span class="sd">        matrix : numpy 2d-array</span>
<span class="sd">            The array that will be attached to the dataset. Must be a 2d C</span>
<span class="sd">            contiguous array.</span>
<span class="sd">        pad : int</span>
<span class="sd">            The amount of padding that should be added to the matrix. Use when</span>
<span class="sd">            creating grids for modules that require padding.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        GMTCLibError</span>
<span class="sd">            If given invalid input or ``GMT_Put_Matrix`` exits with status !=</span>
<span class="sd">            0.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">c_put_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_libgmt_func</span><span class="p">(</span>
            <span class="s2">&quot;GMT_Put_Matrix&quot;</span><span class="p">,</span>
            <span class="n">argtypes</span><span class="o">=</span><span class="p">[</span>
                <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span>
                <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span>
                <span class="n">ctypes</span><span class="o">.</span><span class="n">c_uint</span><span class="p">,</span>
                <span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">,</span>
                <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="n">restype</span><span class="o">=</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">gmt_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_dtype_and_dim</span><span class="p">(</span><span class="n">matrix</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">matrix_pointer</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">ctypes</span><span class="o">.</span><span class="n">data_as</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">)</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">c_put_matrix</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_session</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">gmt_type</span><span class="p">,</span> <span class="n">pad</span><span class="p">,</span> <span class="n">matrix_pointer</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">GMTCLibError</span><span class="p">(</span><span class="s2">&quot;Failed to put matrix of type </span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">dtype</span><span class="p">))</span></div>

<div class="viewcode-block" id="LibGMT.write_data"><a class="viewcode-back" href="../../../api/gmt.clib.LibGMT.html#gmt.clib.LibGMT.write_data">[docs]</a>    <span class="k">def</span> <span class="nf">write_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">family</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">wesn</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write a GMT data container to a file.</span>

<span class="sd">        The data container should be created by</span>
<span class="sd">        :meth:`~gmt.clib.LibGMT.create_data`.</span>

<span class="sd">        Wraps ``GMT_Write_Data`` but only allows writing to a file. So the</span>
<span class="sd">        ``method`` argument is omitted.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        family : str</span>
<span class="sd">            A valid GMT data family name (e.g., ``&#39;GMT_IS_DATASET&#39;``). See the</span>
<span class="sd">            ``data_families`` attribute for valid names. Don&#39;t use the</span>
<span class="sd">            ``GMT_VIA_VECTOR`` or ``GMT_VIA_MATRIX`` constructs for this. Use</span>
<span class="sd">            ``GMT_IS_VECTOR`` and ``GMT_IS_MATRIX`` instead.</span>
<span class="sd">        geometry : str</span>
<span class="sd">            A valid GMT data geometry name (e.g., ``&#39;GMT_IS_POINT&#39;``). See the</span>
<span class="sd">            ``data_geometries`` attribute for valid names.</span>
<span class="sd">        mode : str</span>
<span class="sd">            How the data is to be written to the file. This option varies</span>
<span class="sd">            depending on the given family. See the GMT API documentation for</span>
<span class="sd">            details.</span>
<span class="sd">        wesn : list or numpy array</span>
<span class="sd">            [xmin, xmax, ymin, ymax, zmin, zmax] of the data. Must have 6</span>
<span class="sd">            elements.</span>
<span class="sd">        output : str</span>
<span class="sd">            The output file name.</span>
<span class="sd">        data : :py:class:`ctypes.c_void_p`</span>
<span class="sd">            Pointer to the data container created by</span>
<span class="sd">            :meth:`~gmt.clib.LibGMT.create_data`.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        GMTCLibError</span>
<span class="sd">            For invalid input arguments or if the GMT API functions returns a</span>
<span class="sd">            non-zero status code.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">c_write_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_libgmt_func</span><span class="p">(</span>
            <span class="s2">&quot;GMT_Write_Data&quot;</span><span class="p">,</span>
            <span class="n">argtypes</span><span class="o">=</span><span class="p">[</span>
                <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span>
                <span class="n">ctypes</span><span class="o">.</span><span class="n">c_uint</span><span class="p">,</span>
                <span class="n">ctypes</span><span class="o">.</span><span class="n">c_uint</span><span class="p">,</span>
                <span class="n">ctypes</span><span class="o">.</span><span class="n">c_uint</span><span class="p">,</span>
                <span class="n">ctypes</span><span class="o">.</span><span class="n">c_uint</span><span class="p">,</span>
                <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">),</span>
                <span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">,</span>
                <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="n">restype</span><span class="o">=</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">family_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_constant</span><span class="p">(</span>
            <span class="n">family</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_families</span><span class="p">,</span> <span class="n">valid_modifiers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_vias</span>
        <span class="p">)</span>
        <span class="n">geometry_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_constant</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_geometries</span><span class="p">)</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">c_write_data</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_session</span><span class="p">,</span>
            <span class="n">family_int</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_constant</span><span class="p">(</span><span class="s2">&quot;GMT_IS_FILE&quot;</span><span class="p">),</span>
            <span class="n">geometry_int</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_constant</span><span class="p">(</span><span class="n">mode</span><span class="p">),</span>
            <span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span> <span class="o">*</span> <span class="mi">6</span><span class="p">)(</span><span class="o">*</span><span class="n">wesn</span><span class="p">),</span>
            <span class="n">output</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span>
            <span class="n">data</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">GMTCLibError</span><span class="p">(</span><span class="s2">&quot;Failed to write dataset to &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">output</span><span class="p">))</span></div>

<div class="viewcode-block" id="LibGMT.open_virtual_file"><a class="viewcode-back" href="../../../api/gmt.clib.LibGMT.html#gmt.clib.LibGMT.open_virtual_file">[docs]</a>    <span class="nd">@contextmanager</span>
    <span class="k">def</span> <span class="nf">open_virtual_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">family</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Open a GMT Virtual File to pass data to and from a module.</span>

<span class="sd">        GMT uses a virtual file scheme to pass in data to API modules. Use it</span>
<span class="sd">        to pass in your GMT data structure (created using</span>
<span class="sd">        :meth:`~gmt.clib.LibGMT.create_data`) to a module that expects an input</span>
<span class="sd">        or output file.</span>

<span class="sd">        Use in a ``with`` block. Will automatically close the virtual file when</span>
<span class="sd">        leaving the ``with`` block. Because of this, no wrapper for</span>
<span class="sd">        ``GMT_Close_VirtualFile`` is provided.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        family : str</span>
<span class="sd">            A valid GMT data family name (e.g., ``&#39;GMT_IS_DATASET&#39;``). Should</span>
<span class="sd">            be the same as the one you used to create your data structure.</span>
<span class="sd">        geometry : str</span>
<span class="sd">            A valid GMT data geometry name (e.g., ``&#39;GMT_IS_POINT&#39;``). Should</span>
<span class="sd">            be the same as the one you used to create your data structure.</span>
<span class="sd">        direction : str</span>
<span class="sd">            Either ``&#39;GMT_IN&#39;`` or ``&#39;GMT_OUT&#39;`` to indicate if passing data to</span>
<span class="sd">            GMT or getting it out of GMT, respectively.</span>
<span class="sd">        data : int</span>
<span class="sd">            The ctypes void pointer to your GMT data structure.</span>

<span class="sd">        Yields</span>
<span class="sd">        ------</span>
<span class="sd">        vfname : str</span>
<span class="sd">            The name of the virtual file that you can pass to a GMT module.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from gmt.helpers import GMTTempFile</span>
<span class="sd">        &gt;&gt;&gt; import os</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; x = np.array([0, 1, 2, 3, 4])</span>
<span class="sd">        &gt;&gt;&gt; y = np.array([5, 6, 7, 8, 9])</span>
<span class="sd">        &gt;&gt;&gt; with LibGMT() as lib:</span>
<span class="sd">        ...     family = &#39;GMT_IS_DATASET|GMT_VIA_VECTOR&#39;</span>
<span class="sd">        ...     geometry = &#39;GMT_IS_POINT&#39;</span>
<span class="sd">        ...     dataset = lib.create_data(</span>
<span class="sd">        ...         family=family,</span>
<span class="sd">        ...         geometry=geometry,</span>
<span class="sd">        ...         mode=&#39;GMT_CONTAINER_ONLY&#39;,</span>
<span class="sd">        ...         dim=[2, 5, 1, 0],  # columns, lines, segments, type</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     lib.put_vector(dataset, column=0, vector=x)</span>
<span class="sd">        ...     lib.put_vector(dataset, column=1, vector=y)</span>
<span class="sd">        ...     # Add the dataset to a virtual file</span>
<span class="sd">        ...     vfargs = (family, geometry, &#39;GMT_IN&#39;, dataset)</span>
<span class="sd">        ...     with lib.open_virtual_file(*vfargs) as vfile:</span>
<span class="sd">        ...         # Send the output to a temp file so that we can read it</span>
<span class="sd">        ...         with GMTTempFile() as ofile:</span>
<span class="sd">        ...             args = &#39;{} -&gt;{}&#39;.format(vfile, ofile.name)</span>
<span class="sd">        ...             lib.call_module(&#39;info&#39;, args)</span>
<span class="sd">        ...             print(ofile.read().strip())</span>
<span class="sd">        &lt;vector memory&gt;: N = 5 &lt;0/4&gt; &lt;5/9&gt;</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">c_open_virtualfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_libgmt_func</span><span class="p">(</span>
            <span class="s2">&quot;GMT_Open_VirtualFile&quot;</span><span class="p">,</span>
            <span class="n">argtypes</span><span class="o">=</span><span class="p">[</span>
                <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span>
                <span class="n">ctypes</span><span class="o">.</span><span class="n">c_uint</span><span class="p">,</span>
                <span class="n">ctypes</span><span class="o">.</span><span class="n">c_uint</span><span class="p">,</span>
                <span class="n">ctypes</span><span class="o">.</span><span class="n">c_uint</span><span class="p">,</span>
                <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span>
                <span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="n">restype</span><span class="o">=</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">c_close_virtualfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_libgmt_func</span><span class="p">(</span>
            <span class="s2">&quot;GMT_Close_VirtualFile&quot;</span><span class="p">,</span>
            <span class="n">argtypes</span><span class="o">=</span><span class="p">[</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">],</span>
            <span class="n">restype</span><span class="o">=</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">family_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_constant</span><span class="p">(</span>
            <span class="n">family</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_families</span><span class="p">,</span> <span class="n">valid_modifiers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_vias</span>
        <span class="p">)</span>
        <span class="n">geometry_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_constant</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_geometries</span><span class="p">)</span>
        <span class="n">direction_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_constant</span><span class="p">(</span>
            <span class="n">direction</span><span class="p">,</span>
            <span class="n">valid</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GMT_IN&quot;</span><span class="p">,</span> <span class="s2">&quot;GMT_OUT&quot;</span><span class="p">],</span>
            <span class="n">valid_modifiers</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GMT_IS_REFERENCE&quot;</span><span class="p">,</span> <span class="s2">&quot;GMT_IS_DUPLICATE&quot;</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="n">buff</span> <span class="o">=</span> <span class="n">ctypes</span><span class="o">.</span><span class="n">create_string_buffer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_constant</span><span class="p">(</span><span class="s2">&quot;GMT_STR16&quot;</span><span class="p">))</span>

        <span class="n">status</span> <span class="o">=</span> <span class="n">c_open_virtualfile</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">current_session</span><span class="p">,</span> <span class="n">family_int</span><span class="p">,</span> <span class="n">geometry_int</span><span class="p">,</span> <span class="n">direction_int</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">buff</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">status</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">GMTCLibError</span><span class="p">(</span><span class="s2">&quot;Failed to create a virtual file.&quot;</span><span class="p">)</span>

        <span class="n">vfname</span> <span class="o">=</span> <span class="n">buff</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">vfname</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">c_close_virtualfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_session</span><span class="p">,</span> <span class="n">vfname</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">status</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">GMTCLibError</span><span class="p">(</span><span class="s2">&quot;Failed to close virtual file &#39;</span><span class="si">{}</span><span class="s2">&#39;.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">vfname</span><span class="p">))</span></div>

<div class="viewcode-block" id="LibGMT.vectors_to_vfile"><a class="viewcode-back" href="../../../api/gmt.clib.LibGMT.html#gmt.clib.LibGMT.vectors_to_vfile">[docs]</a>    <span class="nd">@contextmanager</span>
    <span class="k">def</span> <span class="nf">vectors_to_vfile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">vectors</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Store 1d arrays in a GMT virtual file to use as a module input.</span>

<span class="sd">        Context manager (use in a ``with`` block). Yields the virtual file name</span>
<span class="sd">        that you can pass as an argument to a GMT module call. Closes the</span>
<span class="sd">        virtual file upon exit of the ``with`` block.</span>

<span class="sd">        Use this instead of creating GMT Datasets and Virtual Files by hand</span>
<span class="sd">        with :meth:`~gmt.clib.LibGMT.create_data`,</span>
<span class="sd">        :meth:`~gmt.clib.LibGMT.put_vector`, and</span>
<span class="sd">        :meth:`~gmt.clib.LibGMT.open_virtual_file`</span>

<span class="sd">        The virtual file will contain the arrays as ``GMT Vector`` structures.</span>

<span class="sd">        If the arrays are C contiguous blocks of memory, they will be passed</span>
<span class="sd">        without copying to GMT. If they are not (e.g., they are columns of a 2D</span>
<span class="sd">        array), they will need to be copied to a contiguous block.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        vectors : 1d arrays</span>
<span class="sd">            The vectors that will be included in the array. All must be of the</span>
<span class="sd">            same size.</span>

<span class="sd">        Yields</span>
<span class="sd">        ------</span>
<span class="sd">        vfile : str</span>
<span class="sd">            The name of virtual file. Pass this as a file name argument to a</span>
<span class="sd">            GMT module.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from gmt.helpers import GMTTempFile</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">        &gt;&gt;&gt; x = [1, 2, 3]</span>
<span class="sd">        &gt;&gt;&gt; y = np.array([4, 5, 6])</span>
<span class="sd">        &gt;&gt;&gt; z = pd.Series([7, 8, 9])</span>
<span class="sd">        &gt;&gt;&gt; with LibGMT() as lib:</span>
<span class="sd">        ...     with lib.vectors_to_vfile(x, y, z) as vfile:</span>
<span class="sd">        ...         # Send the output to a file so that we can read it</span>
<span class="sd">        ...         with GMTTempFile() as ofile:</span>
<span class="sd">        ...             args = &#39;{} -&gt;{}&#39;.format(vfile, ofile.name)</span>
<span class="sd">        ...             lib.call_module(&#39;info&#39;, args)</span>
<span class="sd">        ...             print(ofile.read().strip())</span>
<span class="sd">        &lt;vector memory&gt;: N = 3 &lt;1/3&gt; &lt;4/6&gt; &lt;7/9&gt;</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Conversion to a C-contiguous array needs to be done here and not in</span>
        <span class="c1"># put_matrix because we need to maintain a reference to the copy while</span>
        <span class="c1"># it is being used by the C API. Otherwise, the array would be garbage</span>
        <span class="c1"># collected and the memory freed. Creating it in this context manager</span>
        <span class="c1"># guarantees that the copy will be around until the virtual file is</span>
        <span class="c1"># closed.</span>
        <span class="c1"># The conversion is implicit in vectors_to_arrays.</span>
        <span class="n">arrays</span> <span class="o">=</span> <span class="n">vectors_to_arrays</span><span class="p">(</span><span class="n">vectors</span><span class="p">)</span>

        <span class="n">columns</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">arrays</span><span class="p">)</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">arrays</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="n">rows</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">arrays</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">GMTInvalidInput</span><span class="p">(</span><span class="s2">&quot;All arrays must have same size.&quot;</span><span class="p">)</span>

        <span class="n">family</span> <span class="o">=</span> <span class="s2">&quot;GMT_IS_DATASET|GMT_VIA_VECTOR&quot;</span>
        <span class="n">geometry</span> <span class="o">=</span> <span class="s2">&quot;GMT_IS_POINT&quot;</span>

        <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_data</span><span class="p">(</span>
            <span class="n">family</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;GMT_CONTAINER_ONLY&quot;</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="p">[</span><span class="n">columns</span><span class="p">,</span> <span class="n">rows</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">array</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arrays</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">put_vector</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">vector</span><span class="o">=</span><span class="n">array</span><span class="p">)</span>

        <span class="n">vf_args</span> <span class="o">=</span> <span class="p">(</span><span class="n">family</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="s2">&quot;GMT_IN&quot;</span><span class="p">,</span> <span class="n">dataset</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_virtual_file</span><span class="p">(</span><span class="o">*</span><span class="n">vf_args</span><span class="p">)</span> <span class="k">as</span> <span class="n">vfile</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">vfile</span></div>

<div class="viewcode-block" id="LibGMT.matrix_to_vfile"><a class="viewcode-back" href="../../../api/gmt.clib.LibGMT.html#gmt.clib.LibGMT.matrix_to_vfile">[docs]</a>    <span class="nd">@contextmanager</span>
    <span class="k">def</span> <span class="nf">matrix_to_vfile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">matrix</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Store a 2d array in a GMT virtual file to use as a module input.</span>

<span class="sd">        Context manager (use in a ``with`` block). Yields the virtual file name</span>
<span class="sd">        that you can pass as an argument to a GMT module call. Closes the</span>
<span class="sd">        virtual file upon exit of the ``with`` block.</span>

<span class="sd">        The virtual file will contain the array as a ``GMT_MATRIX``.</span>

<span class="sd">        **Not meant for creating GMT Grids**. The grid requires more metadata</span>
<span class="sd">        than just the data matrix. This creates a Dataset (table).</span>

<span class="sd">        Use this instead of creating GMT Datasets and Virtual Files by hand</span>
<span class="sd">        with :meth:`~gmt.clib.LibGMT.create_data`,</span>
<span class="sd">        :meth:`~gmt.clib.LibGMT.put_matrix`, and</span>
<span class="sd">        :meth:`~gmt.clib.LibGMT.open_virtual_file`</span>

<span class="sd">        The matrix must be C contiguous in memory. If it is not (e.g., it is a</span>
<span class="sd">        slice of a larger array), the array will be copied to make sure it is.</span>

<span class="sd">        It might be more efficient than using</span>
<span class="sd">        :meth:`~gmt.clib.LibGMT.vectors_to_vfile` if your data are columns of a</span>
<span class="sd">        2D array. In these cases, ``vectors_to_vfile`` will have to duplicate</span>
<span class="sd">        the memory of your array in order for columns to be C contiguous.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        matrix : 2d array</span>
<span class="sd">            The matrix that will be included in the Dataset.</span>

<span class="sd">        Yields</span>
<span class="sd">        ------</span>
<span class="sd">        vfile : str</span>
<span class="sd">            The name of virtual file. Pass this as a file name argument to a</span>
<span class="sd">            GMT module.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from gmt.helpers import GMTTempFile</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; data = np.arange(12).reshape((4, 3))</span>
<span class="sd">        &gt;&gt;&gt; print(data)</span>
<span class="sd">        [[ 0  1  2]</span>
<span class="sd">         [ 3  4  5]</span>
<span class="sd">         [ 6  7  8]</span>
<span class="sd">         [ 9 10 11]]</span>
<span class="sd">        &gt;&gt;&gt; with LibGMT() as lib:</span>
<span class="sd">        ...     with lib.matrix_to_vfile(data) as vfile:</span>
<span class="sd">        ...         # Send the output to a file so that we can read it</span>
<span class="sd">        ...         with GMTTempFile() as ofile:</span>
<span class="sd">        ...             args = &#39;{} -&gt;{}&#39;.format(vfile, ofile.name)</span>
<span class="sd">        ...             lib.call_module(&#39;info&#39;, args)</span>
<span class="sd">        ...             print(ofile.read().strip())</span>
<span class="sd">        &lt;matrix memory&gt;: N = 4 &lt;0/9&gt; &lt;1/10&gt; &lt;2/11&gt;</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Conversion to a C-contiguous array needs to be done here and not in</span>
        <span class="c1"># put_matrix because we need to maintain a reference to the copy while</span>
        <span class="c1"># it is being used by the C API. Otherwise, the array would be garbage</span>
        <span class="c1"># collected and the memory freed. Creating it in this context manager</span>
        <span class="c1"># guarantees that the copy will be around until the virtual file is</span>
        <span class="c1"># closed.</span>
        <span class="n">matrix</span> <span class="o">=</span> <span class="n">as_c_contiguous</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span>
        <span class="n">rows</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">shape</span>

        <span class="n">family</span> <span class="o">=</span> <span class="s2">&quot;GMT_IS_DATASET|GMT_VIA_MATRIX&quot;</span>
        <span class="n">geometry</span> <span class="o">=</span> <span class="s2">&quot;GMT_IS_POINT&quot;</span>

        <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_data</span><span class="p">(</span>
            <span class="n">family</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;GMT_CONTAINER_ONLY&quot;</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="p">[</span><span class="n">columns</span><span class="p">,</span> <span class="n">rows</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">put_matrix</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">matrix</span><span class="p">)</span>

        <span class="n">vf_args</span> <span class="o">=</span> <span class="p">(</span><span class="n">family</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="s2">&quot;GMT_IN&quot;</span><span class="p">,</span> <span class="n">dataset</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_virtual_file</span><span class="p">(</span><span class="o">*</span><span class="n">vf_args</span><span class="p">)</span> <span class="k">as</span> <span class="n">vfile</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">vfile</span></div>

<div class="viewcode-block" id="LibGMT.grid_to_vfile"><a class="viewcode-back" href="../../../api/gmt.clib.LibGMT.html#gmt.clib.LibGMT.grid_to_vfile">[docs]</a>    <span class="nd">@contextmanager</span>
    <span class="k">def</span> <span class="nf">grid_to_vfile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grid</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Store a grid in a GMT virtual file to use as a module input.</span>

<span class="sd">        Used to pass grid data into GMT modules. Grids must be</span>
<span class="sd">        ``xarray.DataArray`` instances.</span>

<span class="sd">        Context manager (use in a ``with`` block). Yields the virtual file name</span>
<span class="sd">        that you can pass as an argument to a GMT module call. Closes the</span>
<span class="sd">        virtual file upon exit of the ``with`` block.</span>

<span class="sd">        The virtual file will contain the grid as a ``GMT_MATRIX``.</span>

<span class="sd">        Use this instead of creating ``GMT_GRID`` and virtual files by hand</span>
<span class="sd">        with :meth:`~gmt.clib.LibGMT.create_data`,</span>
<span class="sd">        :meth:`~gmt.clib.LibGMT.put_matrix`, and</span>
<span class="sd">        :meth:`~gmt.clib.LibGMT.open_virtual_file`</span>

<span class="sd">        The grid data matrix must be C contiguous in memory. If it is not</span>
<span class="sd">        (e.g., it is a slice of a larger array), the array will be copied to</span>
<span class="sd">        make sure it is.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        grid : xarray.DataArraw</span>
<span class="sd">            The grid that will be included in the virtual file.</span>

<span class="sd">        Yields</span>
<span class="sd">        ------</span>
<span class="sd">        vfile : str</span>
<span class="sd">            The name of virtual file. Pass this as a file name argument to a</span>
<span class="sd">            GMT module.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from gmt.datasets import load_earth_relief</span>
<span class="sd">        &gt;&gt;&gt; from gmt.helpers import GMTTempFile</span>
<span class="sd">        &gt;&gt;&gt; data = load_earth_relief(resolution=&#39;60m&#39;)</span>
<span class="sd">        &gt;&gt;&gt; print(data.shape)</span>
<span class="sd">        (181, 361)</span>
<span class="sd">        &gt;&gt;&gt; print(data.lon.values.min(), data.lon.values.max())</span>
<span class="sd">        -180.0 180.0</span>
<span class="sd">        &gt;&gt;&gt; print(data.lat.values.min(), data.lat.values.max())</span>
<span class="sd">        -90.0 90.0</span>
<span class="sd">        &gt;&gt;&gt; print(data.values.min(), data.values.max())</span>
<span class="sd">        -8425.0 5551.0</span>
<span class="sd">        &gt;&gt;&gt; with LibGMT() as lib:</span>
<span class="sd">        ...     with lib.grid_to_vfile(data) as vfile:</span>
<span class="sd">        ...         # Send the output to a file so that we can read it</span>
<span class="sd">        ...         with GMTTempFile() as ofile:</span>
<span class="sd">        ...             args = &#39;{} -L0 -Cn -&gt;{}&#39;.format(vfile, ofile.name)</span>
<span class="sd">        ...             lib.call_module(&#39;grdinfo&#39;, args)</span>
<span class="sd">        ...             print(ofile.read().strip())</span>
<span class="sd">        -180 180 -90 90 -8425 5551 1 1 361 181</span>
<span class="sd">        &gt;&gt;&gt; # The output is: w e s n z0 z1 dx dy n_columns n_rows</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Conversion to a C-contiguous array needs to be done here and not in</span>
        <span class="c1"># put_matrix because we need to maintain a reference to the copy while</span>
        <span class="c1"># it is being used by the C API. Otherwise, the array would be garbage</span>
        <span class="c1"># collected and the memory freed. Creating it in this context manager</span>
        <span class="c1"># guarantees that the copy will be around until the virtual file is</span>
        <span class="c1"># closed.</span>
        <span class="c1"># The conversion is implicit in dataarray_to_matrix.</span>
        <span class="n">matrix</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="n">inc</span> <span class="o">=</span> <span class="n">dataarray_to_matrix</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
        <span class="n">family</span> <span class="o">=</span> <span class="s2">&quot;GMT_IS_GRID|GMT_VIA_MATRIX&quot;</span>
        <span class="n">geometry</span> <span class="o">=</span> <span class="s2">&quot;GMT_IS_SURFACE&quot;</span>
        <span class="n">gmt_grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_data</span><span class="p">(</span>
            <span class="n">family</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;GMT_CONTAINER_ONLY&quot;</span><span class="p">,</span> <span class="n">ranges</span><span class="o">=</span><span class="n">region</span><span class="p">,</span> <span class="n">inc</span><span class="o">=</span><span class="n">inc</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">put_matrix</span><span class="p">(</span><span class="n">gmt_grid</span><span class="p">,</span> <span class="n">matrix</span><span class="p">)</span>
        <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">family</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="s2">&quot;GMT_IN|GMT_IS_REFERENCE&quot;</span><span class="p">,</span> <span class="n">gmt_grid</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_virtual_file</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span> <span class="k">as</span> <span class="n">vfile</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">vfile</span></div>

<div class="viewcode-block" id="LibGMT.extract_region"><a class="viewcode-back" href="../../../api/gmt.clib.LibGMT.html#gmt.clib.LibGMT.extract_region">[docs]</a>    <span class="k">def</span> <span class="nf">extract_region</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extract the WESN bounding box of the currently active figure.</span>

<span class="sd">        Retrieves the information from the PostScript file, so it works for</span>
<span class="sd">        country codes as well.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        * wesn : 1d array</span>
<span class="sd">            A 1D numpy array with the west, east, south, and north dimensions</span>
<span class="sd">            of the current figure.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; import gmt</span>
<span class="sd">        &gt;&gt;&gt; fig = gmt.Figure()</span>
<span class="sd">        &gt;&gt;&gt; fig.coast(region=[0, 10, -20, -10], projection=&quot;M6i&quot;, frame=True,</span>
<span class="sd">        ...           land=&#39;black&#39;)</span>
<span class="sd">        &gt;&gt;&gt; with LibGMT() as lib:</span>
<span class="sd">        ...     wesn = lib.extract_region()</span>
<span class="sd">        &gt;&gt;&gt; print(&#39;, &#39;.join([&#39;{:.2f}&#39;.format(x) for x in wesn]))</span>
<span class="sd">        0.00, 10.00, -20.00, -10.00</span>

<span class="sd">        Using ISO country codes for the regions (for example ``&#39;US.HI&#39;`` for</span>
<span class="sd">        Hawaii):</span>

<span class="sd">        &gt;&gt;&gt; fig = gmt.Figure()</span>
<span class="sd">        &gt;&gt;&gt; fig.coast(region=&#39;US.HI&#39;, projection=&quot;M6i&quot;, frame=True,</span>
<span class="sd">        ...           land=&#39;black&#39;)</span>
<span class="sd">        &gt;&gt;&gt; with LibGMT() as lib:</span>
<span class="sd">        ...     wesn = lib.extract_region()</span>
<span class="sd">        &gt;&gt;&gt; print(&#39;, &#39;.join([&#39;{:.2f}&#39;.format(x) for x in wesn]))</span>
<span class="sd">        -164.71, -154.81, 18.91, 23.58</span>

<span class="sd">        The country codes can have an extra argument that rounds the region a</span>
<span class="sd">        multiple of the argument (for example, ``&#39;US.HI+r5&#39;`` will round the</span>
<span class="sd">        region to multiples of 5):</span>

<span class="sd">        &gt;&gt;&gt; fig = gmt.Figure()</span>
<span class="sd">        &gt;&gt;&gt; fig.coast(region=&#39;US.HI+r5&#39;, projection=&quot;M6i&quot;, frame=True,</span>
<span class="sd">        ...           land=&#39;black&#39;)</span>
<span class="sd">        &gt;&gt;&gt; with LibGMT() as lib:</span>
<span class="sd">        ...     wesn = lib.extract_region()</span>
<span class="sd">        &gt;&gt;&gt; print(&#39;, &#39;.join([&#39;{:.2f}&#39;.format(x) for x in wesn]))</span>
<span class="sd">        -165.00, -150.00, 15.00, 25.00</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">c_extract_region</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_libgmt_func</span><span class="p">(</span>
            <span class="s2">&quot;GMT_Extract_Region&quot;</span><span class="p">,</span>
            <span class="n">argtypes</span><span class="o">=</span><span class="p">[</span>
                <span class="n">ctypes</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span>
                <span class="n">ctypes</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">,</span>
                <span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">),</span>
            <span class="p">],</span>
            <span class="n">restype</span><span class="o">=</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_int</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">wesn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="c1"># Use NaNs so that we can know if GMT didn&#39;t change the array</span>
        <span class="n">wesn</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">wesn_pointer</span> <span class="o">=</span> <span class="n">wesn</span><span class="o">.</span><span class="n">ctypes</span><span class="o">.</span><span class="n">data_as</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctypes</span><span class="o">.</span><span class="n">c_double</span><span class="p">))</span>
        <span class="c1"># The second argument to GMT_Extract_Region is a file pointer to a</span>
        <span class="c1"># PostScript file. It&#39;s only valid in classic mode. Use None to get a</span>
        <span class="c1"># NULL pointer instead.</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">c_extract_region</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_session</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">wesn_pointer</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">GMTCLibError</span><span class="p">(</span><span class="s2">&quot;Failed to extract region from current figure.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">wesn</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017, Leonardo Uieda and Paul Wessel.
      Last updated on Jun 14, 2018.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../',
            VERSION:'',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  <script type="text/javascript" src="../../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>