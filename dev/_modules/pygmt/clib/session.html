


<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
        <title>pygmt.clib.session &mdash; PyGMT</title>
    

      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=9edc463e" />
      <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
      <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery.css?v=d2d258e8" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-binder.css?v=f4aeca0c" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-dataframe.css?v=2082cf3c" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sg_gallery-rendered-html.css?v=1277b6f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.min.css?v=95c83b7e" />
      <link rel="stylesheet" type="text/css" href="../../../_static/style.css?v=2ba370f3" />

  
    <link rel="shortcut icon" href="../../../_static/favicon.png"/>
    <link rel="canonical" href="https://pygmt.org//dev/_modules/pygmt/clib/session.html" />
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=84d2b63f"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../../_static/copybutton.js?v=ccdb6887"></script>
      <script src="../../../_static/design-tabs.js?v=f930bc37"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <!-- Google Analytics tracking code -->
    <!-- See https://developers.google.com/analytics/devguides/collection/analyticsjs/ for documentation. -->
    <!-- 'storage': 'none' disables cookies -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new
            Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-38125837-7', 'auto', {'storage': 'none'});
      ga('set', 'anonymizeIp', true);
      ga('send', 'pageview');
    </script>

    <!-- Documentation switcher -->
    <!-- Point to the *dev* version switcher. This will allow the latest versions to appear on older documentation. -->
    <script type="text/javascript" src="/dev/_static/version_switch.js"></script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
   
   
   <a href="../../../index.html">
     <h2 class="sidebar-title">PyGMT</h2>
   </a>
     <div class="version">
       dev
     </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
 
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
    
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../intro/index.html">Intro to PyGMT</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gallery/index.html">Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../projections/index.html">Projections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../external_resources.html">External Resources</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../techref/index.html">Technical Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changes.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../minversions.html">Minimum Supported Versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ecosystem.html">Ecosystem</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../team.html">PyGMT Team</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">Contributors Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../maintenance.html">Maintainers Guide</a></li>
</ul>


    
        <p class="caption">
            <span class="caption-text">Getting help and contributing</span>
        </p>
        <ul>
            
                <li class="toctree-l1"><a href="https://github.com/GenericMappingTools/.github/blob/main/CODE_OF_CONDUCT.md"><i class="fa fa-gavel fa-fw"></i> Code of Conduct</a></li>
            
                <li class="toctree-l1"><a href="https://github.com/GenericMappingTools/pygmt/blob/main/LICENSE.txt"><i class="fa fa-book fa-fw"></i> License</a></li>
            
                <li class="toctree-l1"><a href="https://forum.generic-mapping-tools.org"><i class="fa fa-comment fa-fw"></i> Contact</a></li>
            
                <li class="toctree-l1"><a href="https://github.com/GenericMappingTools/pygmt"><i class="fa fa-github fa-fw"></i> Source Code</a></li>
            
        </ul>
    

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">PyGMT</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          
<div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">pygmt.clib.session</li>
    <li class="source-link">
        
    </li>

  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for pygmt.clib.session</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Defines the Session class to create and destroy a GMT API session and provides access to</span>
<span class="sd">the API functions.</span>

<span class="sd">Uses ctypes to wrap most of the core functions from the C API.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">contextlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">ctypes</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ctp</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">io</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections.abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Generator</span><span class="p">,</span> <span class="n">Sequence</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Literal</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pygmt.clib.conversion</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">dataarray_to_matrix</span><span class="p">,</span>
    <span class="n">sequence_to_ctypes_array</span><span class="p">,</span>
    <span class="n">strings_to_ctypes_array</span><span class="p">,</span>
    <span class="n">vectors_to_arrays</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pygmt.clib.loading</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_gmt_version</span><span class="p">,</span> <span class="n">load_libgmt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pygmt.datatypes</span><span class="w"> </span><span class="kn">import</span> <span class="n">_GMT_DATASET</span><span class="p">,</span> <span class="n">_GMT_GRID</span><span class="p">,</span> <span class="n">_GMT_IMAGE</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pygmt.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">GMTCLibError</span><span class="p">,</span>
    <span class="n">GMTCLibNoSessionError</span><span class="p">,</span>
    <span class="n">GMTTypeError</span><span class="p">,</span>
    <span class="n">GMTValueError</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pygmt.helpers</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">_validate_data_input</span><span class="p">,</span>
    <span class="n">data_kind</span><span class="p">,</span>
    <span class="n">deprecate_parameter</span><span class="p">,</span>
    <span class="n">tempfile_from_geojson</span><span class="p">,</span>
    <span class="n">tempfile_from_image</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">FAMILIES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;GMT_IS_DATASET&quot;</span><span class="p">,</span>  <span class="c1"># Entity is a data table</span>
    <span class="s2">&quot;GMT_IS_GRID&quot;</span><span class="p">,</span>  <span class="c1"># Entity is a grid</span>
    <span class="s2">&quot;GMT_IS_IMAGE&quot;</span><span class="p">,</span>  <span class="c1"># Entity is a 1- or 3-band unsigned char image</span>
    <span class="s2">&quot;GMT_IS_PALETTE&quot;</span><span class="p">,</span>  <span class="c1"># Entity is a color palette table</span>
    <span class="s2">&quot;GMT_IS_POSTSCRIPT&quot;</span><span class="p">,</span>  <span class="c1"># Entity is a PostScript content struct</span>
    <span class="s2">&quot;GMT_IS_MATRIX&quot;</span><span class="p">,</span>  <span class="c1"># Entity is a user matrix</span>
    <span class="s2">&quot;GMT_IS_VECTOR&quot;</span><span class="p">,</span>  <span class="c1"># Entity is a set of user vectors</span>
    <span class="s2">&quot;GMT_IS_CUBE&quot;</span><span class="p">,</span>  <span class="c1"># Entity is a 3-D data cube</span>
<span class="p">]</span>

<span class="n">VIAS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;GMT_VIA_MATRIX&quot;</span><span class="p">,</span>  <span class="c1"># dataset is passed as a matrix</span>
    <span class="s2">&quot;GMT_VIA_VECTOR&quot;</span><span class="p">,</span>  <span class="c1"># dataset is passed as a set of vectors</span>
<span class="p">]</span>

<span class="n">GEOMETRIES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;GMT_IS_NONE&quot;</span><span class="p">,</span>  <span class="c1"># items without geometry (e.g., CPT)</span>
    <span class="s2">&quot;GMT_IS_POINT&quot;</span><span class="p">,</span>  <span class="c1"># items are points</span>
    <span class="s2">&quot;GMT_IS_LINE&quot;</span><span class="p">,</span>  <span class="c1"># items are lines</span>
    <span class="s2">&quot;GMT_IS_POLY&quot;</span><span class="p">,</span>  <span class="c1"># items are polygons</span>
    <span class="s2">&quot;GMT_IS_LP&quot;</span><span class="p">,</span>  <span class="c1"># items could be any one of LINE or POLY</span>
    <span class="s2">&quot;GMT_IS_PLP&quot;</span><span class="p">,</span>  <span class="c1"># items could be any one of POINT, LINE, or POLY</span>
    <span class="s2">&quot;GMT_IS_SURFACE&quot;</span><span class="p">,</span>  <span class="c1"># items are 2-D grid</span>
    <span class="s2">&quot;GMT_IS_VOLUME&quot;</span><span class="p">,</span>  <span class="c1"># items are 3-D grid</span>
    <span class="s2">&quot;GMT_IS_TEXT&quot;</span><span class="p">,</span>  <span class="c1"># Text strings which triggers ASCII text reading</span>
<span class="p">]</span>

<span class="n">METHODS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;GMT_IS_DUPLICATE&quot;</span><span class="p">,</span>  <span class="c1"># tell GMT the data are read-only</span>
    <span class="s2">&quot;GMT_IS_REFERENCE&quot;</span><span class="p">,</span>  <span class="c1"># tell GMT to duplicate the data</span>
<span class="p">]</span>

<span class="n">DIRECTIONS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;GMT_IN&quot;</span><span class="p">,</span> <span class="s2">&quot;GMT_OUT&quot;</span><span class="p">]</span>

<span class="n">MODES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;GMT_CONTAINER_AND_DATA&quot;</span><span class="p">,</span>  <span class="c1"># Create/Read/Write both container and the data array</span>
    <span class="s2">&quot;GMT_CONTAINER_ONLY&quot;</span><span class="p">,</span>  <span class="c1"># Cread/Read/Write the container but no data array</span>
    <span class="s2">&quot;GMT_DATA_ONLY&quot;</span><span class="p">,</span>  <span class="c1"># Create/Read/Write the container&#39;s data array only</span>
    <span class="s2">&quot;GMT_IS_OUTPUT&quot;</span><span class="p">,</span>  <span class="c1"># For creating a resource as a container for output</span>
<span class="p">]</span>
<span class="n">MODE_MODIFIERS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;GMT_GRID_IS_CARTESIAN&quot;</span><span class="p">,</span>  <span class="c1"># Grid is not geographic but Cartesian</span>
    <span class="s2">&quot;GMT_GRID_IS_GEO&quot;</span><span class="p">,</span>  <span class="c1"># Grid is geographic, not Cartesian</span>
    <span class="s2">&quot;GMT_WITH_STRINGS&quot;</span><span class="p">,</span>  <span class="c1"># Allocate string array for GMT_DATASET/GMT_VECTOR/GMT_MATRIX</span>
<span class="p">]</span>

<span class="n">REGISTRATIONS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;GMT_GRID_NODE_REG&quot;</span><span class="p">,</span> <span class="s2">&quot;GMT_GRID_PIXEL_REG&quot;</span><span class="p">]</span>

<span class="c1"># Dictionary for mapping numpy dtypes to GMT data types.</span>
<span class="n">DTYPES_NUMERIC</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">:</span> <span class="s2">&quot;GMT_CHAR&quot;</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">:</span> <span class="s2">&quot;GMT_SHORT&quot;</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">:</span> <span class="s2">&quot;GMT_INT&quot;</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">:</span> <span class="s2">&quot;GMT_LONG&quot;</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">longlong</span><span class="p">:</span> <span class="s2">&quot;GMT_LONG&quot;</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">:</span> <span class="s2">&quot;GMT_UCHAR&quot;</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">:</span> <span class="s2">&quot;GMT_USHORT&quot;</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">:</span> <span class="s2">&quot;GMT_UINT&quot;</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">:</span> <span class="s2">&quot;GMT_ULONG&quot;</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">ulonglong</span><span class="p">:</span> <span class="s2">&quot;GMT_ULONG&quot;</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">:</span> <span class="s2">&quot;GMT_FLOAT&quot;</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span> <span class="s2">&quot;GMT_DOUBLE&quot;</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">:</span> <span class="s2">&quot;GMT_LONG&quot;</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">DTYPES_TEXT</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">np</span><span class="o">.</span><span class="n">str_</span><span class="p">:</span> <span class="s2">&quot;GMT_TEXT&quot;</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">:</span> <span class="s2">&quot;GMT_DATETIME&quot;</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">DTYPES</span> <span class="o">=</span> <span class="n">DTYPES_NUMERIC</span> <span class="o">|</span> <span class="n">DTYPES_TEXT</span>

<span class="c1"># Dictionary for storing the values of GMT constants.</span>
<span class="n">GMT_CONSTANTS</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c1"># Load the GMT library outside the Session class to avoid repeated loading.</span>
<span class="n">_libgmt</span> <span class="o">=</span> <span class="n">load_libgmt</span><span class="p">()</span>
<span class="n">__gmt_version__</span> <span class="o">=</span> <span class="n">get_gmt_version</span><span class="p">(</span><span class="n">_libgmt</span><span class="p">)</span>


<div class="viewcode-block" id="Session">
<a class="viewcode-back" href="../../../api/generated/pygmt.clib.Session.html#pygmt.clib.Session">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Session</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A GMT API session where most operations involving the C API happen.</span>

<span class="sd">    Works as a context manager (for use in a ``with`` block) to create a GMT C API</span>
<span class="sd">    session and destroy it in the end to clean up memory.</span>

<span class="sd">    Functions of the shared library are exposed as methods of this class. Most methods</span>
<span class="sd">    MUST be used with an open session (inside a ``with`` block). If creating GMT data</span>
<span class="sd">    structures to communicate data, put that code inside the same ``with`` block as the</span>
<span class="sd">    API calls that will use the data.</span>

<span class="sd">    By default, will let :mod:`ctypes` try to find the GMT shared library (``libgmt``).</span>
<span class="sd">    If the environment variable :term:`GMT_LIBRARY_PATH` is set, will look for the</span>
<span class="sd">    shared library in the directory specified by it.</span>

<span class="sd">    The ``session_pointer`` attribute holds a ctypes pointer to the currently open</span>
<span class="sd">    session.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    GMTCLibNotFoundError</span>
<span class="sd">        If there was any problem loading the library (couldn&#39;t find it or couldn&#39;t</span>
<span class="sd">        access the functions).</span>
<span class="sd">    GMTCLibNoSessionError</span>
<span class="sd">        If you try to call a method outside of a ``with`` block.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; from pygmt.clib import Session</span>
<span class="sd">    &gt;&gt;&gt; from pygmt.helpers.testing import load_static_earth_relief</span>
<span class="sd">    &gt;&gt;&gt; from pygmt.helpers import GMTTempFile</span>
<span class="sd">    &gt;&gt;&gt; grid = load_static_earth_relief()</span>
<span class="sd">    &gt;&gt;&gt; type(grid)</span>
<span class="sd">    &lt;class &#39;xarray.core.dataarray.DataArray&#39;&gt;</span>
<span class="sd">    &gt;&gt;&gt; # Create a session and destroy it automatically when exiting the &quot;with&quot; block.</span>
<span class="sd">    &gt;&gt;&gt; with Session() as lib:</span>
<span class="sd">    ...     # Create a virtual file and link to the memory block of the grid.</span>
<span class="sd">    ...     with lib.virtualfile_from_grid(grid) as fin:</span>
<span class="sd">    ...         # Create a temp file to use as output.</span>
<span class="sd">    ...         with GMTTempFile() as fout:</span>
<span class="sd">    ...             # Call the grdinfo module with the virtual file as input and the</span>
<span class="sd">    ...             # temp file as output.</span>
<span class="sd">    ...             lib.call_module(&quot;grdinfo&quot;, [fin, &quot;-C&quot;, f&quot;-&gt;{fout.name}&quot;])</span>
<span class="sd">    ...             # Read the contents of the temp file before it&#39;s deleted.</span>
<span class="sd">    ...             print(fout.read().strip())</span>
<span class="sd">    -55 -47 -24 -10 190 981 1 1 8 14 1 1</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">session_pointer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ctp</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The :class:`ctypes.c_void_p` pointer to the current open GMT session.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        GMTCLibNoSessionError</span>
<span class="sd">            If trying to access without a currently open GMT session (i.e., outside of</span>
<span class="sd">            the context manager).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_session_pointer&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;No currently open GMT API session.&quot;</span>
            <span class="k">raise</span> <span class="n">GMTCLibNoSessionError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session_pointer</span>

    <span class="nd">@session_pointer</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">session_pointer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">session</span><span class="p">:</span> <span class="n">ctp</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the session void pointer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_session_pointer</span> <span class="o">=</span> <span class="n">session</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dictionary with the GMT version and default paths and parameters.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_info&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_info</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default</span><span class="p">(</span><span class="s2">&quot;API_VERSION&quot;</span><span class="p">),</span>
                <span class="s2">&quot;padding&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default</span><span class="p">(</span><span class="s2">&quot;API_PAD&quot;</span><span class="p">),</span>
                <span class="c1"># API_BINDIR points to the directory of the Python interpreter</span>
                <span class="c1"># &quot;binary dir&quot;: self.get_default(&quot;API_BINDIR&quot;),</span>
                <span class="s2">&quot;share dir&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default</span><span class="p">(</span><span class="s2">&quot;API_SHAREDIR&quot;</span><span class="p">),</span>
                <span class="c1"># This segfaults for some reason</span>
                <span class="c1"># &#39;data dir&#39;: self.get_default(&quot;API_DATADIR&quot;),</span>
                <span class="s2">&quot;plugin dir&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default</span><span class="p">(</span><span class="s2">&quot;API_PLUGINDIR&quot;</span><span class="p">),</span>
                <span class="s2">&quot;library path&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default</span><span class="p">(</span><span class="s2">&quot;API_LIBRARY&quot;</span><span class="p">),</span>
                <span class="s2">&quot;cores&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default</span><span class="p">(</span><span class="s2">&quot;API_CORES&quot;</span><span class="p">),</span>
                <span class="s2">&quot;grid layout&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default</span><span class="p">(</span><span class="s2">&quot;API_GRID_LAYOUT&quot;</span><span class="p">),</span>
                <span class="s2">&quot;image layout&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default</span><span class="p">(</span><span class="s2">&quot;API_IMAGE_LAYOUT&quot;</span><span class="p">),</span>
                <span class="s2">&quot;binary version&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default</span><span class="p">(</span><span class="s2">&quot;API_BIN_VERSION&quot;</span><span class="p">),</span>
            <span class="p">}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info</span>

<div class="viewcode-block" id="Session.__enter__">
<a class="viewcode-back" href="../../../api/generated/pygmt.clib.Session.__enter__.html#pygmt.clib.Session.__enter__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a GMT API session.</span>

<span class="sd">        Calls :meth:`pygmt.clib.Session.create`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;pygmt-session&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>


<div class="viewcode-block" id="Session.__exit__">
<a class="viewcode-back" href="../../../api/generated/pygmt.clib.Session.__exit__.html#pygmt.clib.Session.__exit__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Destroy the currently open GMT API session.</span>

<span class="sd">        Calls :meth:`pygmt.clib.Session.destroy`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">destroy</span><span class="p">()</span></div>


<div class="viewcode-block" id="Session.__getitem__">
<a class="viewcode-back" href="../../../api/generated/pygmt.clib.Session.__getitem__.html#pygmt.clib.Session.__getitem__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the value of a GMT constant.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name</span>
<span class="sd">            The name of the constant (e.g., ``&quot;GMT_SESSION_EXTERNAL&quot;``).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        value</span>
<span class="sd">            Integer value of the constant. Do not rely on this value because it might</span>
<span class="sd">            change.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">GMT_CONSTANTS</span><span class="p">:</span>
            <span class="n">GMT_CONSTANTS</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_enum</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">GMT_CONSTANTS</span><span class="p">[</span><span class="n">name</span><span class="p">]</span></div>


<div class="viewcode-block" id="Session.get_enum">
<a class="viewcode-back" href="../../../api/generated/pygmt.clib.Session.get_enum.html#pygmt.clib.Session.get_enum">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_enum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the value of a GMT constant (C enum) from ``gmt_resources.h``.</span>

<span class="sd">        Used to set configuration values for other API calls. Wraps ``GMT_Get_Enum``.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name</span>
<span class="sd">            The name of the constant (e.g., ``&quot;GMT_SESSION_EXTERNAL&quot;``).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        value</span>
<span class="sd">            Integer value of the constant. Do not rely on this value because it might</span>
<span class="sd">            change.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        GMTCLibError</span>
<span class="sd">            If the constant doesn&#39;t exist.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">c_get_enum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_libgmt_func</span><span class="p">(</span>
            <span class="s2">&quot;GMT_Get_Enum&quot;</span><span class="p">,</span> <span class="n">argtypes</span><span class="o">=</span><span class="p">[</span><span class="n">ctp</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span> <span class="n">ctp</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">],</span> <span class="n">restype</span><span class="o">=</span><span class="n">ctp</span><span class="o">.</span><span class="n">c_int</span>
        <span class="p">)</span>

        <span class="c1"># The C library introduced the void API pointer to GMT_Get_Enum so that it&#39;s</span>
        <span class="c1"># consistent with other functions. It doesn&#39;t use the pointer so we can pass</span>
        <span class="c1"># in None (NULL pointer). We can&#39;t give it the actual pointer because we need</span>
        <span class="c1"># to call GMT_Get_Enum when creating a new API session pointer (chicken-and-egg</span>
        <span class="c1"># type of thing).</span>
        <span class="n">session</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">c_get_enum</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">name</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">value</span> <span class="o">==</span> <span class="o">-</span><span class="mi">99999</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Constant </span><span class="si">{</span><span class="n">name</span><span class="si">!r}</span><span class="s2"> doesn&#39;t exist in libgmt.&quot;</span>
            <span class="k">raise</span> <span class="n">GMTCLibError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span></div>


<div class="viewcode-block" id="Session.get_libgmt_func">
<a class="viewcode-back" href="../../../api/generated/pygmt.clib.Session.get_libgmt_func.html#pygmt.clib.Session.get_libgmt_func">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_libgmt_func</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">argtypes</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">restype</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get a ctypes function from the libgmt shared library.</span>

<span class="sd">        Assigns the argument and return type conversions for the function.</span>

<span class="sd">        Use this method to access a C function from libgmt.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name</span>
<span class="sd">            The name of the GMT API function.</span>
<span class="sd">        argtypes</span>
<span class="sd">            List of ctypes types used to convert the Python input arguments for the API</span>
<span class="sd">            function.</span>
<span class="sd">        restype : ctypes type</span>
<span class="sd">            The ctypes type used to convert the input returned by the function into a</span>
<span class="sd">            Python type.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        function</span>
<span class="sd">            The GMT API function.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from ctypes import c_void_p, c_int</span>
<span class="sd">        &gt;&gt;&gt; with Session() as lib:</span>
<span class="sd">        ...     func = lib.get_libgmt_func(</span>
<span class="sd">        ...         &quot;GMT_Destroy_Session&quot;, argtypes=[c_void_p], restype=c_int</span>
<span class="sd">        ...     )</span>
<span class="sd">        &gt;&gt;&gt; type(func)</span>
<span class="sd">        &lt;class &#39;ctypes.CDLL.__init__.&lt;locals&gt;._FuncPtr&#39;&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_libgmt&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_libgmt</span> <span class="o">=</span> <span class="n">_libgmt</span>
        <span class="n">function</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_libgmt</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">argtypes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">function</span><span class="o">.</span><span class="n">argtypes</span> <span class="o">=</span> <span class="n">argtypes</span>
        <span class="k">if</span> <span class="n">restype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">function</span><span class="o">.</span><span class="n">restype</span> <span class="o">=</span> <span class="n">restype</span>
        <span class="k">return</span> <span class="n">function</span></div>


<div class="viewcode-block" id="Session.create">
<a class="viewcode-back" href="../../../api/generated/pygmt.clib.Session.create.html#pygmt.clib.Session.create">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new GMT C API session.</span>

<span class="sd">        This is required before most other methods of :class:`pygmt.clib.Session` can be</span>
<span class="sd">        called.</span>

<span class="sd">        .. warning::</span>

<span class="sd">            Usage of :class:`pygmt.clib.Session` as a context manager in a ``with``</span>
<span class="sd">            block is preferred over calling :meth:`pygmt.clib.Session.create` and</span>
<span class="sd">            :meth:`pygmt.clib.Session.destroy` manually.</span>

<span class="sd">        Calls ``GMT_Create_Session`` and generates a new ``GMTAPI_CTRL`` struct, which</span>
<span class="sd">        is a :class:`ctypes.c_void_p` pointer. Sets the ``session_pointer`` attribute to</span>
<span class="sd">        this pointer.</span>

<span class="sd">        Remember to terminate the current session using</span>
<span class="sd">        :meth:`pygmt.clib.Session.destroy` before creating a new one.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name</span>
<span class="sd">            A name for this session. Doesn&#39;t really affect the outcome.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check if there is a currently open session by accessing the &quot;session_pointer&quot;</span>
        <span class="c1"># attribute. If not, it will raise the GMTCLibNoSessionError exception and we&#39;re</span>
        <span class="c1"># free to create a new one. Otherwise, we will raise a GMTCLibError exception.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">session_pointer</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;Failed to create a GMT API session: &quot;</span>
                <span class="s2">&quot;There is currently an open session. Must destroy it first.&quot;</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="n">GMTCLibError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">GMTCLibNoSessionError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="n">c_create_session</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_libgmt_func</span><span class="p">(</span>
            <span class="s2">&quot;GMT_Create_Session&quot;</span><span class="p">,</span>
            <span class="n">argtypes</span><span class="o">=</span><span class="p">[</span><span class="n">ctp</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">,</span> <span class="n">ctp</span><span class="o">.</span><span class="n">c_uint</span><span class="p">,</span> <span class="n">ctp</span><span class="o">.</span><span class="n">c_uint</span><span class="p">,</span> <span class="n">ctp</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">],</span>
            <span class="n">restype</span><span class="o">=</span><span class="n">ctp</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Capture the output printed by GMT into this list. Will use it later to</span>
        <span class="c1"># generate error messages for the exceptions raised by API calls.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_error_log</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="nd">@ctp</span><span class="o">.</span><span class="n">CFUNCTYPE</span><span class="p">(</span><span class="n">ctp</span><span class="o">.</span><span class="n">c_int</span><span class="p">,</span> <span class="n">ctp</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span> <span class="n">ctp</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">)</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">print_func</span><span class="p">(</span><span class="n">file_pointer</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>  <span class="c1"># noqa: ARG001</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Callback function that the GMT C API will use to print log and error</span>
<span class="sd">            messages.</span>

<span class="sd">            We&#39;ll capture the messages and print them to stderr so that they will show</span>
<span class="sd">            up on the Jupyter notebook.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="c1"># TODO(GMT&gt;6.5.0): Remove the workaround for upstream bug in GMT&lt;=6.5.0.</span>
            <span class="c1"># Have to use try..except due to upstream GMT bug in GMT&lt;=6.5.0.</span>
            <span class="c1"># See https://github.com/GenericMappingTools/pygmt/issues/3205.</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_error_log</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
            <span class="c1"># Flush to make sure the messages are printed even if we have a crash.</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># noqa: T201</span>
            <span class="k">return</span> <span class="mi">0</span>

        <span class="c1"># Need to store a copy of the function because ctypes doesn&#39;t and it will be</span>
        <span class="c1"># garbage collected otherwise</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_print_callback</span> <span class="o">=</span> <span class="n">print_func</span>

        <span class="n">padding</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;GMT_PAD_DEFAULT&quot;</span><span class="p">]</span>
        <span class="c1"># GMT_SESSION_EXTERNAL: GMT is called by an external wrapper.</span>
        <span class="c1"># GMT_SESSION_NOGDALCLOSE: Do not call GDALDestroyDriverManager when using GDAL.</span>
        <span class="n">session_type</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;GMT_SESSION_EXTERNAL&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;GMT_SESSION_NOGDALCLOSE&quot;</span><span class="p">]</span>
        <span class="n">session</span> <span class="o">=</span> <span class="n">c_create_session</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="n">padding</span><span class="p">,</span> <span class="n">session_type</span><span class="p">,</span> <span class="n">print_func</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">session</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Failed to create a GMT API session:</span><span class="se">\n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_error_message</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">raise</span> <span class="n">GMTCLibError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">session_pointer</span> <span class="o">=</span> <span class="n">session</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_error_message</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A string with all error messages emitted by the C API.</span>

<span class="sd">        Only includes messages with the string ``&quot;[ERROR]&quot;`` in them.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_error_log&quot;</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_error_log</span> <span class="k">if</span> <span class="s2">&quot;[ERROR]&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">msg</span>

<div class="viewcode-block" id="Session.destroy">
<a class="viewcode-back" href="../../../api/generated/pygmt.clib.Session.destroy.html#pygmt.clib.Session.destroy">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">destroy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Destroy the currently open GMT API session.</span>

<span class="sd">        .. warning::</span>

<span class="sd">            Usage of :class:`pygmt.clib.Session` as a context manager in a ``with``</span>
<span class="sd">            block is preferred over calling :meth:`pygmt.clib.Session.create` and</span>
<span class="sd">            :meth:`pygmt.clib.Session.destroy` manually.</span>

<span class="sd">        Calls ``GMT_Destroy_Session`` to terminate and free the memory of a registered</span>
<span class="sd">        ``GMTAPI_CTRL`` session (the pointer for this struct is stored in the</span>
<span class="sd">        ``session_pointer`` attribute).</span>

<span class="sd">        Always use this method after you are done using a C API session. The session</span>
<span class="sd">        needs to be destroyed before creating a new one. Otherwise, some of the</span>
<span class="sd">        configuration files might be left behind and can influence subsequent API calls.</span>

<span class="sd">        Sets the ``session_pointer`` attribute to ``None``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">c_destroy_session</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_libgmt_func</span><span class="p">(</span>
            <span class="s2">&quot;GMT_Destroy_Session&quot;</span><span class="p">,</span> <span class="n">argtypes</span><span class="o">=</span><span class="p">[</span><span class="n">ctp</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">],</span> <span class="n">restype</span><span class="o">=</span><span class="n">ctp</span><span class="o">.</span><span class="n">c_int</span>
        <span class="p">)</span>

        <span class="n">status</span> <span class="o">=</span> <span class="n">c_destroy_session</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session_pointer</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Failed to destroy GMT API session:</span><span class="se">\n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_error_message</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">raise</span> <span class="n">GMTCLibError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">session_pointer</span> <span class="o">=</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="Session.get_default">
<a class="viewcode-back" href="../../../api/generated/pygmt.clib.Session.get_default.html#pygmt.clib.Session.get_default">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the value of a GMT configuration parameter or a GMT API parameter.</span>

<span class="sd">        In addition to the long list of GMT configuration parameters, the following API</span>
<span class="sd">        parameter names are also supported:</span>

<span class="sd">        * ``&quot;API_VERSION&quot;``: The GMT API version</span>
<span class="sd">        * ``&quot;API_PAD&quot;``: The grid padding setting</span>
<span class="sd">        * ``&quot;API_BINDIR&quot;``: The binary file directory</span>
<span class="sd">        * ``&quot;API_SHAREDIR&quot;``: The share directory</span>
<span class="sd">        * ``&quot;API_DATADIR&quot;``: The data directory</span>
<span class="sd">        * ``&quot;API_PLUGINDIR&quot;``: The plugin directory</span>
<span class="sd">        * ``&quot;API_LIBRARY&quot;``: The core library path</span>
<span class="sd">        * ``&quot;API_CORES&quot;``: The number of cores</span>
<span class="sd">        * ``&quot;API_IMAGE_LAYOUT&quot;``: The image/band layout</span>
<span class="sd">        * ``&quot;API_GRID_LAYOUT&quot;``: The grid layout</span>
<span class="sd">        * ``&quot;API_BIN_VERSION&quot;``: The GMT binary version (with git information)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name</span>
<span class="sd">            The name of the GMT configuration parameter (e.g., ``&quot;PROJ_LENGTH_UNIT&quot;``)</span>
<span class="sd">            or a GMT API parameter (e.g., ``&quot;API_VERSION&quot;``).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        value</span>
<span class="sd">            The current value for the parameter.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        GMTCLibError</span>
<span class="sd">            If the parameter doesn&#39;t exist.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">c_get_default</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_libgmt_func</span><span class="p">(</span>
            <span class="s2">&quot;GMT_Get_Default&quot;</span><span class="p">,</span>
            <span class="n">argtypes</span><span class="o">=</span><span class="p">[</span><span class="n">ctp</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span> <span class="n">ctp</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">,</span> <span class="n">ctp</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">],</span>
            <span class="n">restype</span><span class="o">=</span><span class="n">ctp</span><span class="o">.</span><span class="n">c_int</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Make a string buffer to get a return value</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">ctp</span><span class="o">.</span><span class="n">create_string_buffer</span><span class="p">(</span><span class="mi">4096</span><span class="p">)</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">c_get_default</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session_pointer</span><span class="p">,</span> <span class="n">name</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Error getting value for </span><span class="si">{</span><span class="n">name</span><span class="si">!r}</span><span class="s2"> (error code </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">).&quot;</span>
            <span class="k">raise</span> <span class="n">GMTCLibError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span></div>


<div class="viewcode-block" id="Session.get_common">
<a class="viewcode-back" href="../../../api/generated/pygmt.clib.Session.get_common.html#pygmt.clib.Session.get_common">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_common</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">option</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Inquire if a GMT common option has been set and return its current value if</span>
<span class="sd">        possible.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        option</span>
<span class="sd">            The GMT common option to check. Valid options are ``&quot;B&quot;``, ``&quot;I&quot;``, ``&quot;J&quot;``,</span>
<span class="sd">            ``&quot;R&quot;``, ``&quot;U&quot;``, ``&quot;V&quot;``, ``&quot;X&quot;``, ``&quot;Y&quot;``, ``&quot;a&quot;``, ``&quot;b&quot;``, ``&quot;f&quot;``,</span>
<span class="sd">            ``&quot;g&quot;``, ``&quot;h&quot;``, ``&quot;i&quot;``, ``&quot;n&quot;``, ``&quot;o&quot;``, ``&quot;p&quot;``, ``&quot;r&quot;``, ``&quot;s&quot;``,</span>
<span class="sd">            ``&quot;t&quot;``, and ``&quot;:&quot;``.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        value</span>
<span class="sd">            Whether the option was set or its value. If the option was not set, return</span>
<span class="sd">            ``False``. Otherwise, the return value depends on the choice of the option.</span>

<span class="sd">            - options ``&quot;B&quot;``, ``&quot;J&quot;``, ``&quot;U&quot;``, ``&quot;g&quot;``, ``&quot;n&quot;``, ``&quot;p&quot;``, and ``&quot;s&quot;``:</span>
<span class="sd">              return ``True`` if set, else ``False`` (bool)</span>
<span class="sd">            - ``&quot;I&quot;``: 2-element array for the increments (float)</span>
<span class="sd">            - ``&quot;R&quot;``: 4-element array for the region (float)</span>
<span class="sd">            - ``&quot;V&quot;``: the verbose level (int)</span>
<span class="sd">            - ``&quot;X&quot;``: the xshift (float)</span>
<span class="sd">            - ``&quot;Y&quot;``: the yshift (float)</span>
<span class="sd">            - ``&quot;a&quot;``: geometry of the dataset (int)</span>
<span class="sd">            - ``&quot;b&quot;``: return 0 if ``-bi`` was set and 1 if ``-bo`` was set (int)</span>
<span class="sd">            - ``&quot;f&quot;``: return 0 if ``-fi`` was set and 1 if ``-fo`` was set (int)</span>
<span class="sd">            - ``&quot;h&quot;``: whether to delete existing header records (int)</span>
<span class="sd">            - ``&quot;i&quot;``: number of input columns (int)</span>
<span class="sd">            - ``&quot;o&quot;``: number of output columns (int)</span>
<span class="sd">            - ``&quot;r&quot;``: registration type (int)</span>
<span class="sd">            - ``&quot;t&quot;``: 2-element array for the transparency (float)</span>
<span class="sd">            - ``&quot;:&quot;``: return 0 if ``-:i`` was set and 1 if ``-:o`` was set (int)</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; with Session() as lib:</span>
<span class="sd">        ...     lib.call_module(</span>
<span class="sd">        ...         &quot;basemap&quot;, [&quot;-R0/10/10/15&quot;, &quot;-JX5i/2.5i&quot;, &quot;-Baf&quot;, &quot;-Ve&quot;]</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     region = lib.get_common(&quot;R&quot;)</span>
<span class="sd">        ...     projection = lib.get_common(&quot;J&quot;)</span>
<span class="sd">        ...     timestamp = lib.get_common(&quot;U&quot;)</span>
<span class="sd">        ...     verbose = lib.get_common(&quot;V&quot;)</span>
<span class="sd">        ...     lib.call_module(&quot;plot&quot;, [&quot;-T&quot;, &quot;-Xw+1i&quot;, &quot;-Yh-1i&quot;])</span>
<span class="sd">        ...     xshift = lib.get_common(&quot;X&quot;)  # xshift/yshift are in inches</span>
<span class="sd">        ...     yshift = lib.get_common(&quot;Y&quot;)</span>
<span class="sd">        &gt;&gt;&gt; print(region, projection, timestamp, verbose, xshift, yshift)</span>
<span class="sd">        [ 0. 10. 10. 15.] True False 3 6.0 1.5</span>
<span class="sd">        &gt;&gt;&gt; with Session() as lib:</span>
<span class="sd">        ...     lib.call_module(&quot;basemap&quot;, [&quot;-R0/10/10/15&quot;, &quot;-JX5i/2.5i&quot;, &quot;-Baf&quot;])</span>
<span class="sd">        ...     lib.get_common(&quot;A&quot;)</span>
<span class="sd">        Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">        pygmt.exceptions.GMTValueError: Invalid GMT common option: &#39;A&#39;. Expected ...</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">valid_options</span> <span class="o">=</span> <span class="s2">&quot;BIJRUVXYabfghinoprst:&quot;</span>
        <span class="k">if</span> <span class="n">option</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_options</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">GMTValueError</span><span class="p">(</span>
                <span class="n">option</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;GMT common option&quot;</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">valid_options</span>
            <span class="p">)</span>

        <span class="n">c_get_common</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_libgmt_func</span><span class="p">(</span>
            <span class="s2">&quot;GMT_Get_Common&quot;</span><span class="p">,</span>
            <span class="n">argtypes</span><span class="o">=</span><span class="p">[</span><span class="n">ctp</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span> <span class="n">ctp</span><span class="o">.</span><span class="n">c_uint</span><span class="p">,</span> <span class="n">ctp</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctp</span><span class="o">.</span><span class="n">c_double</span><span class="p">)],</span>
            <span class="n">restype</span><span class="o">=</span><span class="n">ctp</span><span class="o">.</span><span class="n">c_int</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>  <span class="c1"># numpy array to store the value of the option</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">c_get_common</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">session_pointer</span><span class="p">,</span>
            <span class="nb">ord</span><span class="p">(</span><span class="n">option</span><span class="p">),</span>
            <span class="n">value</span><span class="o">.</span><span class="n">ctypes</span><span class="o">.</span><span class="n">data_as</span><span class="p">(</span><span class="n">ctp</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctp</span><span class="o">.</span><span class="n">c_double</span><span class="p">)),</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;GMT_NOTSET&quot;</span><span class="p">]:</span>  <span class="c1"># GMT_NOTSET (-1) means the option is not set</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Option is set and no other value is returned.</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="c1"># Otherwise, option is set and values are returned.</span>
        <span class="k">match</span> <span class="n">option</span><span class="p">:</span>
            <span class="k">case</span> <span class="s2">&quot;I&quot;</span> <span class="o">|</span> <span class="s2">&quot;R&quot;</span> <span class="o">|</span> <span class="s2">&quot;t&quot;</span><span class="p">:</span>
                <span class="c1"># Option values (in double type) are returned via the &#39;value&#39; array.</span>
                <span class="c1"># &#39;status&#39; is number of valid values in the array.</span>
                <span class="k">return</span> <span class="n">value</span><span class="p">[:</span><span class="n">status</span><span class="p">]</span>
            <span class="k">case</span> <span class="s2">&quot;X&quot;</span> <span class="o">|</span> <span class="s2">&quot;Y&quot;</span><span class="p">:</span>  <span class="c1"># Only one valid element in the array.</span>
                <span class="k">return</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>  <span class="c1"># &#39;status&#39; is the option value (in integer type).</span>
                <span class="k">return</span> <span class="n">status</span></div>


<div class="viewcode-block" id="Session.call_module">
<a class="viewcode-back" href="../../../api/generated/pygmt.clib.Session.call_module.html#pygmt.clib.Session.call_module">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">call_module</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call a GMT module with the given arguments.</span>

<span class="sd">        Wraps ``GMT_Call_Module``.</span>

<span class="sd">        The ``GMT_Call_Module`` API function supports passing module arguments in three</span>
<span class="sd">        different ways:</span>

<span class="sd">        1. Pass a single string that contains whitespace-separated module arguments.</span>
<span class="sd">        2. Pass a list of strings and each string contains a module argument.</span>
<span class="sd">        3. Pass a list of ``GMT_OPTION`` data structure.</span>

<span class="sd">        Both options 1 and 2 are implemented in this function, but option 2 is preferred</span>
<span class="sd">        because it can correctly handle special characters like whitespaces and</span>
<span class="sd">        quotation marks in module arguments.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        module</span>
<span class="sd">            The GMT module name to be called (``&quot;coast&quot;``, ``&quot;basemap&quot;``, etc).</span>
<span class="sd">        args</span>
<span class="sd">            Module arguments that will be passed to the GMT module. It can be either</span>
<span class="sd">            a single string (e.g., ``&quot;-R0/5/0/10 -JX10c -BWSen+t&#39;My Title&#39;&quot;``) or a list</span>
<span class="sd">            of strings (e.g., ``[&quot;-R0/5/0/10&quot;, &quot;-JX10c&quot;, &quot;-BWSEN+tMy Title&quot;]``).</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        GMTTypeError</span>
<span class="sd">            If the ``args`` argument is not a string or a list of strings.</span>
<span class="sd">        GMTCLibError</span>
<span class="sd">            If the returned status code of the function is non-zero.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">c_call_module</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_libgmt_func</span><span class="p">(</span>
            <span class="s2">&quot;GMT_Call_Module&quot;</span><span class="p">,</span>
            <span class="n">argtypes</span><span class="o">=</span><span class="p">[</span><span class="n">ctp</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span> <span class="n">ctp</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">,</span> <span class="n">ctp</span><span class="o">.</span><span class="n">c_int</span><span class="p">,</span> <span class="n">ctp</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">],</span>
            <span class="n">restype</span><span class="o">=</span><span class="n">ctp</span><span class="o">.</span><span class="n">c_int</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># &#39;args&#39; can be (1) a single string or (2) a list of strings.</span>
        <span class="n">argv</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">|</span> <span class="n">ctp</span><span class="o">.</span><span class="n">Array</span><span class="p">[</span><span class="n">ctp</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="c1"># &#39;args&#39; is a list of strings and each string contains a module argument.</span>
            <span class="c1"># In this way, GMT can correctly handle option arguments with whitespaces or</span>
            <span class="c1"># quotation marks. This is the preferred way to pass arguments to the GMT</span>
            <span class="c1"># API and is used for PyGMT &gt;= v0.12.0.</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>  <span class="c1"># &#39;mode&#39; is the number of arguments.</span>
            <span class="c1"># Pass a null pointer if no arguments are specified.</span>
            <span class="n">argv</span> <span class="o">=</span> <span class="n">strings_to_ctypes_array</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="k">if</span> <span class="n">mode</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="c1"># &#39;args&#39; is a single string that contains whitespace-separated arguments.</span>
            <span class="c1"># In this way, we need to correctly handle option arguments that contain</span>
            <span class="c1"># whitespaces or quotation marks. It&#39;s used in PyGMT &lt;= v0.11.0 but is no</span>
            <span class="c1"># longer recommended.</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;GMT_MODULE_CMD&quot;</span><span class="p">]</span>
            <span class="n">argv</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">GMTTypeError</span><span class="p">(</span>
                <span class="nb">type</span><span class="p">(</span><span class="n">args</span><span class="p">),</span>
                <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;Parameter &#39;args&#39; must either be a list of strings (recommended) or a string.&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">status</span> <span class="o">=</span> <span class="n">c_call_module</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session_pointer</span><span class="p">,</span> <span class="n">module</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span> <span class="n">mode</span><span class="p">,</span> <span class="n">argv</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Module </span><span class="si">{</span><span class="n">module</span><span class="si">!r}</span><span class="s2"> failed with status code </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_error_message</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">raise</span> <span class="n">GMTCLibError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>


<div class="viewcode-block" id="Session.create_data">
<a class="viewcode-back" href="../../../api/generated/pygmt.clib.Session.create_data.html#pygmt.clib.Session.create_data">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">create_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">family</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">geometry</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">dim</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ranges</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">inc</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">registration</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span>
            <span class="s2">&quot;GMT_GRID_NODE_REG&quot;</span><span class="p">,</span> <span class="s2">&quot;GMT_GRID_PIXEL_REG&quot;</span>
        <span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;GMT_GRID_NODE_REG&quot;</span><span class="p">,</span>
        <span class="n">pad</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ctp</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create an empty GMT data container and allocate space to hold data.</span>

<span class="sd">        Valid data families and geometries are in ``FAMILIES`` and ``GEOMETRIES``.</span>

<span class="sd">        There are two ways to define the dimensions needed to actually allocate memory:</span>

<span class="sd">        1. Via ``ranges``, ``inc`` and ``registration``.</span>
<span class="sd">        2. Via ``dim`` and ``registration``.</span>

<span class="sd">           ``dim`` contains up to 4 values and they have different meanings for</span>
<span class="sd">           different GMT data families:</span>

<span class="sd">           For ``GMT_DATASET``:</span>

<span class="sd">           - 0: number of tables</span>
<span class="sd">           - 1: number of segments per table</span>
<span class="sd">           - 2: number of rows per segment</span>
<span class="sd">           - 3: number of columns per row</span>

<span class="sd">           For ``GMT_VECTOR``:</span>

<span class="sd">           - 0: number of columns</span>
<span class="sd">           - 1: number of rows [optional, can be 0 if unknown]</span>
<span class="sd">           - 2: data type (e.g., ``GMT_DOUBLE``) [Will be overwritten by ``put_vector``]</span>

<span class="sd">           For ``GMT_GRID``/``GMT_IMAGE``/``GMT_CUBE``/``GMT_MATRIX``:</span>

<span class="sd">           - 0: number of columns</span>
<span class="sd">           - 1: number of rows</span>
<span class="sd">           - 2: number of bands or layers [Ignored for ``GMT_GRID``]</span>
<span class="sd">           - 3: data type (e.g., ``GMT_DOUBLE``) [For ``GMT_MATRIX`` only, but will be</span>
<span class="sd">             overwritten by ``put_matrix``]</span>

<span class="sd">           In other words, ``inc`` is assumed to be 1.0, and ``ranges`` is</span>
<span class="sd">           [0, dim[0], 0, dim[1]] for pixel registration or</span>
<span class="sd">           [0, dim[0]-1.0, 0, dim[1]-1.0] for grid registration.</span>


<span class="sd">        When creating a grid/image/cube, you can do it in one or two steps:</span>

<span class="sd">        1. Call this function with ``mode=&quot;GMT_CONTAINER_AND_DATA&quot;``. This creates</span>
<span class="sd">           a header and allocates a grid or an image</span>
<span class="sd">        2. Call this function twice:</span>

<span class="sd">           1. First with ``mode=&quot;GMT_CONTAINER_ONLY&quot;``, to create a header only and</span>
<span class="sd">              compute the dimensions based on other parameters</span>
<span class="sd">           2. Second with ``mode=&quot;GMT_DATA_ONLY&quot;``, to allocate the grid/image/cube</span>
<span class="sd">              array based on the dimensions already set. This time, you pass NULL for</span>
<span class="sd">              ``dim``/``ranges``/``inc``/``registration``/``pad`` and let ``data`` be</span>
<span class="sd">              the void pointer returned in the first step.</span>

<span class="sd">           **Note**: This is not implemented yet, since this function doesn&#39;t have the</span>
<span class="sd">           ``data`` parameter.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        family</span>
<span class="sd">            A valid GMT data family name (e.g., ``&quot;GMT_IS_DATASET&quot;``). See ``FAMILIES``</span>
<span class="sd">            for valid names.</span>
<span class="sd">        geometry</span>
<span class="sd">            A valid GMT data geometry name (e.g., ``&quot;GMT_IS_POINT&quot;``). See</span>
<span class="sd">            ``GEOMETRIES`` for valid names.</span>
<span class="sd">        mode</span>
<span class="sd">            A valid GMT data mode. See ``MODES`` for valid names. For</span>
<span class="sd">            ``GMT_IS_DATASET``/``GMT_IS_MATRIX``/``GMT_IS_VECTOR``, adding</span>
<span class="sd">            ``GMT_WITH_STRINGS`` to the ``mode`` will allocate the corresponding arrays</span>
<span class="sd">            of string pointers.</span>
<span class="sd">        dim</span>
<span class="sd">            The dimensions of the dataset, as explained above. If ``None``, will pass in</span>
<span class="sd">            the NULL pointer.</span>
<span class="sd">        ranges</span>
<span class="sd">            The data extent.</span>
<span class="sd">        inc</span>
<span class="sd">            The increments between points of the dataset.</span>
<span class="sd">        registration</span>
<span class="sd">            The node registration. Can be ``&quot;GMT_GRID_PIXEL_REG&quot;`` or</span>
<span class="sd">            ``&quot;GMT_GRID_NODE_REG&quot;``.</span>
<span class="sd">        pad</span>
<span class="sd">            The padding for ``GMT_IS_GRID``/``GMT_IS_IMAGE``/``GMT_IS_CUBE``. If</span>
<span class="sd">            ``None``, defaults to ``&quot;GMT_PAD_DEFAULT&quot;``.</span>

<span class="sd">            For ``GMT_IS_MATRIX``, it can be:</span>

<span class="sd">            - 0: default row/col orientation [Default]</span>
<span class="sd">            - 1: row-major format (C)</span>
<span class="sd">            - 2: column-major format (FORTRAN)</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        data_ptr</span>
<span class="sd">            A ctypes pointer (an integer) to the allocated GMT data container.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">c_create_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_libgmt_func</span><span class="p">(</span>
            <span class="s2">&quot;GMT_Create_Data&quot;</span><span class="p">,</span>
            <span class="n">argtypes</span><span class="o">=</span><span class="p">[</span>
                <span class="n">ctp</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span>  <span class="c1"># API</span>
                <span class="n">ctp</span><span class="o">.</span><span class="n">c_uint</span><span class="p">,</span>  <span class="c1"># family</span>
                <span class="n">ctp</span><span class="o">.</span><span class="n">c_uint</span><span class="p">,</span>  <span class="c1"># geometry</span>
                <span class="n">ctp</span><span class="o">.</span><span class="n">c_uint</span><span class="p">,</span>  <span class="c1"># mode</span>
                <span class="n">ctp</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctp</span><span class="o">.</span><span class="n">c_uint64</span><span class="p">),</span>  <span class="c1"># dim</span>
                <span class="n">ctp</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctp</span><span class="o">.</span><span class="n">c_double</span><span class="p">),</span>  <span class="c1"># range</span>
                <span class="n">ctp</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctp</span><span class="o">.</span><span class="n">c_double</span><span class="p">),</span>  <span class="c1"># inc</span>
                <span class="n">ctp</span><span class="o">.</span><span class="n">c_uint</span><span class="p">,</span>  <span class="c1"># registration</span>
                <span class="n">ctp</span><span class="o">.</span><span class="n">c_int</span><span class="p">,</span>  <span class="c1"># pad</span>
                <span class="n">ctp</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span>  <span class="c1"># data</span>
            <span class="p">],</span>
            <span class="n">restype</span><span class="o">=</span><span class="n">ctp</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">family_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_constant</span><span class="p">(</span><span class="n">family</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="n">FAMILIES</span><span class="p">,</span> <span class="n">valid_modifiers</span><span class="o">=</span><span class="n">VIAS</span><span class="p">)</span>
        <span class="n">mode_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_constant</span><span class="p">(</span>
            <span class="n">mode</span><span class="p">,</span>
            <span class="n">valid</span><span class="o">=</span><span class="n">MODES</span><span class="p">,</span>
            <span class="n">valid_modifiers</span><span class="o">=</span><span class="n">MODE_MODIFIERS</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">geometry_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_constant</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="n">GEOMETRIES</span><span class="p">)</span>
        <span class="n">registration_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_constant</span><span class="p">(</span><span class="n">registration</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="n">REGISTRATIONS</span><span class="p">)</span>

        <span class="c1"># Convert dim, ranges, and inc to ctypes arrays if given (will be None if not</span>
        <span class="c1"># given to represent NULL pointers)</span>
        <span class="n">dim_ctp</span> <span class="o">=</span> <span class="n">sequence_to_ctypes_array</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">ctp</span><span class="o">.</span><span class="n">c_uint64</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">ranges_ctp</span> <span class="o">=</span> <span class="n">sequence_to_ctypes_array</span><span class="p">(</span><span class="n">ranges</span><span class="p">,</span> <span class="n">ctp</span><span class="o">.</span><span class="n">c_double</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">inc_ctp</span> <span class="o">=</span> <span class="n">sequence_to_ctypes_array</span><span class="p">(</span><span class="n">inc</span><span class="p">,</span> <span class="n">ctp</span><span class="o">.</span><span class="n">c_double</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

        <span class="c1"># Use a NULL pointer (None) for existing data to indicate that the container</span>
        <span class="c1"># should be created empty. Fill it in later using put_vector and put_matrix.</span>
        <span class="n">data_ptr</span> <span class="o">=</span> <span class="n">c_create_data</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">session_pointer</span><span class="p">,</span>
            <span class="n">family_int</span><span class="p">,</span>
            <span class="n">geometry_int</span><span class="p">,</span>
            <span class="n">mode_int</span><span class="p">,</span>
            <span class="n">dim_ctp</span><span class="p">,</span>
            <span class="n">ranges_ctp</span><span class="p">,</span>
            <span class="n">inc_ctp</span><span class="p">,</span>
            <span class="n">registration_int</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parse_pad</span><span class="p">(</span><span class="n">family</span><span class="p">,</span> <span class="n">pad</span><span class="p">),</span>
            <span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">data_ptr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Failed to create an empty GMT data pointer.&quot;</span>
            <span class="k">raise</span> <span class="n">GMTCLibError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">data_ptr</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_pad</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">family</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">pad</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parse and return an appropriate value for pad if ``None`` is given.</span>

<span class="sd">        Pad is a bit tricky because, for matrix types, pad control the matrix ordering</span>
<span class="sd">        (row or column major). Using the default pad will set it to column major and</span>
<span class="sd">        mess things up with the numpy arrays.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">pad</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pad</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="s2">&quot;MATRIX&quot;</span> <span class="ow">in</span> <span class="n">family</span> <span class="k">else</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;GMT_PAD_DEFAULT&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">pad</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_constant</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">constant</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">valid</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">valid_modifiers</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parse a constant, convert it to an integer, and validate it.</span>

<span class="sd">        The GMT C API takes certain defined constants, like ``&quot;GMT_IS_GRID&quot;``, that need</span>
<span class="sd">        to be validated and converted to integer values using</span>
<span class="sd">        :meth:`pygmt.clib.Session.__getitem__`.</span>

<span class="sd">        The constants can also take a modifier by appending another constant name, e.g.,</span>
<span class="sd">        ``&quot;GMT_IS_GRID|GMT_VIA_MATRIX&quot;``. The two parts must be converted separately and</span>
<span class="sd">        their values are added.</span>

<span class="sd">        If no valid modifiers are given, then will assume that modifiers are not</span>
<span class="sd">        allowed. In this case, will raise a :class:`pygmt.exceptions.GMTValueError`</span>
<span class="sd">        exception if given a modifier.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        constant</span>
<span class="sd">            The name of a valid GMT API constant, with an optional modifier.</span>
<span class="sd">        valid</span>
<span class="sd">            A list of valid values for the constant. Will raise a GMTValueError</span>
<span class="sd">            exception if the given value is not in the list.</span>
<span class="sd">        valid_modifiers</span>
<span class="sd">            A list of valid modifiers that can be added to the constant. If ``None``,</span>
<span class="sd">            no modifiers are allowed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parts</span> <span class="o">=</span> <span class="n">constant</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">nmodifiers</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">GMTValueError</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;constant name&quot;</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">valid</span><span class="p">)</span>

        <span class="k">match</span> <span class="n">nmodifiers</span><span class="p">:</span>
            <span class="k">case</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">valid_modifiers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">GMTValueError</span><span class="p">(</span>
                    <span class="n">constant</span><span class="p">,</span>
                    <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;Constant modifiers are not allowed since valid values were not given.&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">case</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">valid_modifiers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_modifiers</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">GMTValueError</span><span class="p">(</span>
                    <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;constant modifier&quot;</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">valid_modifiers</span>
                <span class="p">)</span>
            <span class="k">case</span> <span class="n">n</span> <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">GMTValueError</span><span class="p">(</span>
                    <span class="n">constant</span><span class="p">,</span>
                    <span class="n">reason</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Only one modifier is allowed in constants but </span><span class="si">{</span><span class="n">nmodifiers</span><span class="si">}</span><span class="s2"> given.&quot;</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="n">integer_value</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">part</span><span class="p">]</span> <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">parts</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">integer_value</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_check_dtype_and_dim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">ndim</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check that a numpy array has the given number of dimensions and is a valid data</span>
<span class="sd">        type.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        array</span>
<span class="sd">            The array to be tested.</span>
<span class="sd">        ndim</span>
<span class="sd">            The desired number of array dimensions.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        gmt_type</span>
<span class="sd">            The GMT constant value representing this data type.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        GMTValueError</span>
<span class="sd">            If the array has the wrong number of dimensions.</span>
<span class="sd">        GMTTypeError</span>
<span class="sd">            If the array is an unsupported data type.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; data = np.array([1, 2, 3], dtype=np.float64)</span>
<span class="sd">        &gt;&gt;&gt; with Session() as lib:</span>
<span class="sd">        ...     gmttype = lib._check_dtype_and_dim(data, ndim=1)</span>
<span class="sd">        ...     gmttype == lib[&quot;GMT_DOUBLE&quot;]</span>
<span class="sd">        True</span>
<span class="sd">        &gt;&gt;&gt; data = np.ones((5, 2), dtype=np.float32)</span>
<span class="sd">        &gt;&gt;&gt; with Session() as lib:</span>
<span class="sd">        ...     gmttype = lib._check_dtype_and_dim(data, ndim=2)</span>
<span class="sd">        ...     gmttype == lib[&quot;GMT_FLOAT&quot;]</span>
<span class="sd">        True</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check that the array has the given number of dimensions.</span>
        <span class="k">if</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="n">ndim</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">GMTValueError</span><span class="p">(</span>
                <span class="n">array</span><span class="o">.</span><span class="n">ndim</span><span class="p">,</span>
                <span class="n">description</span><span class="o">=</span><span class="s2">&quot;array dimension&quot;</span><span class="p">,</span>
                <span class="n">reason</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Expected a numpy </span><span class="si">{</span><span class="n">ndim</span><span class="si">}</span><span class="s2">-D array, got </span><span class="si">{</span><span class="n">array</span><span class="o">.</span><span class="n">ndim</span><span class="si">}</span><span class="s2">-D.&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># 1-D arrays can be numeric or text, 2-D arrays can only be numeric.</span>
        <span class="n">valid_dtypes</span> <span class="o">=</span> <span class="n">DTYPES</span> <span class="k">if</span> <span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">DTYPES_NUMERIC</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">dtype</span> <span class="o">:=</span> <span class="n">array</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_dtypes</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">GMTTypeError</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">DTYPES</span><span class="p">[</span><span class="n">dtype</span><span class="p">]]</span>

<div class="viewcode-block" id="Session.put_vector">
<a class="viewcode-back" href="../../../api/generated/pygmt.clib.Session.put_vector.html#pygmt.clib.Session.put_vector">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">put_vector</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">:</span> <span class="n">ctp</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span> <span class="n">column</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">vector</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attach a 1-D numpy array as a column on a GMT dataset.</span>

<span class="sd">        Use this function to attach numpy array data to a GMT dataset and pass it to GMT</span>
<span class="sd">        modules. Wraps ``GMT_Put_Vector``.</span>

<span class="sd">        The dataset must be created by :meth:`pygmt.clib.Session.create_data` first with</span>
<span class="sd">        ``family=&quot;GMT_IS_DATASET|GMT_VIA_VECTOR&quot;``.</span>

<span class="sd">        Not all numpy dtypes are supported, only: int8, int16, int32, int64, longlong,</span>
<span class="sd">        uint8, uint16, uint32, uint64, ulonglong, float32, float64, str\_, datetime64,</span>
<span class="sd">        and timedelta64.</span>

<span class="sd">        .. warning::</span>
<span class="sd">            The numpy array must be C contiguous in memory. Use</span>
<span class="sd">            :func:`numpy.ascontiguousarray` to make sure your vector is contiguous (it</span>
<span class="sd">            won&#39;t copy if it already is).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dataset</span>
<span class="sd">            The ctypes void pointer to a ``GMT_VECTOR`` data container. Create it with</span>
<span class="sd">            :meth:`pygmt.clib.Session.create_data`.</span>
<span class="sd">        column</span>
<span class="sd">            The column number of this vector in the dataset (starting from 0).</span>
<span class="sd">        vector</span>
<span class="sd">            The array that will be attached to the dataset. Must be a 1-D C contiguous</span>
<span class="sd">            array.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        GMTCLibError</span>
<span class="sd">            If given invalid input or ``GMT_Put_Vector`` exits with a non-zero status.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">c_put_vector</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_libgmt_func</span><span class="p">(</span>
            <span class="s2">&quot;GMT_Put_Vector&quot;</span><span class="p">,</span>
            <span class="n">argtypes</span><span class="o">=</span><span class="p">[</span><span class="n">ctp</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span> <span class="n">ctp</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span> <span class="n">ctp</span><span class="o">.</span><span class="n">c_uint</span><span class="p">,</span> <span class="n">ctp</span><span class="o">.</span><span class="n">c_uint</span><span class="p">,</span> <span class="n">ctp</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">],</span>
            <span class="n">restype</span><span class="o">=</span><span class="n">ctp</span><span class="o">.</span><span class="n">c_int</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">vector_pointer</span><span class="p">:</span> <span class="n">ctp</span><span class="o">.</span><span class="n">Array</span> <span class="o">|</span> <span class="n">ctp</span><span class="o">.</span><span class="n">c_void_p</span>
        <span class="n">gmt_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_dtype_and_dim</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">gmt_type</span> <span class="ow">in</span> <span class="p">{</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;GMT_TEXT&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;GMT_DATETIME&quot;</span><span class="p">]}:</span>
            <span class="k">if</span> <span class="n">gmt_type</span> <span class="o">==</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;GMT_DATETIME&quot;</span><span class="p">]:</span>
                <span class="n">vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime_as_string</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span>
            <span class="n">vector_pointer</span> <span class="o">=</span> <span class="n">strings_to_ctypes_array</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">vector_pointer</span> <span class="o">=</span> <span class="n">vector</span><span class="o">.</span><span class="n">ctypes</span><span class="o">.</span><span class="n">data_as</span><span class="p">(</span><span class="n">ctp</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">)</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">c_put_vector</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">session_pointer</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">gmt_type</span><span class="p">,</span> <span class="n">vector_pointer</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failed to put vector of type </span><span class="si">{</span><span class="n">vector</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s2"> in column </span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s2"> of &quot;</span>
                <span class="s2">&quot;dataset.&quot;</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="n">GMTCLibError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>


<div class="viewcode-block" id="Session.put_strings">
<a class="viewcode-back" href="../../../api/generated/pygmt.clib.Session.put_strings.html#pygmt.clib.Session.put_strings">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">put_strings</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">:</span> <span class="n">ctp</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span> <span class="n">family</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">strings</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attach a 1-D numpy array of dtype str as a column on a GMT dataset.</span>

<span class="sd">        Use this function to attach string type numpy array data to a GMT dataset and</span>
<span class="sd">        pass it to GMT modules. Wraps ``GMT_Put_Strings``.</span>

<span class="sd">        The dataset must be created by :meth:`pygmt.clib.Session.create_data` first.</span>

<span class="sd">        .. warning::</span>
<span class="sd">            The numpy array must be C contiguous in memory. If it comes from a column</span>
<span class="sd">            slice of a 2-D array, for example, you will have to make a copy. Use</span>
<span class="sd">            :func:`numpy.ascontiguousarray` to make sure your vector is contiguous (it</span>
<span class="sd">            won&#39;t copy if it already is).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dataset</span>
<span class="sd">            The ctypes void pointer to a ``GMT_VECTOR``/``GMT_MATRIX`` data container.</span>
<span class="sd">            Create it with :meth:`pygmt.clib.Session.create_data`.</span>
<span class="sd">        family</span>
<span class="sd">            The family type of the dataset. Can be either ``GMT_IS_VECTOR`` or</span>
<span class="sd">            ``GMT_IS_MATRIX``.</span>
<span class="sd">        strings</span>
<span class="sd">            The array that will be attached to the dataset. Must be a 1-D C contiguous</span>
<span class="sd">            array.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        GMTCLibError</span>
<span class="sd">            If given invalid input or ``GMT_Put_Strings`` exits with a non-zero status.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">c_put_strings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_libgmt_func</span><span class="p">(</span>
            <span class="s2">&quot;GMT_Put_Strings&quot;</span><span class="p">,</span>
            <span class="n">argtypes</span><span class="o">=</span><span class="p">[</span>
                <span class="n">ctp</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span>  <span class="c1"># V_API</span>
                <span class="n">ctp</span><span class="o">.</span><span class="n">c_uint</span><span class="p">,</span>  <span class="c1"># family</span>
                <span class="n">ctp</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span>  <span class="c1"># object</span>
                <span class="n">ctp</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctp</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">),</span>  <span class="c1"># array</span>
            <span class="p">],</span>
            <span class="n">restype</span><span class="o">=</span><span class="n">ctp</span><span class="o">.</span><span class="n">c_int</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">family_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_constant</span><span class="p">(</span>
            <span class="n">family</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="n">FAMILIES</span><span class="p">,</span> <span class="n">valid_modifiers</span><span class="o">=</span><span class="n">METHODS</span>
        <span class="p">)</span>
        <span class="n">strings_pointer</span> <span class="o">=</span> <span class="n">strings_to_ctypes_array</span><span class="p">(</span><span class="n">strings</span><span class="p">)</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">c_put_strings</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">session_pointer</span><span class="p">,</span> <span class="n">family_int</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">strings_pointer</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Failed to put strings of type </span><span class="si">{</span><span class="n">strings</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s2"> into dataset.&quot;</span>
            <span class="k">raise</span> <span class="n">GMTCLibError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>


<div class="viewcode-block" id="Session.put_matrix">
<a class="viewcode-back" href="../../../api/generated/pygmt.clib.Session.put_matrix.html#pygmt.clib.Session.put_matrix">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">put_matrix</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">dataset</span><span class="p">:</span> <span class="n">ctp</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span> <span class="n">matrix</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pad</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attach a 2-D numpy array to a GMT dataset.</span>

<span class="sd">        Use this function to attach numpy array data to a GMT dataset and pass it to GMT</span>
<span class="sd">        modules. Wraps ``GMT_Put_Matrix``.</span>

<span class="sd">        The dataset must be created by :meth:`pygmt.clib.Session.create_data` first with</span>
<span class="sd">        ``family=&quot;GMT_IS_DATASET|GMT_VIA_MATRIX&quot;``.</span>

<span class="sd">        Not all numpy dtypes are supported, only: int8, int16, int32, int64, longlong,</span>
<span class="sd">        uint8, uint16, uint32, uint64, ulonglong, float32, and float64.</span>

<span class="sd">        .. warning::</span>
<span class="sd">            The numpy array must be C contiguous in memory. Use</span>
<span class="sd">            :func:`numpy.ascontiguousarray` to make sure your matrix is contiguous (it</span>
<span class="sd">            won&#39;t copy if it already is).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        dataset</span>
<span class="sd">            The ctypes void pointer to a ``GMT_MATRIX`` data container. Create it with</span>
<span class="sd">            :meth:`pygmt.clib.Session.create_data`.</span>
<span class="sd">        matrix</span>
<span class="sd">            The array that will be attached to the dataset. Must be a 2-D C contiguous</span>
<span class="sd">            array.</span>
<span class="sd">        pad</span>
<span class="sd">            The amount of padding that should be added to the matrix. Use when creating</span>
<span class="sd">            grids for modules that require padding.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        GMTCLibError</span>
<span class="sd">            If given invalid input or ``GMT_Put_Matrix`` exits with a non-zero status.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">c_put_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_libgmt_func</span><span class="p">(</span>
            <span class="s2">&quot;GMT_Put_Matrix&quot;</span><span class="p">,</span>
            <span class="n">argtypes</span><span class="o">=</span><span class="p">[</span><span class="n">ctp</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span> <span class="n">ctp</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span> <span class="n">ctp</span><span class="o">.</span><span class="n">c_uint</span><span class="p">,</span> <span class="n">ctp</span><span class="o">.</span><span class="n">c_int</span><span class="p">,</span> <span class="n">ctp</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">],</span>
            <span class="n">restype</span><span class="o">=</span><span class="n">ctp</span><span class="o">.</span><span class="n">c_int</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">gmt_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_dtype_and_dim</span><span class="p">(</span><span class="n">matrix</span><span class="p">,</span> <span class="n">ndim</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">matrix_pointer</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">ctypes</span><span class="o">.</span><span class="n">data_as</span><span class="p">(</span><span class="n">ctp</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">)</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">c_put_matrix</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">session_pointer</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">gmt_type</span><span class="p">,</span> <span class="n">pad</span><span class="p">,</span> <span class="n">matrix_pointer</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Failed to put matrix of type </span><span class="si">{</span><span class="n">matrix</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="k">raise</span> <span class="n">GMTCLibError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>


<div class="viewcode-block" id="Session.read_data">
<a class="viewcode-back" href="../../../api/generated/pygmt.clib.Session.read_data.html#pygmt.clib.Session.read_data">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">read_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">infile</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">kind</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;dataset&quot;</span><span class="p">,</span> <span class="s2">&quot;grid&quot;</span><span class="p">,</span> <span class="s2">&quot;image&quot;</span><span class="p">],</span>
        <span class="n">family</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">geometry</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;GMT_READ_NORMAL&quot;</span><span class="p">,</span>
        <span class="n">region</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read a data file into a GMT data container.</span>

<span class="sd">        Wraps ``GMT_Read_Data`` but only allows reading from a file. The function</span>
<span class="sd">        definition is different from the original C API function.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        infile</span>
<span class="sd">            The input file name.</span>
<span class="sd">        kind</span>
<span class="sd">            The data kind of the input file. Valid values are ``&quot;dataset&quot;``, ``&quot;grid&quot;``</span>
<span class="sd">            and ``&quot;image&quot;``.</span>
<span class="sd">        family</span>
<span class="sd">            A valid GMT data family name (e.g., ``&quot;GMT_IS_DATASET&quot;``). See the</span>
<span class="sd">            ``FAMILIES`` attribute for valid names. If ``None``, will determine the data</span>
<span class="sd">            family from the ``kind`` parameter.</span>
<span class="sd">        geometry</span>
<span class="sd">            A valid GMT data geometry name (e.g., ``&quot;GMT_IS_POINT&quot;``). See the</span>
<span class="sd">            ``GEOMETRIES`` attribute for valid names. If ``None``, will determine the</span>
<span class="sd">            data geometry from the ``kind`` parameter.</span>
<span class="sd">        mode</span>
<span class="sd">            How the data is to be read from the file. This option varies depending on</span>
<span class="sd">            the given family. See the</span>
<span class="sd">            :gmt-docs:`GMT API documentation &lt;devdocs/api.html#import-from-a-file-stream-or-handle&gt;`</span>
<span class="sd">            for details. Default is ``GMT_READ_NORMAL`` which corresponds to the default</span>
<span class="sd">            read mode value of 0 in the ``GMT_enum_read`` enum.</span>
<span class="sd">        region</span>
<span class="sd">            Subregion of the data, in the form of [xmin, xmax, ymin, ymax, zmin, zmax].</span>
<span class="sd">            If ``None``, the whole data is read.</span>
<span class="sd">        data</span>
<span class="sd">            ``None`` or the pointer returned by this function after a first call. It&#39;s</span>
<span class="sd">            useful when reading grids/images/cubes in two steps (get a grid/image/cube</span>
<span class="sd">            structure with a header, then read the data).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Pointer to the data container, or ``None`` if there were errors.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        GMTCLibError</span>
<span class="sd">            If the GMT API function fails to read the data.</span>
<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa: W505</span>
        <span class="n">c_read_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_libgmt_func</span><span class="p">(</span>
            <span class="s2">&quot;GMT_Read_Data&quot;</span><span class="p">,</span>
            <span class="n">argtypes</span><span class="o">=</span><span class="p">[</span>
                <span class="n">ctp</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span>  <span class="c1"># V_API</span>
                <span class="n">ctp</span><span class="o">.</span><span class="n">c_uint</span><span class="p">,</span>  <span class="c1"># family</span>
                <span class="n">ctp</span><span class="o">.</span><span class="n">c_uint</span><span class="p">,</span>  <span class="c1"># method</span>
                <span class="n">ctp</span><span class="o">.</span><span class="n">c_uint</span><span class="p">,</span>  <span class="c1"># geometry</span>
                <span class="n">ctp</span><span class="o">.</span><span class="n">c_uint</span><span class="p">,</span>  <span class="c1"># mode</span>
                <span class="n">ctp</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctp</span><span class="o">.</span><span class="n">c_double</span><span class="p">),</span>  <span class="c1"># wesn</span>
                <span class="n">ctp</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">,</span>  <span class="c1"># infile</span>
                <span class="n">ctp</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span>  <span class="c1"># data</span>
            <span class="p">],</span>
            <span class="n">restype</span><span class="o">=</span><span class="n">ctp</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span>  <span class="c1"># data_ptr</span>
        <span class="p">)</span>

        <span class="c1"># Determine the family, geometry and data container from kind</span>
        <span class="n">_family</span><span class="p">,</span> <span class="n">_geometry</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;dataset&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;GMT_IS_DATASET&quot;</span><span class="p">,</span> <span class="s2">&quot;GMT_IS_PLP&quot;</span><span class="p">,</span> <span class="n">_GMT_DATASET</span><span class="p">),</span>
            <span class="s2">&quot;grid&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;GMT_IS_GRID&quot;</span><span class="p">,</span> <span class="s2">&quot;GMT_IS_SURFACE&quot;</span><span class="p">,</span> <span class="n">_GMT_GRID</span><span class="p">),</span>
            <span class="s2">&quot;image&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;GMT_IS_IMAGE&quot;</span><span class="p">,</span> <span class="s2">&quot;GMT_IS_SURFACE&quot;</span><span class="p">,</span> <span class="n">_GMT_IMAGE</span><span class="p">),</span>
        <span class="p">}[</span><span class="n">kind</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">family</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">family</span> <span class="o">=</span> <span class="n">_family</span>
        <span class="k">if</span> <span class="n">geometry</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">geometry</span> <span class="o">=</span> <span class="n">_geometry</span>

        <span class="n">data_ptr</span> <span class="o">=</span> <span class="n">c_read_data</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">session_pointer</span><span class="p">,</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">family</span><span class="p">],</span>
            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;GMT_IS_FILE&quot;</span><span class="p">],</span>  <span class="c1"># Reading from a file</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">geometry</span><span class="p">],</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">mode</span><span class="p">],</span>
            <span class="n">sequence_to_ctypes_array</span><span class="p">(</span><span class="n">region</span><span class="p">,</span> <span class="n">ctp</span><span class="o">.</span><span class="n">c_double</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
            <span class="n">infile</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span>
            <span class="n">data</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">data_ptr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Failed to read dataset from </span><span class="si">{</span><span class="n">infile</span><span class="si">!r}</span><span class="s2">.&quot;</span>
            <span class="k">raise</span> <span class="n">GMTCLibError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ctp</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">data_ptr</span><span class="p">,</span> <span class="n">ctp</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">dtype</span><span class="p">))</span></div>


<div class="viewcode-block" id="Session.write_data">
<a class="viewcode-back" href="../../../api/generated/pygmt.clib.Session.write_data.html#pygmt.clib.Session.write_data">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">write_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">family</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">wesn</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write a GMT data container to a file.</span>

<span class="sd">        The data container should be created by</span>
<span class="sd">        :meth:`pygmt.clib.Session.create_data`.</span>

<span class="sd">        Wraps ``GMT_Write_Data`` but only allows writing to a file. So the</span>
<span class="sd">        ``method`` argument is omitted.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        family : str</span>
<span class="sd">            A valid GMT data family name (e.g., ``&#39;GMT_IS_DATASET&#39;``). See the</span>
<span class="sd">            ``FAMILIES`` attribute for valid names. Don&#39;t use the</span>
<span class="sd">            ``GMT_VIA_VECTOR`` or ``GMT_VIA_MATRIX`` constructs for this. Use</span>
<span class="sd">            ``GMT_IS_VECTOR`` and ``GMT_IS_MATRIX`` instead.</span>
<span class="sd">        geometry : str</span>
<span class="sd">            A valid GMT data geometry name (e.g., ``&#39;GMT_IS_POINT&#39;``). See the</span>
<span class="sd">            ``GEOMETRIES`` attribute for valid names.</span>
<span class="sd">        mode : str</span>
<span class="sd">            How the data is to be written to the file. This option varies</span>
<span class="sd">            depending on the given family. See the GMT API documentation for</span>
<span class="sd">            details.</span>
<span class="sd">        wesn : list or numpy array</span>
<span class="sd">            [xmin, xmax, ymin, ymax, zmin, zmax] of the data. Must have 6</span>
<span class="sd">            elements.</span>
<span class="sd">        output : str</span>
<span class="sd">            The output file name.</span>
<span class="sd">        data : :class:`ctypes.c_void_p`</span>
<span class="sd">            Pointer to the data container created by</span>
<span class="sd">            :meth:`pygmt.clib.Session.create_data`.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        GMTCLibError</span>
<span class="sd">            For invalid input arguments or if the GMT API functions returns a</span>
<span class="sd">            non-zero status code.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">c_write_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_libgmt_func</span><span class="p">(</span>
            <span class="s2">&quot;GMT_Write_Data&quot;</span><span class="p">,</span>
            <span class="n">argtypes</span><span class="o">=</span><span class="p">[</span>
                <span class="n">ctp</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span>
                <span class="n">ctp</span><span class="o">.</span><span class="n">c_uint</span><span class="p">,</span>
                <span class="n">ctp</span><span class="o">.</span><span class="n">c_uint</span><span class="p">,</span>
                <span class="n">ctp</span><span class="o">.</span><span class="n">c_uint</span><span class="p">,</span>
                <span class="n">ctp</span><span class="o">.</span><span class="n">c_uint</span><span class="p">,</span>
                <span class="n">ctp</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctp</span><span class="o">.</span><span class="n">c_double</span><span class="p">),</span>
                <span class="n">ctp</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">,</span>
                <span class="n">ctp</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span>
            <span class="p">],</span>
            <span class="n">restype</span><span class="o">=</span><span class="n">ctp</span><span class="o">.</span><span class="n">c_int</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">family_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_constant</span><span class="p">(</span><span class="n">family</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="n">FAMILIES</span><span class="p">,</span> <span class="n">valid_modifiers</span><span class="o">=</span><span class="n">VIAS</span><span class="p">)</span>
        <span class="n">geometry_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_constant</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="n">GEOMETRIES</span><span class="p">)</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">c_write_data</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">session_pointer</span><span class="p">,</span>
            <span class="n">family_int</span><span class="p">,</span>
            <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;GMT_IS_FILE&quot;</span><span class="p">],</span>
            <span class="n">geometry_int</span><span class="p">,</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">mode</span><span class="p">],</span>
            <span class="n">sequence_to_ctypes_array</span><span class="p">(</span><span class="n">wesn</span><span class="p">,</span> <span class="n">ctp</span><span class="o">.</span><span class="n">c_double</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
            <span class="n">output</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span>
            <span class="n">data</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Failed to write dataset to </span><span class="si">{</span><span class="n">output</span><span class="si">!r}</span><span class="s2">.&quot;</span>
            <span class="k">raise</span> <span class="n">GMTCLibError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>


<div class="viewcode-block" id="Session.open_virtualfile">
<a class="viewcode-back" href="../../../api/generated/pygmt.clib.Session.open_virtualfile.html#pygmt.clib.Session.open_virtualfile">[docs]</a>
    <span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">open_virtualfile</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">family</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">geometry</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">direction</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">ctp</span><span class="o">.</span><span class="n">c_void_p</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Open a GMT virtual file associated with a data object for reading or writing.</span>

<span class="sd">        GMT uses a virtual file scheme to pass in data or get data from API modules. Use</span>
<span class="sd">        it to pass in your GMT data structure (created using</span>
<span class="sd">        :meth:`pygmt.clib.Session.create_data`) to a module that expects an input file,</span>
<span class="sd">        or get the output from a module that writes to a file.</span>

<span class="sd">        Use in a ``with`` block. Will automatically close the virtual file when leaving</span>
<span class="sd">        the ``with`` block. Because of this, no wrapper for ``GMT_Close_VirtualFile``</span>
<span class="sd">        is provided.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        family</span>
<span class="sd">            A valid GMT data family name (e.g., ``&quot;GMT_IS_DATASET&quot;``). Should be the</span>
<span class="sd">            same as the one you used to create your data structure.</span>
<span class="sd">        geometry</span>
<span class="sd">            A valid GMT data geometry name (e.g., ``&quot;GMT_IS_POINT&quot;``). Should be the</span>
<span class="sd">            same as the one you used to create your data structure.</span>
<span class="sd">        direction</span>
<span class="sd">            Either ``&quot;GMT_IN&quot;`` or ``&quot;GMT_OUT&quot;`` to indicate if passing data to GMT or</span>
<span class="sd">            getting it out of GMT, respectively. By default, GMT can modify the data you</span>
<span class="sd">            pass in. Add modifier ``&quot;GMT_IS_REFERENCE&quot;`` to tell GMT the data are</span>
<span class="sd">            read-only, or ``&quot;GMT_IS_DUPLICATE&quot;`` to tell GMT to duplicate the data.</span>
<span class="sd">        data</span>
<span class="sd">            The ctypes void pointer to the GMT data structure. For output (i.e.,</span>
<span class="sd">            ``direction=&quot;GMT_OUT&quot;``), it can be ``None`` to have GMT automatically</span>
<span class="sd">            allocate the output GMT data structure.</span>

<span class="sd">        Yields</span>
<span class="sd">        ------</span>
<span class="sd">        vfname</span>
<span class="sd">            The name of the virtual file that you can pass to a GMT module.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from pygmt.helpers import GMTTempFile</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; x = np.array([0, 1, 2, 3, 4])</span>
<span class="sd">        &gt;&gt;&gt; y = np.array([5, 6, 7, 8, 9])</span>
<span class="sd">        &gt;&gt;&gt; with Session() as lib:</span>
<span class="sd">        ...     family = &quot;GMT_IS_DATASET|GMT_VIA_VECTOR&quot;</span>
<span class="sd">        ...     geometry = &quot;GMT_IS_POINT&quot;</span>
<span class="sd">        ...     dataset = lib.create_data(</span>
<span class="sd">        ...         family=family,</span>
<span class="sd">        ...         geometry=geometry,</span>
<span class="sd">        ...         mode=&quot;GMT_CONTAINER_ONLY&quot;,</span>
<span class="sd">        ...         dim=[2, 5, lib[&quot;GMT_INT&quot;], 0],  # ncolumns, nrows, dtype, unused</span>
<span class="sd">        ...     )</span>
<span class="sd">        ...     lib.put_vector(dataset, column=0, vector=x)</span>
<span class="sd">        ...     lib.put_vector(dataset, column=1, vector=y)</span>
<span class="sd">        ...     # Add the dataset to a virtual file</span>
<span class="sd">        ...     vfargs = (family, geometry, &quot;GMT_IN|GMT_IS_REFERENCE&quot;, dataset)</span>
<span class="sd">        ...     with lib.open_virtualfile(*vfargs) as vfile:</span>
<span class="sd">        ...         # Send the output to a temp file so that we can read it</span>
<span class="sd">        ...         with GMTTempFile() as ofile:</span>
<span class="sd">        ...             lib.call_module(&quot;info&quot;, [vfile, f&quot;-&gt;{ofile.name}&quot;])</span>
<span class="sd">        ...             print(ofile.read().strip())</span>
<span class="sd">        &lt;vector memory&gt;: N = 5 &lt;0/4&gt; &lt;5/9&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">c_open_virtualfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_libgmt_func</span><span class="p">(</span>
            <span class="s2">&quot;GMT_Open_VirtualFile&quot;</span><span class="p">,</span>
            <span class="n">argtypes</span><span class="o">=</span><span class="p">[</span>
                <span class="n">ctp</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span>  <span class="c1"># V_API</span>
                <span class="n">ctp</span><span class="o">.</span><span class="n">c_uint</span><span class="p">,</span>  <span class="c1"># family</span>
                <span class="n">ctp</span><span class="o">.</span><span class="n">c_uint</span><span class="p">,</span>  <span class="c1"># geometry</span>
                <span class="n">ctp</span><span class="o">.</span><span class="n">c_uint</span><span class="p">,</span>  <span class="c1"># direction</span>
                <span class="n">ctp</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span>  <span class="c1"># data</span>
                <span class="n">ctp</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">,</span>  <span class="c1"># name</span>
            <span class="p">],</span>
            <span class="n">restype</span><span class="o">=</span><span class="n">ctp</span><span class="o">.</span><span class="n">c_int</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">c_close_virtualfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_libgmt_func</span><span class="p">(</span>
            <span class="s2">&quot;GMT_Close_VirtualFile&quot;</span><span class="p">,</span>
            <span class="n">argtypes</span><span class="o">=</span><span class="p">[</span><span class="n">ctp</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span> <span class="n">ctp</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">],</span>  <span class="c1"># V_API, name</span>
            <span class="n">restype</span><span class="o">=</span><span class="n">ctp</span><span class="o">.</span><span class="n">c_int</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">family_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_constant</span><span class="p">(</span><span class="n">family</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="n">FAMILIES</span><span class="p">,</span> <span class="n">valid_modifiers</span><span class="o">=</span><span class="n">VIAS</span><span class="p">)</span>
        <span class="n">geometry_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_constant</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="n">GEOMETRIES</span><span class="p">)</span>
        <span class="n">direction_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_constant</span><span class="p">(</span>
            <span class="n">direction</span><span class="p">,</span> <span class="n">valid</span><span class="o">=</span><span class="n">DIRECTIONS</span><span class="p">,</span> <span class="n">valid_modifiers</span><span class="o">=</span><span class="n">METHODS</span>
        <span class="p">)</span>

        <span class="n">buff</span> <span class="o">=</span> <span class="n">ctp</span><span class="o">.</span><span class="n">create_string_buffer</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;GMT_VF_LEN&quot;</span><span class="p">])</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">c_open_virtualfile</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">session_pointer</span><span class="p">,</span> <span class="n">family_int</span><span class="p">,</span> <span class="n">geometry_int</span><span class="p">,</span> <span class="n">direction_int</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">buff</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Failed to create a virtual file with </span><span class="si">{</span><span class="n">family</span><span class="si">=}</span><span class="s2">, </span><span class="si">{</span><span class="n">geometry</span><span class="si">=}</span><span class="s2">, &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">direction</span><span class="si">=}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="n">GMTCLibError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="n">vfname</span> <span class="o">=</span> <span class="n">buff</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">vfname</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">c_close_virtualfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session_pointer</span><span class="p">,</span> <span class="n">vfname</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">status</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Failed to close virtual file </span><span class="si">{</span><span class="n">vfname</span><span class="si">!r}</span><span class="s2">.&quot;</span>
                <span class="k">raise</span> <span class="n">GMTCLibError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>


<div class="viewcode-block" id="Session.virtualfile_from_vectors">
<a class="viewcode-back" href="../../../api/generated/pygmt.clib.Session.virtualfile_from_vectors.html#pygmt.clib.Session.virtualfile_from_vectors">[docs]</a>
    <span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">virtualfile_from_vectors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vectors</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Store a sequence of 1-D vectors as columns of a dataset inside a virtual file.</span>

<span class="sd">        Use the virtual file name to pass the dataset with your vectors to a GMT module.</span>

<span class="sd">        Context manager (use in a ``with`` block). Yields the virtual file name that you</span>
<span class="sd">        can pass as an argument to a GMT module call. Closes the virtual file upon exit</span>
<span class="sd">        of the ``with`` block.</span>

<span class="sd">        Use this instead of creating the data container and virtual file by hand with</span>
<span class="sd">        :meth:`pygmt.clib.Session.create_data`, :meth:`pygmt.clib.Session.put_vector`,</span>
<span class="sd">        and :meth:`pygmt.clib.Session.open_virtualfile`.</span>

<span class="sd">        If the arrays are C contiguous blocks of memory, they will be passed without</span>
<span class="sd">        copying to GMT. If they are not (e.g., they are columns of a 2-D array), they</span>
<span class="sd">        will need to be copied to a contiguous block.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        vectors</span>
<span class="sd">            A sequence of vectors that will be stored in the dataset. All must be of the</span>
<span class="sd">            same size.</span>

<span class="sd">        Yields</span>
<span class="sd">        ------</span>
<span class="sd">        fname</span>
<span class="sd">            The name of virtual file. Pass this as a file name argument to a GMT module.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from pygmt.helpers import GMTTempFile</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">        &gt;&gt;&gt; x = [1, 2, 3]</span>
<span class="sd">        &gt;&gt;&gt; y = np.array([4, 5, 6])</span>
<span class="sd">        &gt;&gt;&gt; z = pd.Series([7, 8, 9])</span>
<span class="sd">        &gt;&gt;&gt; with Session() as ses:</span>
<span class="sd">        ...     with ses.virtualfile_from_vectors((x, y, z)) as fin:</span>
<span class="sd">        ...         # Send the output to a file so that we can read it</span>
<span class="sd">        ...         with GMTTempFile() as fout:</span>
<span class="sd">        ...             ses.call_module(&quot;info&quot;, [fin, f&quot;-&gt;{fout.name}&quot;])</span>
<span class="sd">        ...             print(fout.read().strip())</span>
<span class="sd">        &lt;vector memory&gt;: N = 3 &lt;1/3&gt; &lt;4/6&gt; &lt;7/9&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Conversion to a C-contiguous array needs to be done here and not in put_vector</span>
        <span class="c1"># or put_strings because we need to maintain a reference to the copy while it is</span>
        <span class="c1"># being used by the C API. Otherwise, the array would be garbage collected and</span>
        <span class="c1"># the memory freed. Creating it in this context manager guarantees that the copy</span>
        <span class="c1"># will be around until the virtual file is closed. The conversion is implicit in</span>
        <span class="c1"># vectors_to_arrays.</span>
        <span class="n">arrays</span> <span class="o">=</span> <span class="n">vectors_to_arrays</span><span class="p">(</span><span class="n">vectors</span><span class="p">)</span>

        <span class="n">columns</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">arrays</span><span class="p">)</span>
        <span class="c1"># Find arrays that are of string dtype from column 3 onwards. Assumes that first</span>
        <span class="c1"># 2 columns contains coordinates like longitude, latitude, or datetime string</span>
        <span class="c1"># types.</span>
        <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">array</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arrays</span><span class="p">[</span><span class="mi">2</span><span class="p">:]):</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">str_</span><span class="p">):</span>
                <span class="n">columns</span> <span class="o">=</span> <span class="n">col</span> <span class="o">+</span> <span class="mi">2</span>
                <span class="k">break</span>

        <span class="n">rows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">arrays</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="n">rows</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">arrays</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">GMTValueError</span><span class="p">(</span><span class="n">arrays</span><span class="p">,</span> <span class="n">reason</span><span class="o">=</span><span class="s2">&quot;All arrays must have same size.&quot;</span><span class="p">)</span>

        <span class="n">family</span> <span class="o">=</span> <span class="s2">&quot;GMT_IS_DATASET|GMT_VIA_VECTOR&quot;</span>
        <span class="n">geometry</span> <span class="o">=</span> <span class="s2">&quot;GMT_IS_POINT&quot;</span>

        <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_data</span><span class="p">(</span>
            <span class="n">family</span><span class="p">,</span>
            <span class="n">geometry</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;GMT_CONTAINER_ONLY&quot;</span><span class="p">,</span>
            <span class="n">dim</span><span class="o">=</span><span class="p">[</span><span class="n">columns</span><span class="p">,</span> <span class="n">rows</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;GMT_DOUBLE&quot;</span><span class="p">],</span> <span class="mi">0</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="c1"># Use put_vector for columns with numerical type data</span>
        <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">array</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">arrays</span><span class="p">[:</span><span class="n">columns</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">put_vector</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">vector</span><span class="o">=</span><span class="n">array</span><span class="p">)</span>

        <span class="c1"># Use put_strings for last column(s) with string type data.</span>
        <span class="c1"># Have to use modifier &quot;GMT_IS_DUPLICATE&quot; to duplicate the strings.</span>
        <span class="n">string_arrays</span> <span class="o">=</span> <span class="n">arrays</span><span class="p">[</span><span class="n">columns</span><span class="p">:]</span>
        <span class="k">if</span> <span class="n">string_arrays</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">string_arrays</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">strings</span> <span class="o">=</span> <span class="n">string_arrays</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">string_arrays</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">strings</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                    <span class="p">[</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span> <span class="k">for</span> <span class="n">vals</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">string_arrays</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">)],</span>
                    <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">str_</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">put_strings</span><span class="p">(</span>
                <span class="n">dataset</span><span class="p">,</span> <span class="n">family</span><span class="o">=</span><span class="s2">&quot;GMT_IS_VECTOR|GMT_IS_DUPLICATE&quot;</span><span class="p">,</span> <span class="n">strings</span><span class="o">=</span><span class="n">strings</span>
            <span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_virtualfile</span><span class="p">(</span>
            <span class="n">family</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="s2">&quot;GMT_IN|GMT_IS_REFERENCE&quot;</span><span class="p">,</span> <span class="n">dataset</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">vfile</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">vfile</span></div>


<div class="viewcode-block" id="Session.virtualfile_from_matrix">
<a class="viewcode-back" href="../../../api/generated/pygmt.clib.Session.virtualfile_from_matrix.html#pygmt.clib.Session.virtualfile_from_matrix">[docs]</a>
    <span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">virtualfile_from_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">matrix</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Store a 2-D numpy array as a matrix inside a virtual file.</span>

<span class="sd">        Use the virtual file name to pass in the data in your matrix to a GMT module.</span>

<span class="sd">        Context manager (use in a ``with`` block). Yields the virtual file name that you</span>
<span class="sd">        can pass as an argument to a GMT module call. Closes the virtual file upon exit</span>
<span class="sd">        of the ``with`` block.</span>

<span class="sd">        The virtual file will contain the array as a ``GMT_MATRIX`` data container</span>
<span class="sd">        pretending to be a ``GMT_DATASET`` data container.</span>

<span class="sd">        **Not meant for creating ``GMT_GRID``**. The grid requires more metadata than</span>
<span class="sd">        just the data matrix. Use :meth:`pygmt.clib.Session.virtualfile_from_grid`</span>
<span class="sd">        instead.</span>

<span class="sd">        Use this instead of creating the data container and virtual file by hand with</span>
<span class="sd">        :meth:`pygmt.clib.Session.create_data`, :meth:`pygmt.clib.Session.put_matrix`,</span>
<span class="sd">        and :meth:`pygmt.clib.Session.open_virtualfile`.</span>

<span class="sd">        The matrix must be C contiguous in memory. If it is not (e.g., it is a slice of</span>
<span class="sd">        a larger array), the array will be copied to make sure it is.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        matrix</span>
<span class="sd">            The matrix that will be included in the GMT data container.</span>

<span class="sd">        Yields</span>
<span class="sd">        ------</span>
<span class="sd">        fname</span>
<span class="sd">            The name of virtual file. Pass this as a file name argument to a GMT module.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from pygmt.helpers import GMTTempFile</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; data = np.arange(12).reshape((4, 3))</span>
<span class="sd">        &gt;&gt;&gt; print(data)</span>
<span class="sd">        [[ 0  1  2]</span>
<span class="sd">         [ 3  4  5]</span>
<span class="sd">         [ 6  7  8]</span>
<span class="sd">         [ 9 10 11]]</span>
<span class="sd">        &gt;&gt;&gt; with Session() as ses:</span>
<span class="sd">        ...     with ses.virtualfile_from_matrix(data) as fin:</span>
<span class="sd">        ...         # Send the output to a file so that we can read it</span>
<span class="sd">        ...         with GMTTempFile() as fout:</span>
<span class="sd">        ...             ses.call_module(&quot;info&quot;, [fin, f&quot;-&gt;{fout.name}&quot;])</span>
<span class="sd">        ...             print(fout.read().strip())</span>
<span class="sd">        &lt;matrix memory&gt;: N = 4 &lt;0/9&gt; &lt;1/10&gt; &lt;2/11&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Conversion to a C-contiguous array needs to be done here and not in put_matrix</span>
        <span class="c1"># because we need to maintain a reference to the copy while it is being used by</span>
        <span class="c1"># the C API. Otherwise, the array would be garbage collected and the memory</span>
        <span class="c1"># freed. Creating it in this context manager guarantees that the copy will be</span>
        <span class="c1"># around until the virtual file is closed.</span>
        <span class="n">matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span>
        <span class="n">rows</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">layers</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">family</span> <span class="o">=</span> <span class="s2">&quot;GMT_IS_DATASET|GMT_VIA_MATRIX&quot;</span>
        <span class="n">geometry</span> <span class="o">=</span> <span class="s2">&quot;GMT_IS_POINT&quot;</span>

        <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_data</span><span class="p">(</span>
            <span class="n">family</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;GMT_CONTAINER_ONLY&quot;</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="p">[</span><span class="n">columns</span><span class="p">,</span> <span class="n">rows</span><span class="p">,</span> <span class="n">layers</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">put_matrix</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">matrix</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_virtualfile</span><span class="p">(</span>
            <span class="n">family</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="s2">&quot;GMT_IN|GMT_IS_REFERENCE&quot;</span><span class="p">,</span> <span class="n">dataset</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">vfile</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">vfile</span></div>


<div class="viewcode-block" id="Session.virtualfile_from_grid">
<a class="viewcode-back" href="../../../api/generated/pygmt.clib.Session.virtualfile_from_grid.html#pygmt.clib.Session.virtualfile_from_grid">[docs]</a>
    <span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">virtualfile_from_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grid</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Store a grid in a virtual file.</span>

<span class="sd">        Use the virtual file name to pass in the data in your grid to a GMT module.</span>
<span class="sd">        Grids must be :class:`xarray.DataArray` instances.</span>

<span class="sd">        Context manager (use in a ``with`` block). Yields the virtual file name that you</span>
<span class="sd">        can pass as an argument to a GMT module call. Closes the virtual file upon exit</span>
<span class="sd">        of the ``with`` block.</span>

<span class="sd">        The virtual file will contain the grid as a ``GMT_MATRIX`` data container with</span>
<span class="sd">        extra metadata.</span>

<span class="sd">        Use this instead of creating a data container and virtual file by hand with</span>
<span class="sd">        :meth:`pygmt.clib.Session.create_data`, :meth:`pygmt.clib.Session.put_matrix`,</span>
<span class="sd">        and :meth:`pygmt.clib.Session.open_virtualfile`.</span>

<span class="sd">        The grid data matrix must be C contiguous in memory. If it is not (e.g., it is a</span>
<span class="sd">        slice of a larger array), the array will be copied to make sure it is.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        grid</span>
<span class="sd">            The grid that will be included in the virtual file.</span>

<span class="sd">        Yields</span>
<span class="sd">        ------</span>
<span class="sd">        fname</span>
<span class="sd">            The name of virtual file. Pass this as a file name argument to a GMT module.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from pygmt.helpers.testing import load_static_earth_relief</span>
<span class="sd">        &gt;&gt;&gt; from pygmt.helpers import GMTTempFile</span>
<span class="sd">        &gt;&gt;&gt; data = load_static_earth_relief()</span>
<span class="sd">        &gt;&gt;&gt; print(data.shape)</span>
<span class="sd">        (14, 8)</span>
<span class="sd">        &gt;&gt;&gt; print(data.lon.values.min(), data.lon.values.max())</span>
<span class="sd">        -54.5 -47.5</span>
<span class="sd">        &gt;&gt;&gt; print(data.lat.values.min(), data.lat.values.max())</span>
<span class="sd">        -23.5 -10.5</span>
<span class="sd">        &gt;&gt;&gt; print(data.values.min(), data.values.max())</span>
<span class="sd">        190.0 981.0</span>
<span class="sd">        &gt;&gt;&gt; with Session() as ses:</span>
<span class="sd">        ...     with ses.virtualfile_from_grid(data) as fin:</span>
<span class="sd">        ...         # Send the output to a file so that we can read it</span>
<span class="sd">        ...         with GMTTempFile() as fout:</span>
<span class="sd">        ...             ses.call_module(</span>
<span class="sd">        ...                 &quot;grdinfo&quot;, [fin, &quot;-L0&quot;, &quot;-Cn&quot;, f&quot;-&gt;{fout.name}&quot;]</span>
<span class="sd">        ...             )</span>
<span class="sd">        ...             print(fout.read().strip())</span>
<span class="sd">        -55 -47 -24 -10 190 981 1 1 8 14 1 1</span>
<span class="sd">        &gt;&gt;&gt; # The output is: w e s n z0 z1 dx dy n_columns n_rows reg gtype</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_gtype</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;GMT_GRID_IS_CARTESIAN&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;GMT_GRID_IS_GEO&quot;</span><span class="p">}[</span><span class="n">grid</span><span class="o">.</span><span class="n">gmt</span><span class="o">.</span><span class="n">gtype</span><span class="p">]</span>
        <span class="n">_reg</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="s2">&quot;GMT_GRID_NODE_REG&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;GMT_GRID_PIXEL_REG&quot;</span><span class="p">}[</span><span class="n">grid</span><span class="o">.</span><span class="n">gmt</span><span class="o">.</span><span class="n">registration</span><span class="p">]</span>

        <span class="c1"># Conversion to a C-contiguous array needs to be done here and not in put_matrix</span>
        <span class="c1"># because we need to maintain a reference to the copy while it is being used by</span>
        <span class="c1"># the C API. Otherwise, the array would be garbage collected and the memory</span>
        <span class="c1"># freed. Creating it in this context manager guarantees that the copy will be</span>
        <span class="c1"># around until the virtual file is closed. The conversion is implicit in</span>
        <span class="c1"># dataarray_to_matrix.</span>
        <span class="n">matrix</span><span class="p">,</span> <span class="n">region</span><span class="p">,</span> <span class="n">inc</span> <span class="o">=</span> <span class="n">dataarray_to_matrix</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>

        <span class="n">family</span> <span class="o">=</span> <span class="s2">&quot;GMT_IS_GRID|GMT_VIA_MATRIX&quot;</span>
        <span class="n">geometry</span> <span class="o">=</span> <span class="s2">&quot;GMT_IS_SURFACE&quot;</span>
        <span class="n">gmt_grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_data</span><span class="p">(</span>
            <span class="n">family</span><span class="p">,</span>
            <span class="n">geometry</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;GMT_CONTAINER_ONLY|</span><span class="si">{</span><span class="n">_gtype</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">ranges</span><span class="o">=</span><span class="n">region</span><span class="p">,</span>
            <span class="n">inc</span><span class="o">=</span><span class="n">inc</span><span class="p">,</span>
            <span class="n">registration</span><span class="o">=</span><span class="n">_reg</span><span class="p">,</span>  <span class="c1"># type: ignore[arg-type]</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">put_matrix</span><span class="p">(</span><span class="n">gmt_grid</span><span class="p">,</span> <span class="n">matrix</span><span class="p">)</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_virtualfile</span><span class="p">(</span>
            <span class="n">family</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="s2">&quot;GMT_IN|GMT_IS_REFERENCE&quot;</span><span class="p">,</span> <span class="n">gmt_grid</span>
        <span class="p">)</span> <span class="k">as</span> <span class="n">vfile</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">vfile</span></div>


<div class="viewcode-block" id="Session.virtualfile_from_stringio">
<a class="viewcode-back" href="../../../api/generated/pygmt.clib.Session.virtualfile_from_stringio.html#pygmt.clib.Session.virtualfile_from_stringio">[docs]</a>
    <span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">virtualfile_from_stringio</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">stringio</span><span class="p">:</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Store a :class:`io.StringIO` object in a virtual file.</span>

<span class="sd">        Store the contents of a :class:`io.StringIO` object in a GMT_DATASET container</span>
<span class="sd">        and create a virtual file to pass to a GMT module.</span>

<span class="sd">        For simplicity, currently we make following assumptions in the StringIO object</span>

<span class="sd">        - ``&quot;#&quot;`` indicates a comment line.</span>
<span class="sd">        - ``&quot;&gt;&quot;`` indicates a segment header.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        stringio</span>
<span class="sd">            The :class:`io.StringIO` object containing the data to be stored in the</span>
<span class="sd">            virtual file.</span>

<span class="sd">        Yields</span>
<span class="sd">        ------</span>
<span class="sd">        fname</span>
<span class="sd">            The name of the virtual file.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import io</span>
<span class="sd">        &gt;&gt;&gt; from pygmt.clib import Session</span>
<span class="sd">        &gt;&gt;&gt; # A StringIO object containing legend specifications</span>
<span class="sd">        &gt;&gt;&gt; stringio = io.StringIO(</span>
<span class="sd">        ...     &quot;# Comment\n&quot;</span>
<span class="sd">        ...     &quot;H 24p Legend\n&quot;</span>
<span class="sd">        ...     &quot;N 2\n&quot;</span>
<span class="sd">        ...     &quot;S 0.1i c 0.15i p300/12 0.25p 0.3i My circle\n&quot;</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; with Session() as lib:</span>
<span class="sd">        ...     with lib.virtualfile_from_stringio(stringio) as fin:</span>
<span class="sd">        ...         lib.virtualfile_to_dataset(vfname=fin, output_type=&quot;pandas&quot;)</span>
<span class="sd">                                                     0</span>
<span class="sd">        0                                 H 24p Legend</span>
<span class="sd">        1                                          N 2</span>
<span class="sd">        2  S 0.1i c 0.15i p300/12 0.25p 0.3i My circle</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Parse the io.StringIO object.</span>
        <span class="n">segments</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">current_segment</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;header&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">[]}</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">stringio</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">):</span>  <span class="c1"># Skip comments</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;&gt;&quot;</span><span class="p">):</span>  <span class="c1"># Segment header</span>
                <span class="k">if</span> <span class="n">current_segment</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]:</span>  <span class="c1"># If we have data, start a new segment</span>
                    <span class="n">segments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_segment</span><span class="p">)</span>
                    <span class="n">current_segment</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;header&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="p">[]}</span>
                <span class="n">current_segment</span><span class="p">[</span><span class="s2">&quot;header&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;&gt;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">current_segment</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>  <span class="c1"># type: ignore[attr-defined]</span>
        <span class="k">if</span> <span class="n">current_segment</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]:</span>  <span class="c1"># Add the last segment if it has data</span>
            <span class="n">segments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_segment</span><span class="p">)</span>

        <span class="c1"># One table with one or more segments.</span>
        <span class="c1"># n_rows is the maximum number of rows/records for all segments.</span>
        <span class="c1"># n_columns is the number of numeric data columns, so it&#39;s 0 here.</span>
        <span class="n">n_tables</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">n_segments</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">segments</span><span class="p">)</span>
        <span class="n">n_rows</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">segment</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])</span> <span class="k">for</span> <span class="n">segment</span> <span class="ow">in</span> <span class="n">segments</span><span class="p">)</span>
        <span class="n">n_columns</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Create the GMT_DATASET container</span>
        <span class="n">family</span><span class="p">,</span> <span class="n">geometry</span> <span class="o">=</span> <span class="s2">&quot;GMT_IS_DATASET&quot;</span><span class="p">,</span> <span class="s2">&quot;GMT_IS_TEXT&quot;</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_data</span><span class="p">(</span>
            <span class="n">family</span><span class="p">,</span>
            <span class="n">geometry</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;GMT_CONTAINER_ONLY|GMT_WITH_STRINGS&quot;</span><span class="p">,</span>
            <span class="n">dim</span><span class="o">=</span><span class="p">[</span><span class="n">n_tables</span><span class="p">,</span> <span class="n">n_segments</span><span class="p">,</span> <span class="n">n_rows</span><span class="p">,</span> <span class="n">n_columns</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">ctp</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">ctp</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">_GMT_DATASET</span><span class="p">))</span><span class="o">.</span><span class="n">contents</span><span class="o">.</span><span class="n">table</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">contents</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">segment</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">segments</span><span class="p">):</span>
            <span class="n">seg</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">segment</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">contents</span>
            <span class="k">if</span> <span class="n">segment</span><span class="p">[</span><span class="s2">&quot;header&quot;</span><span class="p">]:</span>
                <span class="n">seg</span><span class="o">.</span><span class="n">header</span> <span class="o">=</span> <span class="n">segment</span><span class="p">[</span><span class="s2">&quot;header&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>  <span class="c1"># type: ignore[attr-defined]</span>
            <span class="n">seg</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">strings_to_ctypes_array</span><span class="p">(</span><span class="n">segment</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_virtualfile</span><span class="p">(</span><span class="n">family</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="s2">&quot;GMT_IN&quot;</span><span class="p">,</span> <span class="n">dataset</span><span class="p">)</span> <span class="k">as</span> <span class="n">vfile</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">vfile</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="c1"># Must set the pointers to None to avoid double freeing the memory.</span>
                <span class="c1"># Maybe upstream bug.</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_segments</span><span class="p">):</span>
                    <span class="n">seg</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">segment</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">contents</span>
                    <span class="n">seg</span><span class="o">.</span><span class="n">header</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">seg</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="kc">None</span></div>


    <span class="c1"># TODO(PyGMT&gt;=0.20.0): Remove the deprecated parameter &#39;required_z&#39;.</span>
    <span class="c1"># TODO(PyGMT&gt;=0.20.0): Remove the deprecated parameter &#39;extra_arrays&#39;.</span>
    <span class="c1"># TODO(PyGMT&gt;=0.20.0): Remove the deprecated parameter &#39;required_data&#39;.</span>
<div class="viewcode-block" id="Session.virtualfile_in">
<a class="viewcode-back" href="../../../api/generated/pygmt.clib.Session.virtualfile_in.html#pygmt.clib.Session.virtualfile_in">[docs]</a>
    <span class="nd">@deprecate_parameter</span><span class="p">(</span>
        <span class="s2">&quot;required_data&quot;</span><span class="p">,</span> <span class="s2">&quot;required&quot;</span><span class="p">,</span> <span class="s2">&quot;v0.16.0&quot;</span><span class="p">,</span> <span class="n">remove_version</span><span class="o">=</span><span class="s2">&quot;v0.20.0&quot;</span>
    <span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">virtualfile_in</span><span class="p">(</span>  <span class="c1"># noqa: PLR0912</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">check_kind</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">z</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">mincols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">required_z</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">extra_arrays</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Store any data inside a virtual file.</span>

<span class="sd">        This convenience function automatically detects the kind of data passed</span>
<span class="sd">        into it, and produces a virtualfile that can be passed into GMT later</span>
<span class="sd">        on.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        check_kind : str or None</span>
<span class="sd">            Used to validate the type of data that can be passed in. Choose</span>
<span class="sd">            from &#39;raster&#39;, &#39;vector&#39;, or None. Default is None (no validation).</span>
<span class="sd">        data</span>
<span class="sd">            Any raster or vector data format. This could be a file name or</span>
<span class="sd">            path, a raster grid, a vector matrix/arrays, or other supported</span>
<span class="sd">            data input.</span>
<span class="sd">        x/y/z : 1-D arrays or None</span>
<span class="sd">            x, y, and z columns as numpy arrays.</span>
<span class="sd">        required : bool</span>
<span class="sd">            Set to True when &#39;data&#39; or (&#39;x&#39; and &#39;y&#39;) is required. Set to False when</span>
<span class="sd">            dealing with optional virtual files. Default is True.</span>

<span class="sd">            .. versionchanged:: v0.16.0</span>
<span class="sd">               The parameter &#39;required_data&#39; is renamed to &#39;required&#39;. The parameter</span>
<span class="sd">               &#39;required_data&#39; is deprecated in v0.16.0 and will be removed in v0.20.0.</span>
<span class="sd">        mincols</span>
<span class="sd">            Number of minimum required columns. Default is 2 (i.e. require x and y</span>
<span class="sd">            columns).</span>
<span class="sd">        required_z : bool</span>
<span class="sd">            State whether the &#39;z&#39; column is required.</span>

<span class="sd">            .. deprecated:: v0.16.0</span>
<span class="sd">               The parameter &#39;required_z&#39; will be removed in v0.20.0. Use parameter</span>
<span class="sd">               &#39;mincols&#39; instead. E.g., ``required_z=True`` is equivalent to</span>
<span class="sd">               ``mincols=3``.</span>
<span class="sd">        extra_arrays : list of 1-D arrays</span>
<span class="sd">            A list of numpy arrays in addition to x, y, and z. All of these arrays must</span>
<span class="sd">            be of the same size as the x/y/z arrays.</span>

<span class="sd">            .. deprecated:: v0.16.0</span>
<span class="sd">               The parameter &#39;extra_arrays&#39; will be removed in v0.20.0. Prepare and pass</span>
<span class="sd">               a dictionary of arrays instead to the `data` parameter. E.g.,</span>
<span class="sd">               ``data={&quot;x&quot;: x, &quot;y&quot;: y, &quot;size&quot;: size}``.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        file_context : contextlib._GeneratorContextManager</span>
<span class="sd">            The virtual file stored inside a context manager. Access the file</span>
<span class="sd">            name of this virtualfile using ``with file_context as fname: ...``.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from pygmt.helpers import GMTTempFile</span>
<span class="sd">        &gt;&gt;&gt; import xarray as xr</span>
<span class="sd">        &gt;&gt;&gt; data = xr.Dataset(</span>
<span class="sd">        ...     coords=dict(index=[0, 1, 2]),</span>
<span class="sd">        ...     data_vars=dict(</span>
<span class="sd">        ...         x=(&quot;index&quot;, [9, 8, 7]),</span>
<span class="sd">        ...         y=(&quot;index&quot;, [6, 5, 4]),</span>
<span class="sd">        ...         z=(&quot;index&quot;, [3, 2, 1]),</span>
<span class="sd">        ...     ),</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; with Session() as ses:</span>
<span class="sd">        ...     with ses.virtualfile_in(check_kind=&quot;vector&quot;, data=data) as fin:</span>
<span class="sd">        ...         # Send the output to a file so that we can read it</span>
<span class="sd">        ...         with GMTTempFile() as fout:</span>
<span class="sd">        ...             ses.call_module(&quot;info&quot;, [fin, f&quot;-&gt;{fout.name}&quot;])</span>
<span class="sd">        ...             print(fout.read().strip())</span>
<span class="sd">        &lt;vector memory&gt;: N = 3 &lt;7/9&gt; &lt;4/6&gt; &lt;1/3&gt;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">required_z</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;The parameter &#39;required_z&#39; is deprecated in v0.16.0 and will be &quot;</span>
                <span class="s2">&quot;removed in v0.20.0. Use parameter &#39;mincols&#39; instead. E.g., &quot;</span>
                <span class="s2">&quot;``required_z=True`` is equivalent to ``mincols=3``.&quot;</span><span class="p">,</span>
                <span class="n">category</span><span class="o">=</span><span class="ne">FutureWarning</span><span class="p">,</span>
                <span class="n">stacklevel</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">mincols</span> <span class="o">=</span> <span class="mi">3</span>

        <span class="n">kind</span> <span class="o">=</span> <span class="n">data_kind</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="n">required</span><span class="p">)</span>
        <span class="n">_validate_data_input</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
            <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
            <span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span>
            <span class="n">required</span><span class="o">=</span><span class="n">required</span><span class="p">,</span>
            <span class="n">mincols</span><span class="o">=</span><span class="n">mincols</span><span class="p">,</span>
            <span class="n">kind</span><span class="o">=</span><span class="n">kind</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">check_kind</span><span class="p">:</span>
            <span class="n">valid_kinds</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;file&quot;</span><span class="p">,</span> <span class="s2">&quot;arg&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">required</span> <span class="ow">is</span> <span class="kc">False</span> <span class="k">else</span> <span class="p">(</span><span class="s2">&quot;file&quot;</span><span class="p">,)</span>
            <span class="k">if</span> <span class="n">check_kind</span> <span class="o">==</span> <span class="s2">&quot;raster&quot;</span><span class="p">:</span>
                <span class="n">valid_kinds</span> <span class="o">+=</span> <span class="p">(</span><span class="s2">&quot;grid&quot;</span><span class="p">,</span> <span class="s2">&quot;image&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">check_kind</span> <span class="o">==</span> <span class="s2">&quot;vector&quot;</span><span class="p">:</span>
                <span class="n">valid_kinds</span> <span class="o">+=</span> <span class="p">(</span><span class="s2">&quot;empty&quot;</span><span class="p">,</span> <span class="s2">&quot;matrix&quot;</span><span class="p">,</span> <span class="s2">&quot;vectors&quot;</span><span class="p">,</span> <span class="s2">&quot;geojson&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">kind</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_kinds</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">GMTTypeError</span><span class="p">(</span>
                    <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">),</span>
                    <span class="n">reason</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Unrecognized data type for </span><span class="si">{</span><span class="n">check_kind</span><span class="si">!r}</span><span class="s2"> kind.&quot;</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="c1"># Decide which virtualfile_from_ function to use</span>
        <span class="n">_virtualfile_from</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;arg&quot;</span><span class="p">:</span> <span class="n">contextlib</span><span class="o">.</span><span class="n">nullcontext</span><span class="p">,</span>
            <span class="s2">&quot;empty&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">virtualfile_from_vectors</span><span class="p">,</span>
            <span class="s2">&quot;file&quot;</span><span class="p">:</span> <span class="n">contextlib</span><span class="o">.</span><span class="n">nullcontext</span><span class="p">,</span>
            <span class="s2">&quot;geojson&quot;</span><span class="p">:</span> <span class="n">tempfile_from_geojson</span><span class="p">,</span>
            <span class="s2">&quot;grid&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">virtualfile_from_grid</span><span class="p">,</span>
            <span class="s2">&quot;image&quot;</span><span class="p">:</span> <span class="n">tempfile_from_image</span><span class="p">,</span>
            <span class="s2">&quot;stringio&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">virtualfile_from_stringio</span><span class="p">,</span>
            <span class="s2">&quot;matrix&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">virtualfile_from_matrix</span><span class="p">,</span>
            <span class="s2">&quot;vectors&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">virtualfile_from_vectors</span><span class="p">,</span>
        <span class="p">}[</span><span class="n">kind</span><span class="p">]</span>

        <span class="c1"># &quot;_data&quot; is the data that will be passed to the _virtualfile_from function.</span>
        <span class="c1"># &quot;_data&quot; defaults to &quot;data&quot; but should be adjusted for some cases.</span>
        <span class="n">_data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">match</span> <span class="n">kind</span><span class="p">:</span>
            <span class="k">case</span> <span class="s2">&quot;image&quot;</span> <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="s2">&quot;uint8&quot;</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Input image has dtype: </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s2"> which is unsupported, and &quot;</span>
                    <span class="s2">&quot;may result in an incorrect output. Please recast image to a uint8 &quot;</span>
                    <span class="s2">&quot;dtype and/or scale to 0-255 range, e.g. using a histogram &quot;</span>
                    <span class="s2">&quot;equalization function like skimage.exposure.equalize_hist.&quot;</span>
                <span class="p">)</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">RuntimeWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">case</span> <span class="s2">&quot;empty&quot;</span><span class="p">:</span>  <span class="c1"># data is None, so data must be given via x/y/z.</span>
                <span class="n">_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">z</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">extra_arrays</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="s2">&quot;The parameter &#39;extra_arrays&#39; will be removed in v0.20.0. &quot;</span>
                        <span class="s2">&quot;Prepare and pass a dictionary of arrays instead to the `data` &quot;</span>
                        <span class="s2">&quot;parameter. E.g., `data={&#39;x&#39;: x, &#39;y&#39;: y, &#39;size&#39;: size}`&quot;</span>
                    <span class="p">)</span>
                    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="n">message</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">FutureWarning</span><span class="p">,</span> <span class="n">stacklevel</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">_data</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">extra_arrays</span><span class="p">)</span>
            <span class="k">case</span> <span class="s2">&quot;vectors&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;items&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;to_frame&quot;</span><span class="p">):</span>
                    <span class="c1"># Dictionary, pandas.DataFrame or xarray.Dataset types.</span>
                    <span class="c1"># pandas.Series will be handled below like a 1-D numpy.ndarray.</span>
                    <span class="n">_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">array</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">array</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Python list, tuple, numpy.ndarray, and pandas.Series types</span>
                    <span class="n">_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asanyarray</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
            <span class="k">case</span> <span class="s2">&quot;matrix&quot;</span> <span class="k">if</span> <span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">kind</span> <span class="ow">not</span> <span class="ow">in</span> <span class="s2">&quot;iuf&quot;</span><span class="p">:</span>
                <span class="c1"># GMT can only accept a 2-D matrix which are signed integer (i),</span>
                <span class="c1"># unsigned integer (u) or floating point (f) types. For other data</span>
                <span class="c1"># types, we need to use virtualfile_from_vectors instead, which turns</span>
                <span class="c1"># the matrix into a list of vectors and allows for better handling of</span>
                <span class="c1"># non-integer/float type inputs (e.g. for string or datetime data types)</span>
                <span class="n">_virtualfile_from</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">virtualfile_from_vectors</span>
                <span class="n">_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">T</span>

        <span class="c1"># Finally create the virtualfile from the data, to be passed into GMT</span>
        <span class="n">file_context</span> <span class="o">=</span> <span class="n">_virtualfile_from</span><span class="p">(</span><span class="n">_data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">file_context</span></div>


<div class="viewcode-block" id="Session.virtualfile_out">
<a class="viewcode-back" href="../../../api/generated/pygmt.clib.Session.virtualfile_out.html#pygmt.clib.Session.virtualfile_out">[docs]</a>
    <span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">virtualfile_out</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">kind</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;dataset&quot;</span><span class="p">,</span> <span class="s2">&quot;grid&quot;</span><span class="p">,</span> <span class="s2">&quot;image&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;dataset&quot;</span><span class="p">,</span>
        <span class="n">fname</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a virtual file or an actual file for storing output data.</span>

<span class="sd">        If ``fname`` is not given, a virtual file will be created to store the output</span>
<span class="sd">        data into a GMT data container and the function yields the name of the virtual</span>
<span class="sd">        file. Otherwise, the output data will be written into the specified file and the</span>
<span class="sd">        function simply yields the actual file name.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        kind</span>
<span class="sd">            The data kind of the virtual file to create. Valid values are ``&quot;dataset&quot;``,</span>
<span class="sd">            ``&quot;grid&quot;``, and ``&quot;image&quot;``. Ignored if ``fname`` is specified.</span>
<span class="sd">        fname</span>
<span class="sd">            The name of the actual file to write the output data. No virtual file will</span>
<span class="sd">            be created.</span>

<span class="sd">        Yields</span>
<span class="sd">        ------</span>
<span class="sd">        vfile</span>
<span class="sd">            Name of the virtual file or the actual file.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from pathlib import Path</span>
<span class="sd">        &gt;&gt;&gt; from pygmt.clib import Session</span>
<span class="sd">        &gt;&gt;&gt; from pygmt.datatypes import _GMT_DATASET</span>
<span class="sd">        &gt;&gt;&gt; from pygmt.helpers import GMTTempFile</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; with GMTTempFile(suffix=&quot;.txt&quot;) as tmpfile:</span>
<span class="sd">        ...     with Path(tmpfile.name).open(mode=&quot;w&quot;) as fp:</span>
<span class="sd">        ...         print(&quot;1.0 2.0 3.0 TEXT&quot;, file=fp)</span>
<span class="sd">        ...</span>
<span class="sd">        ...     # Create a virtual file for storing the output table.</span>
<span class="sd">        ...     with Session() as lib:</span>
<span class="sd">        ...         with lib.virtualfile_out(kind=&quot;dataset&quot;) as vouttbl:</span>
<span class="sd">        ...             lib.call_module(&quot;read&quot;, [tmpfile.name, vouttbl, &quot;-Td&quot;])</span>
<span class="sd">        ...             ds = lib.read_virtualfile(vouttbl, kind=&quot;dataset&quot;)</span>
<span class="sd">        ...             assert isinstance(ds.contents, _GMT_DATASET)</span>
<span class="sd">        ...</span>
<span class="sd">        ...     # Write data to an actual file without creating a virtual file.</span>
<span class="sd">        ...     with Session() as lib:</span>
<span class="sd">        ...         with lib.virtualfile_out(fname=tmpfile.name) as vouttbl:</span>
<span class="sd">        ...             assert vouttbl == tmpfile.name</span>
<span class="sd">        ...             lib.call_module(&quot;read&quot;, [tmpfile.name, vouttbl, &quot;-Td&quot;])</span>
<span class="sd">        ...         line = Path(vouttbl).read_text()</span>
<span class="sd">        ...         assert line == &quot;1\t2\t3\tTEXT\n&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">fname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># Yield the actual file name.</span>
            <span class="k">yield</span> <span class="n">fname</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># Create a virtual file for storing the output data.</span>
            <span class="c1"># Determine the family and geometry from kind</span>
            <span class="n">family</span><span class="p">,</span> <span class="n">geometry</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;dataset&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;GMT_IS_DATASET&quot;</span><span class="p">,</span> <span class="s2">&quot;GMT_IS_PLP&quot;</span><span class="p">),</span>
                <span class="s2">&quot;grid&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;GMT_IS_GRID&quot;</span><span class="p">,</span> <span class="s2">&quot;GMT_IS_SURFACE&quot;</span><span class="p">),</span>
                <span class="s2">&quot;image&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;GMT_IS_IMAGE&quot;</span><span class="p">,</span> <span class="s2">&quot;GMT_IS_SURFACE&quot;</span><span class="p">),</span>
            <span class="p">}[</span><span class="n">kind</span><span class="p">]</span>
            <span class="n">direction</span> <span class="o">=</span> <span class="s2">&quot;GMT_OUT|GMT_IS_REFERENCE&quot;</span> <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s2">&quot;image&quot;</span> <span class="k">else</span> <span class="s2">&quot;GMT_OUT&quot;</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_virtualfile</span><span class="p">(</span><span class="n">family</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">direction</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">as</span> <span class="n">vfile</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">vfile</span></div>


<div class="viewcode-block" id="Session.inquire_virtualfile">
<a class="viewcode-back" href="../../../api/generated/pygmt.clib.Session.inquire_virtualfile.html#pygmt.clib.Session.inquire_virtualfile">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">inquire_virtualfile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vfname</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the family of a virtual file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        vfname</span>
<span class="sd">            Name of the virtual file to inquire.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        family</span>
<span class="sd">            The integer value for the family of the virtual file.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from pygmt.clib import Session</span>
<span class="sd">        &gt;&gt;&gt; with Session() as lib:</span>
<span class="sd">        ...     with lib.virtualfile_out(kind=&quot;dataset&quot;) as vfile:</span>
<span class="sd">        ...         family = lib.inquire_virtualfile(vfile)</span>
<span class="sd">        ...         assert family == lib[&quot;GMT_IS_DATASET&quot;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">c_inquire_virtualfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_libgmt_func</span><span class="p">(</span>
            <span class="s2">&quot;GMT_Inquire_VirtualFile&quot;</span><span class="p">,</span>
            <span class="n">argtypes</span><span class="o">=</span><span class="p">[</span><span class="n">ctp</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span> <span class="n">ctp</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">],</span>
            <span class="n">restype</span><span class="o">=</span><span class="n">ctp</span><span class="o">.</span><span class="n">c_int</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">c_inquire_virtualfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session_pointer</span><span class="p">,</span> <span class="n">vfname</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span></div>


<div class="viewcode-block" id="Session.read_virtualfile">
<a class="viewcode-back" href="../../../api/generated/pygmt.clib.Session.read_virtualfile.html#pygmt.clib.Session.read_virtualfile">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">read_virtualfile</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">vfname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">kind</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;dataset&quot;</span><span class="p">,</span> <span class="s2">&quot;grid&quot;</span><span class="p">,</span> <span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="s2">&quot;cube&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read data from a virtual file and optionally cast into a GMT data container.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        vfname</span>
<span class="sd">            Name of the virtual file to read.</span>
<span class="sd">        kind</span>
<span class="sd">            Cast the data into a GMT data container. Valid values are ``&quot;dataset&quot;``,</span>
<span class="sd">            ``&quot;grid&quot;``, ``&quot;image&quot;`` and ``None``. If ``None``, will return a ctypes void</span>
<span class="sd">            pointer.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        pointer</span>
<span class="sd">            Pointer to the GMT data container. If ``kind`` is ``None``, returns a ctypes</span>
<span class="sd">            void pointer instead.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from pathlib import Path</span>
<span class="sd">        &gt;&gt;&gt; from pygmt.clib import Session</span>
<span class="sd">        &gt;&gt;&gt; from pygmt.helpers import GMTTempFile</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Read dataset from a virtual file</span>
<span class="sd">        &gt;&gt;&gt; with Session() as lib:</span>
<span class="sd">        ...     with GMTTempFile(suffix=&quot;.txt&quot;) as tmpfile:</span>
<span class="sd">        ...         with Path(tmpfile.name).open(mode=&quot;w&quot;) as fp:</span>
<span class="sd">        ...             print(&quot;1.0 2.0 3.0 TEXT&quot;, file=fp)</span>
<span class="sd">        ...         with lib.virtualfile_out(kind=&quot;dataset&quot;) as vouttbl:</span>
<span class="sd">        ...             lib.call_module(&quot;read&quot;, [tmpfile.name, vouttbl, &quot;-Td&quot;])</span>
<span class="sd">        ...             # Read the virtual file as a void pointer</span>
<span class="sd">        ...             void_pointer = lib.read_virtualfile(vouttbl)</span>
<span class="sd">        ...             assert isinstance(void_pointer, int)  # void pointer is an int</span>
<span class="sd">        ...             # Read the virtual file as a dataset</span>
<span class="sd">        ...             data_pointer = lib.read_virtualfile(vouttbl, kind=&quot;dataset&quot;)</span>
<span class="sd">        ...             assert isinstance(data_pointer, ctp.POINTER(_GMT_DATASET))</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Read grid from a virtual file</span>
<span class="sd">        &gt;&gt;&gt; with Session() as lib:</span>
<span class="sd">        ...     with lib.virtualfile_out(kind=&quot;grid&quot;) as voutgrd:</span>
<span class="sd">        ...         lib.call_module(&quot;read&quot;, [&quot;@earth_relief_01d_g&quot;, voutgrd, &quot;-Tg&quot;])</span>
<span class="sd">        ...         # Read the virtual file as a void pointer</span>
<span class="sd">        ...         void_pointer = lib.read_virtualfile(voutgrd)</span>
<span class="sd">        ...         assert isinstance(void_pointer, int)  # void pointer is an int</span>
<span class="sd">        ...         data_pointer = lib.read_virtualfile(voutgrd, kind=&quot;grid&quot;)</span>
<span class="sd">        ...         assert isinstance(data_pointer, ctp.POINTER(_GMT_GRID))</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">c_read_virtualfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_libgmt_func</span><span class="p">(</span>
            <span class="s2">&quot;GMT_Read_VirtualFile&quot;</span><span class="p">,</span>
            <span class="n">argtypes</span><span class="o">=</span><span class="p">[</span><span class="n">ctp</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span> <span class="n">ctp</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">],</span>
            <span class="n">restype</span><span class="o">=</span><span class="n">ctp</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">pointer</span> <span class="o">=</span> <span class="n">c_read_virtualfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">session_pointer</span><span class="p">,</span> <span class="n">vfname</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
        <span class="c1"># The GMT C API function GMT_Read_VirtualFile returns a void pointer. It usually</span>
        <span class="c1"># needs to be cast into a pointer to a GMT data container (e.g., _GMT_GRID or</span>
        <span class="c1"># _GMT_DATASET).</span>
        <span class="k">if</span> <span class="n">kind</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># Return the ctypes void pointer</span>
            <span class="k">return</span> <span class="n">pointer</span>
        <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s2">&quot;cube&quot;</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;kind=</span><span class="si">{</span><span class="n">kind</span><span class="si">}</span><span class="s2"> is not supported yet.&quot;</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;dataset&quot;</span><span class="p">:</span> <span class="n">_GMT_DATASET</span><span class="p">,</span> <span class="s2">&quot;grid&quot;</span><span class="p">:</span> <span class="n">_GMT_GRID</span><span class="p">,</span> <span class="s2">&quot;image&quot;</span><span class="p">:</span> <span class="n">_GMT_IMAGE</span><span class="p">}[</span><span class="n">kind</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">ctp</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">pointer</span><span class="p">,</span> <span class="n">ctp</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">dtype</span><span class="p">))</span></div>


<div class="viewcode-block" id="Session.virtualfile_to_dataset">
<a class="viewcode-back" href="../../../api/generated/pygmt.clib.Session.virtualfile_to_dataset.html#pygmt.clib.Session.virtualfile_to_dataset">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">virtualfile_to_dataset</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">vfname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">output_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;pandas&quot;</span><span class="p">,</span> <span class="s2">&quot;numpy&quot;</span><span class="p">,</span> <span class="s2">&quot;file&quot;</span><span class="p">,</span> <span class="s2">&quot;strings&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;pandas&quot;</span><span class="p">,</span>
        <span class="n">header</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">column_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">dtype</span><span class="p">:</span> <span class="nb">type</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">index_col</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Output a tabular dataset stored in a virtual file to a different format.</span>

<span class="sd">        The format of the dataset is determined by the ``output_type`` parameter.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        vfname</span>
<span class="sd">            The virtual file name that stores the result data.</span>
<span class="sd">        output_type</span>
<span class="sd">            Desired output type of the result data.</span>

<span class="sd">            - ``&quot;pandas&quot;`` will return a :class:`pandas.DataFrame` object.</span>
<span class="sd">            - ``&quot;numpy&quot;`` will return a :class:`numpy.ndarray` object.</span>
<span class="sd">            - ``&quot;file&quot;`` means the result was saved to a file and will return ``None``.</span>
<span class="sd">            - ``&quot;strings&quot;`` will return the trailing text only as an array of strings.</span>
<span class="sd">        header</span>
<span class="sd">            Row number containing column names for the :class:`pandas.DataFrame` output.</span>
<span class="sd">            ``header=None`` means not to parse the column names from table header.</span>
<span class="sd">            Ignored if the row number is larger than the number of headers in the table.</span>
<span class="sd">        column_names</span>
<span class="sd">            The column names for the :class:`pandas.DataFrame` output.</span>
<span class="sd">        dtype</span>
<span class="sd">            Data type for the columns of the :class:`pandas.DataFrame` output. Can be a</span>
<span class="sd">            single type for all columns or a dictionary mapping column names to types.</span>
<span class="sd">        index_col</span>
<span class="sd">            Column to set as the index of the :class:`pandas.DataFrame` output.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        result</span>
<span class="sd">            The result dataset. If ``output_type=&quot;file&quot;`` returns ``None``.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from pathlib import Path</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; from pygmt.helpers import GMTTempFile</span>
<span class="sd">        &gt;&gt;&gt; from pygmt.clib import Session</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; with GMTTempFile(suffix=&quot;.txt&quot;) as tmpfile:</span>
<span class="sd">        ...     # prepare the sample data file</span>
<span class="sd">        ...     with Path(tmpfile.name).open(mode=&quot;w&quot;) as fp:</span>
<span class="sd">        ...         print(&quot;&gt;&quot;, file=fp)</span>
<span class="sd">        ...         print(&quot;1.0 2.0 3.0 TEXT1 TEXT23&quot;, file=fp)</span>
<span class="sd">        ...         print(&quot;4.0 5.0 6.0 TEXT4 TEXT567&quot;, file=fp)</span>
<span class="sd">        ...         print(&quot;&gt;&quot;, file=fp)</span>
<span class="sd">        ...         print(&quot;7.0 8.0 9.0 TEXT8 TEXT90&quot;, file=fp)</span>
<span class="sd">        ...         print(&quot;10.0 11.0 12.0 TEXT123 TEXT456789&quot;, file=fp)</span>
<span class="sd">        ...</span>
<span class="sd">        ...     # file output</span>
<span class="sd">        ...     with Session() as lib:</span>
<span class="sd">        ...         with GMTTempFile(suffix=&quot;.txt&quot;) as outtmp:</span>
<span class="sd">        ...             with lib.virtualfile_out(</span>
<span class="sd">        ...                 kind=&quot;dataset&quot;, fname=outtmp.name</span>
<span class="sd">        ...             ) as vouttbl:</span>
<span class="sd">        ...                 lib.call_module(&quot;read&quot;, [tmpfile.name, vouttbl, &quot;-Td&quot;])</span>
<span class="sd">        ...                 result = lib.virtualfile_to_dataset(</span>
<span class="sd">        ...                     vfname=vouttbl, output_type=&quot;file&quot;</span>
<span class="sd">        ...                 )</span>
<span class="sd">        ...                 assert result is None</span>
<span class="sd">        ...                 assert Path(outtmp.name).stat().st_size &gt; 0</span>
<span class="sd">        ...</span>
<span class="sd">        ...     # strings, numpy and pandas outputs</span>
<span class="sd">        ...     with Session() as lib:</span>
<span class="sd">        ...         with lib.virtualfile_out(kind=&quot;dataset&quot;) as vouttbl:</span>
<span class="sd">        ...             lib.call_module(&quot;read&quot;, [tmpfile.name, vouttbl, &quot;-Td&quot;])</span>
<span class="sd">        ...</span>
<span class="sd">        ...             # strings output</span>
<span class="sd">        ...             outstr = lib.virtualfile_to_dataset(</span>
<span class="sd">        ...                 vfname=vouttbl, output_type=&quot;strings&quot;</span>
<span class="sd">        ...             )</span>
<span class="sd">        ...             assert isinstance(outstr, np.ndarray)</span>
<span class="sd">        ...             assert outstr.dtype.kind in (&quot;S&quot;, &quot;U&quot;)</span>
<span class="sd">        ...</span>
<span class="sd">        ...             # numpy output</span>
<span class="sd">        ...             outnp = lib.virtualfile_to_dataset(</span>
<span class="sd">        ...                 vfname=vouttbl, output_type=&quot;numpy&quot;</span>
<span class="sd">        ...             )</span>
<span class="sd">        ...             assert isinstance(outnp, np.ndarray)</span>
<span class="sd">        ...</span>
<span class="sd">        ...             # pandas output</span>
<span class="sd">        ...             outpd = lib.virtualfile_to_dataset(</span>
<span class="sd">        ...                 vfname=vouttbl, output_type=&quot;pandas&quot;</span>
<span class="sd">        ...             )</span>
<span class="sd">        ...             assert isinstance(outpd, pd.DataFrame)</span>
<span class="sd">        ...</span>
<span class="sd">        ...             # pandas output with specified column names</span>
<span class="sd">        ...             outpd2 = lib.virtualfile_to_dataset(</span>
<span class="sd">        ...                 vfname=vouttbl,</span>
<span class="sd">        ...                 output_type=&quot;pandas&quot;,</span>
<span class="sd">        ...                 column_names=[&quot;col1&quot;, &quot;col2&quot;, &quot;col3&quot;, &quot;coltext&quot;],</span>
<span class="sd">        ...             )</span>
<span class="sd">        ...             assert isinstance(outpd2, pd.DataFrame)</span>
<span class="sd">        &gt;&gt;&gt; outstr</span>
<span class="sd">        array([&#39;TEXT1 TEXT23&#39;, &#39;TEXT4 TEXT567&#39;, &#39;TEXT8 TEXT90&#39;,</span>
<span class="sd">           &#39;TEXT123 TEXT456789&#39;], dtype=&#39;&lt;U18&#39;)</span>
<span class="sd">        &gt;&gt;&gt; outnp</span>
<span class="sd">        array([[1.0, 2.0, 3.0, &#39;TEXT1 TEXT23&#39;],</span>
<span class="sd">               [4.0, 5.0, 6.0, &#39;TEXT4 TEXT567&#39;],</span>
<span class="sd">               [7.0, 8.0, 9.0, &#39;TEXT8 TEXT90&#39;],</span>
<span class="sd">               [10.0, 11.0, 12.0, &#39;TEXT123 TEXT456789&#39;]], dtype=object)</span>
<span class="sd">        &gt;&gt;&gt; outpd</span>
<span class="sd">              0     1     2                   3</span>
<span class="sd">        0   1.0   2.0   3.0        TEXT1 TEXT23</span>
<span class="sd">        1   4.0   5.0   6.0       TEXT4 TEXT567</span>
<span class="sd">        2   7.0   8.0   9.0        TEXT8 TEXT90</span>
<span class="sd">        3  10.0  11.0  12.0  TEXT123 TEXT456789</span>
<span class="sd">        &gt;&gt;&gt; outpd2</span>
<span class="sd">           col1  col2  col3             coltext</span>
<span class="sd">        0   1.0   2.0   3.0        TEXT1 TEXT23</span>
<span class="sd">        1   4.0   5.0   6.0       TEXT4 TEXT567</span>
<span class="sd">        2   7.0   8.0   9.0        TEXT8 TEXT90</span>
<span class="sd">        3  10.0  11.0  12.0  TEXT123 TEXT456789</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">output_type</span> <span class="o">==</span> <span class="s2">&quot;file&quot;</span><span class="p">:</span>  <span class="c1"># Already written to file, so return None</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Read the virtual file as a _GMT_DATASET object</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_virtualfile</span><span class="p">(</span><span class="n">vfname</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;dataset&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">contents</span>

        <span class="k">if</span> <span class="n">output_type</span> <span class="o">==</span> <span class="s2">&quot;strings&quot;</span><span class="p">:</span>  <span class="c1"># strings output</span>
            <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">to_strings</span><span class="p">()</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">(</span>
            <span class="n">header</span><span class="o">=</span><span class="n">header</span><span class="p">,</span> <span class="n">column_names</span><span class="o">=</span><span class="n">column_names</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="n">index_col</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">output_type</span> <span class="o">==</span> <span class="s2">&quot;numpy&quot;</span><span class="p">:</span>  <span class="c1"># numpy.ndarray output</span>
            <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">result</span>  <span class="c1"># pandas.DataFrame output</span></div>


<div class="viewcode-block" id="Session.virtualfile_to_raster">
<a class="viewcode-back" href="../../../api/generated/pygmt.clib.Session.virtualfile_to_raster.html#pygmt.clib.Session.virtualfile_to_raster">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">virtualfile_to_raster</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">vfname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">kind</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;grid&quot;</span><span class="p">,</span> <span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="s2">&quot;cube&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;grid&quot;</span><span class="p">,</span>
        <span class="n">outgrid</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Output raster data stored in a virtual file to an :class:`xarray.DataArray`</span>
<span class="sd">        object.</span>

<span class="sd">        The raster data can be a grid, an image or a cube.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        vfname</span>
<span class="sd">            The virtual file name that stores the result grid/image/cube.</span>
<span class="sd">        kind</span>
<span class="sd">            Type of the raster data. Valid values are ``&quot;grid&quot;``, ``&quot;image&quot;``,</span>
<span class="sd">            ``&quot;cube&quot;`` or ``None``. If ``None``, will inquire the data type from the</span>
<span class="sd">            virtual file name.</span>
<span class="sd">        outgrid</span>
<span class="sd">            Name of the output grid/image/cube. If specified, it means the raster data</span>
<span class="sd">            was already saved into an actual file and will return ``None``.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        result</span>
<span class="sd">            The result grid/image/cube. If ``outgrid`` is specified, return ``None``.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; from pathlib import Path</span>
<span class="sd">        &gt;&gt;&gt; from pygmt.clib import Session</span>
<span class="sd">        &gt;&gt;&gt; from pygmt.helpers import GMTTempFile</span>
<span class="sd">        &gt;&gt;&gt; with Session() as lib:</span>
<span class="sd">        ...     # file output</span>
<span class="sd">        ...     with GMTTempFile(suffix=&quot;.nc&quot;) as tmpfile:</span>
<span class="sd">        ...         outgrid = tmpfile.name</span>
<span class="sd">        ...         with lib.virtualfile_out(kind=&quot;grid&quot;, fname=outgrid) as voutgrd:</span>
<span class="sd">        ...             lib.call_module(&quot;read&quot;, [&quot;@earth_relief_01d_g&quot;, voutgrd, &quot;-Tg&quot;])</span>
<span class="sd">        ...             result = lib.virtualfile_to_raster(</span>
<span class="sd">        ...                 vfname=voutgrd, outgrid=outgrid</span>
<span class="sd">        ...             )</span>
<span class="sd">        ...             assert result == None</span>
<span class="sd">        ...             assert Path(outgrid).stat().st_size &gt; 0</span>
<span class="sd">        ...</span>
<span class="sd">        ...     # xarray.DataArray output</span>
<span class="sd">        ...     outgrid = None</span>
<span class="sd">        ...     with lib.virtualfile_out(kind=&quot;grid&quot;, fname=outgrid) as voutgrd:</span>
<span class="sd">        ...         lib.call_module(&quot;read&quot;, [&quot;@earth_relief_01d_g&quot;, voutgrd, &quot;-Tg&quot;])</span>
<span class="sd">        ...         result = lib.virtualfile_to_raster(vfname=voutgrd, outgrid=outgrid)</span>
<span class="sd">        ...         assert isinstance(result, xr.DataArray)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">outgrid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># Already written to file, so return None</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">kind</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># Inquire the data family from the virtualfile</span>
            <span class="n">family</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inquire_virtualfile</span><span class="p">(</span><span class="n">vfname</span><span class="p">)</span>
            <span class="n">kind</span> <span class="o">=</span> <span class="p">{</span>  <span class="c1"># type: ignore[assignment]</span>
                <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;GMT_IS_GRID&quot;</span><span class="p">]:</span> <span class="s2">&quot;grid&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;GMT_IS_IMAGE&quot;</span><span class="p">]:</span> <span class="s2">&quot;image&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;GMT_IS_CUBE&quot;</span><span class="p">]:</span> <span class="s2">&quot;cube&quot;</span><span class="p">,</span>
            <span class="p">}[</span><span class="n">family</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_virtualfile</span><span class="p">(</span><span class="n">vfname</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">kind</span><span class="p">)</span><span class="o">.</span><span class="n">contents</span><span class="o">.</span><span class="n">to_xarray</span><span class="p">()</span></div>


<div class="viewcode-block" id="Session.extract_region">
<a class="viewcode-back" href="../../../api/generated/pygmt.clib.Session.extract_region.html#pygmt.clib.Session.extract_region">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">extract_region</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extract the region of the currently active figure.</span>

<span class="sd">        Retrieves the information from the PostScript file, so it works for country</span>
<span class="sd">        codes as well.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        region</span>
<span class="sd">            A numpy 1-D array with the west, east, south, and north dimensions of the</span>
<span class="sd">            current figure.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; import pygmt</span>
<span class="sd">        &gt;&gt;&gt; fig = pygmt.Figure()</span>
<span class="sd">        &gt;&gt;&gt; fig.coast(</span>
<span class="sd">        ...     region=[0, 10, -20, -10], projection=&quot;M12c&quot;, frame=True, land=&quot;black&quot;</span>
<span class="sd">        ... )</span>
<span class="sd">        &gt;&gt;&gt; with Session() as lib:</span>
<span class="sd">        ...     region = lib.extract_region()</span>
<span class="sd">        &gt;&gt;&gt; print(&quot;, &quot;.join([f&quot;{x:.2f}&quot; for x in region]))</span>
<span class="sd">        0.00, 10.00, -20.00, -10.00</span>

<span class="sd">        Using ISO country codes for the regions (for example ``&quot;US.HI&quot;`` for Hawaii):</span>

<span class="sd">        &gt;&gt;&gt; fig = pygmt.Figure()</span>
<span class="sd">        &gt;&gt;&gt; fig.coast(region=&quot;US.HI&quot;, projection=&quot;M12c&quot;, frame=True, land=&quot;black&quot;)</span>
<span class="sd">        &gt;&gt;&gt; with Session() as lib:</span>
<span class="sd">        ...     region = lib.extract_region()</span>
<span class="sd">        &gt;&gt;&gt; print(&quot;, &quot;.join([f&quot;{x:.2f}&quot; for x in region]))</span>
<span class="sd">        -164.71, -154.81, 18.91, 23.58</span>

<span class="sd">        The country codes can have an extra argument that rounds the region to multiples</span>
<span class="sd">        of the argument (for example, ``&quot;US.HI+r5&quot;`` will round the region to multiples</span>
<span class="sd">        of 5):</span>

<span class="sd">        &gt;&gt;&gt; fig = pygmt.Figure()</span>
<span class="sd">        &gt;&gt;&gt; fig.coast(region=&quot;US.HI+r5&quot;, projection=&quot;M12c&quot;, frame=True, land=&quot;black&quot;)</span>
<span class="sd">        &gt;&gt;&gt; with Session() as lib:</span>
<span class="sd">        ...     region = lib.extract_region()</span>
<span class="sd">        &gt;&gt;&gt; print(&quot;, &quot;.join([f&quot;{x:.2f}&quot; for x in region]))</span>
<span class="sd">        -165.00, -150.00, 15.00, 25.00</span>
<span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa: RUF002</span>
        <span class="n">c_extract_region</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_libgmt_func</span><span class="p">(</span>
            <span class="s2">&quot;GMT_Extract_Region&quot;</span><span class="p">,</span>
            <span class="n">argtypes</span><span class="o">=</span><span class="p">[</span><span class="n">ctp</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span> <span class="n">ctp</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">,</span> <span class="n">ctp</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctp</span><span class="o">.</span><span class="n">c_double</span><span class="p">)],</span>
            <span class="n">restype</span><span class="o">=</span><span class="n">ctp</span><span class="o">.</span><span class="n">c_int</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">region</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">c_extract_region</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">session_pointer</span><span class="p">,</span>
            <span class="kc">None</span><span class="p">,</span>  <span class="c1"># File pointer to a PostScript file. Must be None in modern mode.</span>
            <span class="n">region</span><span class="o">.</span><span class="n">ctypes</span><span class="o">.</span><span class="n">data_as</span><span class="p">(</span><span class="n">ctp</span><span class="o">.</span><span class="n">POINTER</span><span class="p">(</span><span class="n">ctp</span><span class="o">.</span><span class="n">c_double</span><span class="p">)),</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Failed to extract region from current figure.&quot;</span>
            <span class="k">raise</span> <span class="n">GMTCLibError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">region</span></div>
</div>

</pre></div>

           </div>
          </div>
          
<footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017-2026, The PyGMT Developers.
      <span class="commit">Revision <code><a href="https://github.com/GenericMappingTools/pygmt/commit/81de8f0e2">81de8f0e</a></code>.
      </span>
      <span class="lastupdated">Last updated on Feb 20, 2026.
      </span></p>
  </div>

  
<p>
Built with <a href="https://www.sphinx-doc.org/">Sphinx</a>
using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
provided by <a href="https://readthedocs.org">Read the Docs</a>
</p>
<p>
This website uses Google Analytics to gather usage statistics.
However, it does not use cookies or track you across different websites.
Page view data are used to help us improve the site and provide an estimate of the
software usage.
</p>


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>