
<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
        <title>pygmt.src.nearneighbor &mdash; PyGMT</title>
    

      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/sg_gallery.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/sg_gallery-binder.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/sg_gallery-dataframe.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/sg_gallery-rendered-html.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/style.css" type="text/css" />
    <link rel="shortcut icon" href="../../../_static/favicon.png"/>
    <link rel="canonical" href="https://pygmt.org/dev/_modules/pygmt/src/nearneighbor.html" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
        <script src="../../../_static/clipboard.min.js"></script>
        <script src="../../../_static/copybutton.js"></script>
        <script src="../../../_static/design-tabs.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <!-- Google Analytics tracking code -->
    <!-- See https://developers.google.com/analytics/devguides/collection/analyticsjs/ for documentation. -->
    <!-- 'storage': 'none' disables cookies -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new
            Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-38125837-7', 'auto', {'storage': 'none'});
      ga('set', 'anonymizeIp', true);
      ga('send', 'pageview');
    </script>

    <!-- Documentation switcher -->
    <!-- Point to the *dev* version switcher. This will allow the latest versions to appear on older documentation. -->
    <script type="text/javascript" src="/dev/_static/version_switch.js"></script>

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
    <a href="../../../index.html"><h2 class="sidebar-title">PyGMT</h2></a>

    
        
        
            <div class="version">
                dev
            </div>
        
    

    
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>


        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
    
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../get_started/index.html">Intro to PyGMT</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../gallery/index.html">Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../projections/index.html">Projections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../external_resources.html">External Resources</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changes.html">Changelog</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../team.html">Team Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">Contributors Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../maintenance.html">Maintainers Guide</a></li>
</ul>


    
        <p class="caption">
            <span class="caption-text">Getting help and contributing</span>
        </p>
        <ul>
            
                <li class="toctree-l1"><a href="https://github.com/GenericMappingTools/.github/blob/main/CODE_OF_CONDUCT.md"><i class="fa fa-gavel fa-fw"></i> Code of Conduct</a></li>
            
                <li class="toctree-l1"><a href="https://github.com/GenericMappingTools/pygmt/blob/main/LICENSE.txt"><i class="fa fa-book fa-fw"></i> License</a></li>
            
                <li class="toctree-l1"><a href="https://forum.generic-mapping-tools.org"><i class="fa fa-comment fa-fw"></i> Contact</a></li>
            
                <li class="toctree-l1"><a href="https://github.com/GenericMappingTools/pygmt"><i class="fa fa-github fa-fw"></i> Source Code</a></li>
            
        </ul>
    

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">PyGMT</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          
<div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
          <li class="breadcrumb-item"><a href="../../pygmt.html">pygmt</a></li>
      <li class="breadcrumb-item active">pygmt.src.nearneighbor</li>
    <li class="source-link">
        
    </li>

  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for pygmt.src.nearneighbor</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">nearneighbor - Grid table data using a &quot;Nearest neighbor&quot; algorithm.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">pygmt.clib</span> <span class="kn">import</span> <span class="n">Session</span>
<span class="kn">from</span> <span class="nn">pygmt.helpers</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">GMTTempFile</span><span class="p">,</span>
    <span class="n">build_arg_string</span><span class="p">,</span>
    <span class="n">fmt_docstring</span><span class="p">,</span>
    <span class="n">kwargs_to_strings</span><span class="p">,</span>
    <span class="n">use_alias</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">pygmt.io</span> <span class="kn">import</span> <span class="n">load_dataarray</span>

<span class="n">__doctest_skip__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;nearneighbor&quot;</span><span class="p">]</span>


<div class="viewcode-block" id="nearneighbor"><a class="viewcode-back" href="../../../api/generated/pygmt.nearneighbor.html#pygmt.nearneighbor">[docs]</a><span class="nd">@fmt_docstring</span>
<span class="nd">@use_alias</span><span class="p">(</span>
    <span class="n">E</span><span class="o">=</span><span class="s2">&quot;empty&quot;</span><span class="p">,</span>
    <span class="n">G</span><span class="o">=</span><span class="s2">&quot;outgrid&quot;</span><span class="p">,</span>
    <span class="n">I</span><span class="o">=</span><span class="s2">&quot;spacing&quot;</span><span class="p">,</span>
    <span class="n">N</span><span class="o">=</span><span class="s2">&quot;sectors&quot;</span><span class="p">,</span>
    <span class="n">R</span><span class="o">=</span><span class="s2">&quot;region&quot;</span><span class="p">,</span>
    <span class="n">S</span><span class="o">=</span><span class="s2">&quot;search_radius&quot;</span><span class="p">,</span>
    <span class="n">V</span><span class="o">=</span><span class="s2">&quot;verbose&quot;</span><span class="p">,</span>
    <span class="n">a</span><span class="o">=</span><span class="s2">&quot;aspatial&quot;</span><span class="p">,</span>
    <span class="n">b</span><span class="o">=</span><span class="s2">&quot;binary&quot;</span><span class="p">,</span>
    <span class="n">d</span><span class="o">=</span><span class="s2">&quot;nodata&quot;</span><span class="p">,</span>
    <span class="n">e</span><span class="o">=</span><span class="s2">&quot;find&quot;</span><span class="p">,</span>
    <span class="n">f</span><span class="o">=</span><span class="s2">&quot;coltypes&quot;</span><span class="p">,</span>
    <span class="n">g</span><span class="o">=</span><span class="s2">&quot;gap&quot;</span><span class="p">,</span>
    <span class="n">h</span><span class="o">=</span><span class="s2">&quot;header&quot;</span><span class="p">,</span>
    <span class="n">i</span><span class="o">=</span><span class="s2">&quot;incols&quot;</span><span class="p">,</span>
    <span class="n">r</span><span class="o">=</span><span class="s2">&quot;registration&quot;</span><span class="p">,</span>
    <span class="n">w</span><span class="o">=</span><span class="s2">&quot;wrap&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="nd">@kwargs_to_strings</span><span class="p">(</span><span class="n">I</span><span class="o">=</span><span class="s2">&quot;sequence&quot;</span><span class="p">,</span> <span class="n">R</span><span class="o">=</span><span class="s2">&quot;sequence&quot;</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="s2">&quot;sequence_comma&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">nearneighbor</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Grid table data using a &quot;Nearest neighbor&quot; algorithm.</span>

<span class="sd">    **nearneighbor** reads arbitrarily located (*x*, *y*, *z*\ [, *w*]) triplets</span>
<span class="sd">    [quadruplets] and uses a nearest neighbor algorithm to assign a weighted</span>
<span class="sd">    average value to each node that has one or more data points within a search</span>
<span class="sd">    radius centered on the node with adequate coverage across a subset of the</span>
<span class="sd">    chosen sectors. The node value is computed as a weighted mean of the</span>
<span class="sd">    nearest point from each sector inside the search radius. The weighting</span>
<span class="sd">    function and the averaging used is given by:</span>

<span class="sd">    .. math::</span>
<span class="sd">        w(r_i) = \frac{{w_i}}{{1 + d(r_i) ^ 2}},</span>
<span class="sd">        \quad d(r) = \frac {{3r}}{{R}},</span>
<span class="sd">        \quad \bar{{z}} = \frac{{\sum_i^n w(r_i) z_i}}{{\sum_i^n w(r_i)}}</span>

<span class="sd">    where :math:`n` is the number of data points that satisfy the selection</span>
<span class="sd">    criteria and :math:`r_i` is the distance from the node to the *i*&#39;th data</span>
<span class="sd">    point. If no data weights are supplied then :math:`w_i = 1`.</span>

<span class="sd">    .. figure:: https://docs.generic-mapping-tools.org/dev/_images/GMT_nearneighbor.png # noqa: W505</span>
<span class="sd">       :width: 300 px</span>
<span class="sd">       :align: center</span>

<span class="sd">       Search geometry includes the search radius (R) which limits the points</span>
<span class="sd">       considered and the number of sectors (here 4), which restricts how</span>
<span class="sd">       points inside the search radius contribute to the value at the node.</span>
<span class="sd">       Only the closest point in each sector (red circles) contribute to the</span>
<span class="sd">       weighted estimate.</span>

<span class="sd">    Takes a matrix, (x, y, z) triplets, or a file name as input.</span>

<span class="sd">    Must provide either ``data`` or ``x``, ``y``, and ``z``.</span>

<span class="sd">    Full option list at :gmt-docs:`nearneighbor.html`</span>

<span class="sd">    {aliases}</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data : str or {table-like}</span>
<span class="sd">        Pass in (x, y, z) or (longitude, latitude, elevation) values by</span>
<span class="sd">        providing a file name to an ASCII data table, a 2-D</span>
<span class="sd">        {table-classes}.</span>
<span class="sd">    x/y/z : 1-D arrays</span>
<span class="sd">        Arrays of x and y coordinates and values z of the data points.</span>

<span class="sd">    {spacing}</span>

<span class="sd">    {region}</span>

<span class="sd">    search_radius : str</span>
<span class="sd">        Sets the search radius that determines which data points are considered</span>
<span class="sd">        close to a node.</span>

<span class="sd">    outgrid : str</span>
<span class="sd">        Optional. The file name for the output netcdf file with extension .nc</span>
<span class="sd">        to store the grid in.</span>

<span class="sd">    empty : str</span>
<span class="sd">        Optional. Set the value assigned to empty nodes. Defaults to NaN.</span>

<span class="sd">    sectors : str</span>
<span class="sd">        *sectors*\ [**+m**\ *min_sectors*]\|\ **n**.</span>
<span class="sd">        Optional. The circular search area centered on each node is divided</span>
<span class="sd">        into *sectors* sectors. Average values will only be computed if there</span>
<span class="sd">        is *at least* one value inside each of at least *min_sectors* of the</span>
<span class="sd">        sectors for a given node. Nodes that fail this test are assigned the</span>
<span class="sd">        value NaN (but see ``empty``). If **+m** is omitted then *min_sectors*</span>
<span class="sd">        is set to be at least 50% of *sectors* (i.e., rounded up to next</span>
<span class="sd">        integer) [Default is a quadrant search with 100% coverage, i.e.,</span>
<span class="sd">        *sectors* = *min_sectors* = 4]. Note that only the nearest value per</span>
<span class="sd">        sector enters into the averaging; the more distant points are ignored.</span>
<span class="sd">        Alternatively, use ``sectors=&quot;n&quot;`` to call GDAL&#39;s nearest neighbor</span>
<span class="sd">        algorithm instead.</span>

<span class="sd">    {verbose}</span>
<span class="sd">    {aspatial}</span>
<span class="sd">    {binary}</span>
<span class="sd">    {nodata}</span>
<span class="sd">    {find}</span>
<span class="sd">    {coltypes}</span>
<span class="sd">    {gap}</span>
<span class="sd">    {header}</span>
<span class="sd">    {incols}</span>
<span class="sd">    {registration}</span>
<span class="sd">    {wrap}</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    ret: xarray.DataArray or None</span>
<span class="sd">        Return type depends on whether the ``outgrid`` parameter is set:</span>

<span class="sd">        - :class:`xarray.DataArray`: if ``outgrid`` is not set</span>
<span class="sd">        - None if ``outgrid`` is set (grid output will be stored in file set by</span>
<span class="sd">          ``outgrid``)</span>
<span class="sd">    Example</span>
<span class="sd">    -------</span>
<span class="sd">    &gt;&gt;&gt; import pygmt</span>
<span class="sd">    &gt;&gt;&gt; # Load a sample dataset of bathymetric x, y, and z values</span>
<span class="sd">    &gt;&gt;&gt; data = pygmt.datasets.load_sample_data(name=&quot;bathymetry&quot;)</span>
<span class="sd">    &gt;&gt;&gt; # Create a new grid with 5 arc-minutes spacing in the designated region</span>
<span class="sd">    &gt;&gt;&gt; # Set search_radius to only consider points within 10 arc-minutes of a node</span>
<span class="sd">    &gt;&gt;&gt; output = pygmt.nearneighbor(</span>
<span class="sd">    ...     data=data,</span>
<span class="sd">    ...     spacing=&quot;5m&quot;,</span>
<span class="sd">    ...     region=[245, 255, 20, 30],</span>
<span class="sd">    ...     search_radius=&quot;10m&quot;,</span>
<span class="sd">    ... )</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">GMTTempFile</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.nc&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">tmpfile</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">Session</span><span class="p">()</span> <span class="k">as</span> <span class="n">lib</span><span class="p">:</span>
            <span class="c1"># Choose how data will be passed into the module</span>
            <span class="n">table_context</span> <span class="o">=</span> <span class="n">lib</span><span class="o">.</span><span class="n">virtualfile_from_data</span><span class="p">(</span>
                <span class="n">check_kind</span><span class="o">=</span><span class="s2">&quot;vector&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">required_z</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
            <span class="k">with</span> <span class="n">table_context</span> <span class="k">as</span> <span class="n">infile</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">outgrid</span> <span class="o">:=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;G&quot;</span><span class="p">))</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;G&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">outgrid</span> <span class="o">=</span> <span class="n">tmpfile</span><span class="o">.</span><span class="n">name</span>  <span class="c1"># output to tmpfile</span>
                <span class="n">lib</span><span class="o">.</span><span class="n">call_module</span><span class="p">(</span>
                    <span class="n">module</span><span class="o">=</span><span class="s2">&quot;nearneighbor&quot;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="n">build_arg_string</span><span class="p">(</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">infile</span><span class="o">=</span><span class="n">infile</span><span class="p">)</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">load_dataarray</span><span class="p">(</span><span class="n">outgrid</span><span class="p">)</span> <span class="k">if</span> <span class="n">outgrid</span> <span class="o">==</span> <span class="n">tmpfile</span><span class="o">.</span><span class="n">name</span> <span class="k">else</span> <span class="kc">None</span></div>
</pre></div>

           </div>
          </div>
          
<footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017-2022, The PyGMT Developers.
      <span class="commit">Revision <code><a href="https://github.com/GenericMappingTools/pygmt/commit/1bf0c2b2">1bf0c2b2</a></code>.
      </span>
      <span class="lastupdated">Last updated on Dec 29, 2022.
      </span></p>
  </div>

  
<p>
Built with <a href="http://sphinx-doc.org/">Sphinx</a>
using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
provided by <a href="https://readthedocs.org">Read the Docs</a>
</p>
<p>
This website uses Google Analytics to gather usage statistics.
However, it does not use cookies or track you across different websites.
Page view data are used to help us improve the site and provide an estimate of the
software usage.
</p>


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>